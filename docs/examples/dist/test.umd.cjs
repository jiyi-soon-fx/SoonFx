(function(C,b){typeof exports=="object"&&typeof module<"u"?b(exports):typeof define=="function"&&define.amd?define(["exports"],b):(C=typeof globalThis<"u"?globalThis:C||self,b(C.SeerEngineTest={}))})(this,function(exports){"use strict";var w=Object.defineProperty;var $=(C,b,a)=>b in C?w(C,b,{enumerable:!0,configurable:!0,writable:!0,value:a}):C[b]=a;var n=(C,b,a)=>$(C,typeof b!="symbol"?b+"":b,a);var C,b,a;var MessageList=(C=class{constructor(){n(this,"eventMessageList",[])}static getInstance(){return C._instance==null&&(C._instance=new C),C._instance}removeEventObject(t){const r=this.eventMessageList.indexOf(t);r!==-1&&this.eventMessageList.splice(r,1)}addEventObject(t){this.eventMessageList.indexOf(t)===-1&&this.eventMessageList.push(t)}},n(C,"_instance",null),C),Call=class{constructor(){}static send(e,t,r){t!=null&&(t.Call_Event_type=e);for(let i=0;i<MessageList.getInstance().eventMessageList.length;i++)if(MessageList.getInstance().eventMessageList[i].getEvents(e)){const s=MessageList.getInstance().eventMessageList[i].execute(e,t);r&&r.apply([e],[s])}}},CallCenter=class{constructor(){n(this,"eventsList",null);this.eventsList=null,MessageList.getInstance().addEventObject(this)}execute(e,t){return this.eventsList[e].apply([e],[t])}getEvents(e){return this.eventsList==null?!1:this.eventsList[e]!=null}addEventListener(e,t,r,i){this.eventsList==null&&(this.eventsList={}),this.eventsList[e]=t.bind(i)}dispose(){for(const e in this.eventsList)delete this.eventsList[e];this.eventsList=null}removeEventListener(e){this.eventsList!=null&&(this.eventsList[e]=null)}},EventManager=(b=class{constructor(){}},n(b,"UP_DATA_PLAYER","UP_DATA_PLAYER"),n(b,"CREATE_FILE_DATA","CREATE_FILE_DATA"),n(b,"CREATE_OPERATION_DATA","CREATE_OPERATION_DATA"),n(b,"CREATE_METADATE_DATA","CREATE_METADATE_DATA"),n(b,"ADD_DATABASE_DATA","ADD_DATABASE_DATA"),n(b,"ADD_OPERAND_DATA","ADD_OPERAND_DATA"),n(b,"SEND_ANCHOR_FORMULA","SEND_ANCHOR_FORMULA"),n(b,"SHIFT_ADD_BOOKMARK","SHIFT_ADD_BOOKMARK"),n(b,"SHIFT_ADD_BOARD","SHIFT_ADD_BOARD"),n(b,"SHIFT_ADD_CHARTS","SHIFT_ADD_CHARTS"),n(b,"SHIFT_ADD_FORMULA","SHIFT_ADD_FORMULA"),n(b,"SHIFT_ADD_FUNCTION","SHIFT_ADD_FUNCTION"),n(b,"SHIFT_ADD_OPERATIONBODY","SHIFT_ADD_OPERATIONBODY"),n(b,"SHIFT_ADD_VARIABLEBODY","SHIFT_ADD_VARIABLEBODY"),n(b,"SHIFT_ADD_SYMBOLBODY","SHIFT_ADD_SYMBOLBODY"),n(b,"SHIFT_SHOW_VIEW","SHIFT_SHOW_VIEW"),n(b,"SHIFT_SHOW_VIEW_ON","SHIFT_SHOW_VIEW_ON"),n(b,"SHIFT_REMOVE_BODY","SHIFT_REMOVE_BODY"),n(b,"SHIFT_ADD_BODY_VIEW","SHIFT_ADD_BODY_VIEW"),n(b,"SHIFT_REFRESH_LIBRARY_COORDINATES","SHIFT_REFRESH_LIBRARY_COORDINATES"),n(b,"IDINDEX",1),n(b,"PLAYER_INSTANCE_LEVEL_UP","PLAYER_INSTANCE_LEVEL_UP"),b),Folder=class{constructor(e=null){n(this,"name");n(this,"isFolder",!0);n(this,"isShow",!0);n(this,"isShowChild",!0);n(this,"tree",[]);n(this,"formulaTree",[]);n(this,"minArrowsView",null);n(this,"constructorName","Folder");n(this,"id");this.name=e,this.id=++EventManager.IDINDEX}setName(e){this.name=e}dispose(){this.name=null,this.isFolder=!1,this.isShowChild=!1,this.tree=[],this.formulaTree=[]}getMaxHeight(){let e=1;for(let t=0;t<this.tree.length;t++)this.tree[t].isShow&&(this.tree[t].isFolder?e+=this.tree[t].getMaxHeight():e++);return e}addTest(e){return this.tree.indexOf(e)==-1}spliceChild(e,t){this.addTest(e)&&this.tree.splice(t,0,e)}pushChild(e){this.addTest(e)&&this.tree.push(e)}unshiftChild(e){this.addTest(e)&&this.tree.unshift(e)}removeChild(e){if(!this.addTest(e)){const t=this.tree.indexOf(e);this.tree.splice(t,1)}}},FXCentre=class{constructor(){n(this,"callCenter",null);fx.sceneFolder=new Folder("场景根目录"),fx.targetFolder=fx.sceneFolder,this.initEventListener()}initEventListener(){this.callCenter=new CallCenter,this.callCenter.addEventListener(fx.Eve.ADD_DATABASE_DATA,this.addDataBaseFunction,null,this),this.callCenter.addEventListener(fx.Eve.ADD_OPERAND_DATA,this.addOperandFunction.bind(this))}addBody(e,t,r){e!=null&&!e.addTest(t)&&(Call.send(fx.Eve.SHIFT_REMOVE_BODY,[t,!1],null),e.addBody(t),Call.send(fx.Eve.SHIFT_ADD_BODY_VIEW,[e,t,r],null))}addOperandFunction(e){this.addBody(e[0],e[1],e[2])}addDataBaseFunction(e){this.addData(e[0],e[1],e[2])}addData(e,t,r){t!=null&&t.typeView!=null&&(t=null),t!=null&&t.isFolder?(e.parentFolder=t,r!=null?t.spliceChild(e,r):t.pushChild(e)):t==null?(e.parentFolder=fx.targetFolder,r!=null?fx.targetFolder.spliceChild(e,r):fx.targetFolder.pushChild(e)):(e.parentFolder=t.parentFolder,e.parentFolder.spliceChild(e,t.parentFolder.tree.indexOf(t)+1))}},NodeType=(e=>(e[e.Variable=1]="Variable",e[e.Macro=4]="Macro",e[e.CalculationLayer=5]="CalculationLayer",e.SymbolBody="SymbolBody",e.OperationBody="OperationBody",e.Bookmark="Bookmark",e[e.Sheet=11]="Sheet",e[e.LogicalBasic=12]="LogicalBasic",e[e.LogicalSlider=14]="LogicalSlider",e[e.LogicalBool=16]="LogicalBool",e))(NodeType||{});function getCatchValue(e,t,r,i){let s=0;try{s=e.getValue(t,r,i)}catch(u){console.log(u),s=0}return s}var getGlobalThis=()=>typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:{},VariableValue=class{constructor(e,t,r=null,i=null){n(this,"name");n(this,"id");n(this,"TID");n(this,"value",0);n(this,"selectedOutputInfo",0);n(this,"type");n(this,"operator",null);n(this,"isAI",!1);n(this,"macros","");n(this,"sheetData",null);n(this,"snNo",1);n(this,"isLogicalOpen",!1);n(this,"isDragging",!1);n(this,"logicalNumberList",[]);n(this,"formulaTextValue");n(this,"currentStep",0);n(this,"minValue",1);n(this,"maxValue",100);n(this,"step",10);n(this,"parent",null);n(this,"childCell");n(this,"childArray",[]);n(this,"childBodyArray",[]);n(this,"logicalChildArray",[]);n(this,"tree",[]);n(this,"cacheValue",null);n(this,"view",null);n(this,"body",null);n(this,"tag",null);n(this,"enemyBody",null);n(this,"enemyFlag",!1);n(this,"isWeight",!0);n(this,"statistics",0);n(this,"absoluteAddress",null);n(this,"site",null);n(this,"source",null);n(this,"captureCrit",!0);n(this,"upDateValue",1);n(this,"demoteValue",0);n(this,"funcType",0);n(this,"historyTarget",null);n(this,"isSystemShow",!1);n(this,"constructorName","VariableValue");this.name=e,this.value=t,this.type=r,this.id=++EventManager.IDINDEX,this.operator=i}setMacros(e){this.macros=e,this.getValue()}setGlobalValue(e){this.source!=null&&this.source.setValue(e)}setValue(e){this.type!==11&&(this.value=e,this.upDataChild(),this.type===1&&fx.code===!1&&this.updateVariableDisplay(e))}updateVariableDisplay(e){var i,s;const t=(i=fx.getDataById)==null?void 0:i.call(fx,this.id),r=(s=fx.getTreeDataById)==null?void 0:s.call(fx,this.id);if(t&&r){const u=getGlobalThis();if(u.window&&!u.window.updatingSheeData){const h=`componentDatas.nodeList.props.tree.props.dataSource.${r.dataPath}.showName`;u.window.set_data(u.window.store,h,`${this.name}=${e}`)}}}addNumberList(){this.logicalNumberList.push({value:""})}changeNumberListItem(e,t){this.logicalNumberList[e].value=t}getIsFunction(){return this.type===4}getRessSring(e){const t=[];return fx.getStepData(e,t),t.join("")}setEnemyBody(e){this.enemyBody=e}setSheetData(e){this.sheetData=new fx.SheetData(e),this.getValue(),this.upDataChild()}getValue(e,t,r){if(this.type!==1&&this.enemyFlag&&fx.enemyBody!=null)return this.value=getCatchValue(fx.enemyBody.getPropertyObject(this.source.absoluteAddress)),this.returnFunc(this.value);switch(this.type){case 4:return this.getMacroValue();case 11:return this.getSheetValue(e,t,r);case NodeType.LogicalNumberList:return this.getLogicalNumberListValue();case 14:return this.getLogicalSliderValue();case NodeType.LogicalList:case 12:return this.getLogicalValue();case 5:return this.getCalculationLayerValue();default:return this.getDefaultValue()}}getMacroValue(){try{if(this.historyTarget=globalThis.target,globalThis.target=this,this.macros==="")return this.value=0,this.returnFunc(this.value);if(fx.code)this.value=new Function(`return ${fx["f_"+this.TID].fun.replace(/[\r\n\s]/g,"")}`)();else try{this.value=eval(this.macros)}catch(e){this.value=0}return globalThis.target=this.historyTarget,isNaN(this.value)||(this.value=fx.double(this.value,4)),this.returnFunc(this.value)}catch(e){return this.value=0,this.value}}getSheetValue(e,t,r){var i,s,u;return this.value=((s=(i=this.source)==null?void 0:i.sheetData)==null?void 0:s.getValue(e,t,r))||((u=this.sheetData)==null?void 0:u.getValue(e,t,r))||0,this.returnFunc(this.value)}getLogicalNumberListValue(){const e=this.getNumberListValue();if(typeof e=="string"&&e.startsWith("[")){const t=JSON.parse(e),r=Math.floor(Math.random()*(t[1]-t[0]+1))+t[0];this.value=r}else this.value=Number(e);return this.returnFunc(this.value)}getNumberListValue(){return typeof this.snNo=="number"&&this.logicalNumberList.length&&this.snNo<=this.logicalNumberList.length&&this.logicalNumberList[this.snNo-1].value||0}getLogicalSliderValue(){const e=this.currentStep*this.step;return this.value=Math.max(this.minValue,Math.min(e,this.maxValue)),this.returnFunc(this.value)}getLogicalValue(){const e=this.logicalChildArray[this.snNo-1];return this.value=e?e.getValue():0,this.returnFunc(this.value)}getCalculationLayerValue(){var r;const e=(r=this.source)==null?void 0:r.body,t=this.body;return e?this.value=getCatchValue(e):t&&(this.value=getCatchValue(t)),isNaN(this.value)||(this.value=Number(fx.double(this.value,4))),this.returnFunc(this.value)}getDefaultValue(){return this.value||(this.value=0),isNaN(this.value)||(this.value=Number(this.value)),this.returnFunc(this.value)}returnFunc(e){return this.funcType===0?e:this.funcType>=1&&this.funcType<=23?this.handleFunction(e):this.funcType>=24&&this.funcType<=35?this.commonFormulaFunction():this.funcType>=36&&this.funcType<=43?this.triangleFunction(e):this.funcType>=44&&this.funcType<=51?this.logicFunction():this.funcType>=4&&this.funcType<=14||this.funcType>=52&&this.funcType<=55?this.commonFunction(e):this.funcType>=56&&this.funcType<=60?this.algorithmFunction():this.funcType>=61&&this.funcType<=68?this.gameFormulaFunction():e}handleFunction(e){const t=r=>getCatchValue(this.tree[r]);switch(this.funcType){case 1:return 1-e;case 2:return 1/e;case 3:return-e;case 15:return e*2;case 16:return e/2;case 17:return e*100;case 18:return e/100;case 19:return e*e;case 20:return this.tree.length<2?0:t(0)/t(1);case 21:return this.tree.length<2?0:t(0)/(t(0)+t(1));case 22:return this.tree.length<2?0:t(0)/(t(1)-t(0));case 23:return this.weightedRandom();case 10:return this.tree.length<2?0:Math.random()*(t(1)-t(0))+t(0);default:return e}}commonFormulaFunction(){const e=t=>getCatchValue(this.tree[t]);switch(this.funcType){case 24:return this.tree.length<2?0:e(0)-e(1);case 25:return this.tree.length<2?0:e(0)*e(0)/(e(0)+e(1));case 26:return this.tree.length<2?0:(e(0)-e(1))*(e(0)/e(1));case 27:return this.tree.length<2?0:e(0)*e(0)/e(1);case 28:return this.tree.length<2?0:e(0)/e(1);case 29:return this.tree.length<2?0:e(0)*(1-e(1));case 30:return this.tree.length<2?0:e(0)*e(1)/(1+e(0)*e(1));case 31:return this.tree.length<2?0:e(0)*e(1);case 32:return this.tree.length<3?0:e(0)/(1+e(1)*e(2));case 33:return this.tree.length<3?0:e(0)/e(1)*e(2);case 34:return this.tree.length<3?0:e(0)*e(2)/e(1);case 35:return this.tree.length<3?0:e(0)*(e(2)/e(1));default:return 0}}triangleFunction(e){const t=r=>getCatchValue(this.tree[r]);switch(this.funcType){case 36:return e*Math.PI;case 37:return Math.cos(e);case 38:return Math.sin(e);case 39:return Math.tan(e);case 40:return Math.acos(e);case 41:return Math.asin(e);case 42:return Math.atan(e);case 43:return this.tree.length<2?0:Math.atan2(t(0),t(1));default:return e}}logicFunction(){const e=t=>getCatchValue(this.tree[t]);if(this.tree.length<4&&this.funcType!==51&&this.funcType!==50)return 0;switch(this.funcType){case 44:return e(0)>e(1)?e(2):e(3);case 45:return e(0)>=e(1)?e(2):e(3);case 46:return e(0)<e(1)?e(2):e(3);case 47:return e(0)<=e(1)?e(2):e(3);case 48:return e(0)==e(1)?e(2):e(3);case 49:return e(0)!=e(1)?e(2):e(3);case 50:return this.complexForLoop();case 51:return this.tree.length>0?e(e(0)):0;default:return 0}}commonFunction(e){const t=r=>getCatchValue(this.tree[r]);switch(this.funcType){case 4:return Math.abs(e);case 5:return Math.random()*e;case 6:return Math.floor(e);case 7:return Math.sqrt(e);case 8:return Math.max(...this.tree.map((r,i)=>Number(t(i))));case 9:return Math.min(...this.tree.map((r,i)=>Number(t(i))));case 11:return this.tree.length<2?0:Math.pow(t(0),t(1));case 12:return Math.log(e);case 13:return Math.exp(e);case 14:return Math.cbrt(e);case 52:return Math.sign(e);case 53:return Math.imul(e,1);case 54:return Math.ceil(e);case 55:return Math.round(e);default:return e}}algorithmFunction(){const e=t=>getCatchValue(this.tree[t]);switch(this.funcType){case 56:return this.tree.length<2?0:fx.length(e(0),e(1));case 57:return this.tree.length<4?0:fx.distance(e(0),e(1),e(2),e(3));case 58:return this.tree.length<4?0:fx.dot(e(0),e(1),e(2),e(3));case 59:return this.tree.length<4?0:fx.cross(e(0),e(1),e(2),e(3));case 60:return this.tree.length<3?0:fx.mix(e(0),e(1),e(2));default:return 0}}gameFormulaFunction(){const e=t=>getCatchValue(this.tree[t]);switch(this.funcType){case 61:return this.tree.length<3?0:e(0)*e(2)*(1-1/(1+e(0)*e(2)/(5*e(1))));case 62:return this.tree.length<4?0:e(0)+e(2)*e(1)+e(3)*(1+e(1))*e(1)/2;case 63:case 64:return this.tree.length<5?0:e(0)*2+Math.pow(e(0)/10,2)+e(1)/5+e(2)/5+e(4)*e(3);case 65:return this.tree.length<1?0:e(0)*2+Math.pow(e(0)/10,2);case 66:case 67:return this.value;case 70:return this.tree.length<2?0:e(0)+e(1);default:return this.value}}weightedRandom(){if(this.tree.length%2!==0)return 0;let e=0;for(let r=1;r<this.tree.length;r+=2)this.tree[r].indexex=getCatchValue(this.tree[r])+e,e+=getCatchValue(this.tree[r]);const t=Math.random()*e;for(let r=1;r<this.tree.length;r+=2){const i=r===1?0:this.tree[r-2].indexex;if(t>=i&&t<this.tree[r].indexex)return getCatchValue(this.tree[r-1])}return 0}complexForLoop(){if(this.tree.length<3)return 0;let e=0,t=0;const r=getCatchValue(this.tree[0]),i=getCatchValue(this.tree[1]),s=getCatchValue(this.tree[2]);for(let u=r;u<=i;u++)u%s===1&&e++,t+=e+2;return t}getFormulaTextValueBody(){return{1:`1-(${this.value})`,2:`1/(${this.value})`,3:`-(${this.value})`,4:`abs(${this.value})`,5:`random()*${this.value}`,6:`floor(${this.value})`,7:`sqrt(${this.value})`,12:`log(${this.value})`,13:`exp(${this.value})`,14:`cbrt(${this.value})`,15:`(${this.value})*2`,16:`(${this.value})/2`,17:`(${this.value})*100`,18:`(${this.value})/100`,19:`${this.value}*${this.value}`,36:`${this.value}*PI`,37:`cos(${this.value})`,38:`sin(${this.value})`,39:`tan(${this.value})`,40:`acos(${this.value})`,41:`asin(${this.value})`,42:`atan(${this.value})`,52:`sign(${this.value})`,53:`imul(${this.value})`,54:`ceil(${this.value})`,55:`round(${this.value})`}[this.funcType]||this.formulaTextValue||String(this.value)}getFormulaTextValue(){return this.getFormulaTextValueBody()}getFormulaTextCharacterBody(){if(this.type===5)return this.body?this.body.getFormulaTextCharacter():"";if(this.type===4)return this.getValue();let e=this.name;return this.type===4&&(e=`${this.name}_${this.TID}`),{1:`1-(${this.name})`,2:`1/(${this.name})`,3:`-${this.name}`,4:`abs(${this.name})`,5:`random()*(${this.name})`,6:`floor(${this.name})`,7:`sqrt(${this.name})`,12:`log(${this.name})`,13:`exp(${this.name})`,14:`cbrt(${this.name})`,15:`${this.name}*2`,16:`${this.name}/2`,17:`${this.name}*100`,18:`${this.name}/100`,19:`${this.name}*${this.name}`,36:`${this.name}*PI`,37:`cos(${this.name})`,38:`sin(${this.name})`,39:`tan(${this.name})`,40:`acos(${this.name})`,41:`asin(${this.name})`,42:`atan(${this.name})`,52:`sign(${this.name})`,53:`imul(${this.name})`,54:`ceil(${this.name})`,55:`round(${this.name})`}[this.funcType]||e}getFormulaTextCharacter(){return this.getFormulaTextCharacterBody()}removeChild(e){const t=this.childArray.indexOf(e);t>-1&&this.childArray.splice(t,1)}dispose(){this.source!=null&&this.source.removeChild(this),this.macros="",this.childArray=[]}setParameter(e,t){this.name=e,this.value=t}upDataChild(){for(const e of this.childArray)e.name=this.name,e.value=this.value,e.body=this.body,e.TID=this.TID}setDataChild(e,t){this.name=e,this.value=t;for(const r of this.childArray)r.setDataChild(e,t)}syncBody(){for(const e of this.childArray)e.body=this.body}copy(){const e=new fx.VariableValue(this.name,this.value,this.type,this.operator);return e.source=this,e.body=this.body,e.TID=this.TID,this.childArray.push(e),e}},BasicBody=class{constructor(){n(this,"tree",[]);n(this,"parent",null);n(this,"type","BasicBody");n(this,"isWeight",!1);n(this,"value",null);n(this,"isAdvance",!1);n(this,"isBindingOperation",!1);n(this,"isBindingFormula",!1);n(this,"formulaTextValue","");n(this,"formulaTextCharacter","");n(this,"operationalLogicText","");n(this,"cacheElementValue",null);n(this,"funcType",0);n(this,"constructorName","BasicBody");n(this,"id");n(this,"typetype",null);n(this,"operator",null);n(this,"indexex",0);n(this,"isFunction",!1);n(this,"x",0);n(this,"y",0);this.id=++EventManager.IDINDEX}addTest(e){return this.tree.includes(e)?!0:this.tree.some(t=>t instanceof fx.BasicBody&&t.addTest(e))}replace(e,t){this.tree[t]=e,e.parent=this}deletebody(e){const t=this.tree.indexOf(e);t!==-1&&(this.tree.splice(t,1),e.parent=null)}addBody(e){this.tree.includes(e)||(e.parent=this,this.tree.push(e))}getDeleteBodyTree(e){const t=this.tree.indexOf(e);if(t===-1)return[];const r=this.tree.slice(t);return this.tree.splice(t),r}dispose(){this.tree.forEach(e=>{e&&typeof e.dispose=="function"&&e.dispose()}),this.tree=[],this.value=null,this.parent=null,this.typetype=null,this.cacheElementValue=null,this.formulaTextValue="",this.formulaTextCharacter="",this.operationalLogicText="",this.isWeight=!1,this.isAdvance=!1,this.isBindingOperation=!1,this.isBindingFormula=!1,this.isFunction=!1}getMaxHeight(){return this.tree.filter(t=>t instanceof fx.BasicBody).reduce((t,r)=>t+r.getMaxHeight(),0)||1}getValue(e,t,r){if(this.resetValues(),!!this.tree)return this.processTreeValues(),this.calculateFinalValue(),this.value=this.applyFunction(this.value),this.value}resetValues(){this.value=null,this.formulaTextValue="",this.formulaTextCharacter="",this.operationalLogicText="",this.cacheElementValue=null}processTreeValues(){for(const e of this.tree){const t=this.getNodeValue(e);this.updateOperationalLogic(e,t),this.updateFormulaTexts(e,t)}}getNodeValue(e){if(e.type===11){const{name:t,row:r,col:i}=(e==null?void 0:e.selectedOutputInfo)||{};return getCatchValue(e,t,r,i)}return e.type===5,getCatchValue(e)}updateOperationalLogic(e,t){var r;(r=this.cacheElementValue)!=null&&r.operator&&(this.operationalLogicText+=`(${t})`),this.cacheElementValue||(this.cacheElementValue=e,this.operationalLogicText+=`(${t})`),e.operator&&(this.operationalLogicText+=e.operator)}updateFormulaTexts(e,t){[0,1,2,3,4,5,11].includes(e.type)&&(this.formulaTextCharacter+=e.getFormulaTextCharacter(),this.formulaTextValue+=t,e.operator&&(this.formulaTextValue+=e.operator,this.formulaTextCharacter+=e.operator))}calculateFinalValue(){const e=this.formulaTextValue.slice(-1);["+","-","*","/","%",">",">=","<","<=","!="].includes(e)||(this.value=fx.eval(this.operationalLogicText)),isNaN(this.value)?this.value=this.operationalLogicText:this.value=Number(this.value)}applyFunction(e){return this.returnFunc(e)}returnFunc(e){const r=this.getFunctionHandlers()[this.funcType];return r?r(e,this.tree):e}getFunctionHandlers(){return{0:e=>e,1:e=>1-e,2:e=>1/e,3:e=>-e,15:e=>e*2,16:e=>e/2,17:e=>e*100,18:e=>e/100,19:e=>e*e,4:e=>Math.abs(e),5:e=>Math.random()*e,6:e=>Math.floor(e),7:e=>Math.sqrt(e),8:(e,t)=>this.calculateMax(t),9:(e,t)=>this.calculateMin(t),11:(e,t)=>this.calculatePower(t),12:e=>Math.log(e),13:e=>Math.exp(e),14:e=>Math.cbrt(e),52:e=>Math.sign(e),53:e=>Math.imul(e,1),54:e=>Math.ceil(e),55:e=>Math.round(e),10:(e,t)=>this.calculateRandom(t),20:(e,t)=>this.divideValues(t),21:(e,t)=>this.divideBySum(t),22:(e,t)=>this.divideByDifference(t),23:(e,t)=>this.weightedRandom(t),24:(e,t)=>this.attackMinusDefense(t),25:(e,t)=>this.attackSquaredOverDiff(t),26:(e,t)=>this.diffTimesRatio(t),27:(e,t)=>this.attackSquaredOverDefense(t),28:(e,t)=>this.attackOverDefense(t),29:(e,t)=>this.attackWithCoefficient(t),30:(e,t)=>this.armorFormula(t),31:(e,t)=>this.attackWithDamageRate(t),32:(e,t)=>this.attackOverDefenseFormula(t),33:(e,t)=>this.attackRatioWithCoef(t),34:(e,t)=>this.attackCoefOverDefense(t),35:(e,t)=>this.attackTimesCoefRatio(t),36:e=>e*Math.PI,37:e=>Math.cos(e),38:e=>Math.sin(e),39:e=>Math.tan(e),40:e=>Math.acos(e),41:e=>Math.asin(e),42:e=>Math.atan(e),43:(e,t)=>this.calculateAtan2(t),44:(e,t)=>this.ifGreater(t),45:(e,t)=>this.ifGreaterEqual(t),46:(e,t)=>this.ifLess(t),47:(e,t)=>this.ifLessEqual(t),48:(e,t)=>this.ifEqual(t),49:(e,t)=>this.ifNotEqual(t),50:(e,t)=>this.forLoop(t),51:(e,t)=>this.arrayAccess(t),56:(e,t)=>this.calculateLength(t),57:(e,t)=>this.calculateDistance(t),58:(e,t)=>this.calculateDot(t),59:(e,t)=>this.calculateCross(t),60:(e,t)=>this.calculateMix(t),61:(e,t)=>this.battleFormula(t),62:(e,t)=>this.characterHealth(t),63:(e,t)=>this.meleeAttack(t),64:(e,t)=>this.rangedAttack(t),65:(e,t)=>this.mageAttack(t),66:(e,t)=>this.physicalDefense(t),67:(e,t)=>this.magicDefense(t),68:(e,t)=>this.hitRate(t),69:(e,t)=>this.dodgeRate(t),70:e=>1+e/3,71:e=>1+e/5,72:(e,t)=>this.jobPointGrowth(t),73:(e,t)=>this.finalMeleeAttack(t),74:(e,t)=>this.finalRangedAttack(t),75:(e,t)=>this.finalMagicAttack(t),76:(e,t)=>this.physicalDamage(t),77:(e,t)=>this.magicDamage(t),78:(e,t)=>this.hitChance(t),79:(e,t)=>this.critChance(t),80:(e,t)=>this.growthFormula(t)}}getTreeValue(e,t){return e.length>t?Number(getCatchValue(e[t])):0}calculateMax(e){const t=e.map(r=>Number(getCatchValue(r)));return Math.max(...t)}calculateMin(e){const t=e.map(r=>Number(getCatchValue(r)));return Math.min(...t)}calculatePower(e){return e.length<2?0:Math.pow(this.getTreeValue(e,0),this.getTreeValue(e,1))}calculateRandom(e){if(e.length<2)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1);return Math.random()*(r-t)+t}divideValues(e){return e.length<2?0:this.getTreeValue(e,0)/this.getTreeValue(e,1)}divideBySum(e){if(e.length<2)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1);return t/(t+r)}divideByDifference(e){if(e.length<2)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1);return t/(r-t)}weightedRandom(e){if(e.length%2!==0)return 0;let t=0;for(let i=1;i<e.length;i+=2){const s=this.getTreeValue(e,i);e[i].indexex=s+t,t+=s}const r=Math.random()*t;for(let i=1;i<e.length;i+=2){const s=i>1&&e[i-2].indexex||0,u=e[i].indexex||0;if(r>=s&&r<u)return this.getTreeValue(e,i-1)}return 0}attackMinusDefense(e){return e.length<2?0:this.getTreeValue(e,0)-this.getTreeValue(e,1)}attackSquaredOverDiff(e){if(e.length<2)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1);return t*t/(t+r)}diffTimesRatio(e){if(e.length<2)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1);return(t-r)*(t/r)}attackSquaredOverDefense(e){if(e.length<2)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1);return t*t/r}attackOverDefense(e){return e.length<2?0:this.getTreeValue(e,0)/this.getTreeValue(e,1)}attackWithCoefficient(e){return e.length<2?0:this.getTreeValue(e,0)*(1-this.getTreeValue(e,1))}armorFormula(e){if(e.length<2)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1);return t*r/(1+t*r)}attackWithDamageRate(e){return e.length<2?0:this.getTreeValue(e,0)*this.getTreeValue(e,1)}attackOverDefenseFormula(e){if(e.length<3)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1),i=this.getTreeValue(e,2);return t/(1+r*i)}attackRatioWithCoef(e){return e.length<3?0:this.getTreeValue(e,0)/this.getTreeValue(e,1)*this.getTreeValue(e,2)}attackCoefOverDefense(e){return e.length<3?0:this.getTreeValue(e,0)*this.getTreeValue(e,2)/this.getTreeValue(e,1)}attackTimesCoefRatio(e){return e.length<3?0:this.getTreeValue(e,0)*(this.getTreeValue(e,2)/this.getTreeValue(e,1))}calculateAtan2(e){return e.length<2?0:Math.atan2(this.getTreeValue(e,0),this.getTreeValue(e,1))}ifGreater(e){return e.length<4?0:this.getTreeValue(e,0)>this.getTreeValue(e,1)?this.getTreeValue(e,2):this.getTreeValue(e,3)}ifGreaterEqual(e){return e.length<4?0:this.getTreeValue(e,0)>=this.getTreeValue(e,1)?this.getTreeValue(e,2):this.getTreeValue(e,3)}ifLess(e){return e.length<4?0:this.getTreeValue(e,0)<this.getTreeValue(e,1)?this.getTreeValue(e,2):this.getTreeValue(e,3)}ifLessEqual(e){return e.length<4?0:this.getTreeValue(e,0)<=this.getTreeValue(e,1)?this.getTreeValue(e,2):this.getTreeValue(e,3)}ifEqual(e){return e.length<4?0:this.getTreeValue(e,0)===this.getTreeValue(e,1)?this.getTreeValue(e,2):this.getTreeValue(e,3)}ifNotEqual(e){return e.length<4?0:this.getTreeValue(e,0)!==this.getTreeValue(e,1)?this.getTreeValue(e,2):this.getTreeValue(e,3)}forLoop(e){if(e.length<4)return 0;let t=0,r=0;const i=this.getTreeValue(e,0),s=this.getTreeValue(e,1),u=this.getTreeValue(e,2),h=this.getTreeValue(e,3);for(let o=i;o<=s;o++)o%u===1&&t++,r+=t+h;return r}arrayAccess(e){if(e.length<2)return 0;const t=this.getTreeValue(e,0);return this.getTreeValue(e,t)}calculateLength(e){return e.length<2?0:fx.length(this.getTreeValue(e,0),this.getTreeValue(e,1))}calculateDistance(e){return e.length<4?0:fx.distance(this.getTreeValue(e,0),this.getTreeValue(e,1),this.getTreeValue(e,2),this.getTreeValue(e,3))}calculateDot(e){return e.length<4?0:fx.dot(this.getTreeValue(e,0),this.getTreeValue(e,1),this.getTreeValue(e,2),this.getTreeValue(e,3))}calculateCross(e){return e.length<4?0:fx.cross(this.getTreeValue(e,0),this.getTreeValue(e,1),this.getTreeValue(e,2),this.getTreeValue(e,3))}calculateMix(e){return e.length<3?0:fx.mix(this.getTreeValue(e,0),this.getTreeValue(e,1),this.getTreeValue(e,2))}battleFormula(e){if(e.length<3)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1),i=this.getTreeValue(e,2);return t*i*(1-1/(1+t*i/(5*r)))}characterHealth(e){if(e.length<4)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1),i=this.getTreeValue(e,2),s=this.getTreeValue(e,3);return t+i*r+s*(1+r)*r/2}meleeAttack(e){if(e.length<5)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1),i=this.getTreeValue(e,2),s=this.getTreeValue(e,3),u=this.getTreeValue(e,4);return t*2+Math.pow(t/10,2)+r/5+i/5+u*s}rangedAttack(e){if(e.length<5)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1),i=this.getTreeValue(e,2),s=this.getTreeValue(e,3),u=this.getTreeValue(e,4);return t*2+Math.pow(t/10,2)+r/5+i/5+u*s}mageAttack(e){if(e.length<1)return 0;const t=this.getTreeValue(e,0);return t*2+Math.pow(t/10,2)}physicalDefense(e){return this.value}magicDefense(e){return this.value}hitRate(e){return e.length<2?0:this.getTreeValue(e,0)+this.getTreeValue(e,1)}dodgeRate(e){return e.length<2?0:this.getTreeValue(e,0)+this.getTreeValue(e,1)}jobPointGrowth(e){return e.length<2?0:1+this.getTreeValue(e,0)/this.getTreeValue(e,1)}finalMeleeAttack(e){if(e.length<8)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1),i=this.getTreeValue(e,2),s=this.getTreeValue(e,3),u=this.getTreeValue(e,4),h=this.getTreeValue(e,5),o=this.getTreeValue(e,6),c=this.getTreeValue(e,7);return(t*7+t/5+r/5+i/5+s+(s+u)*h)*o*c}finalRangedAttack(e){if(e.length<8)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1),i=this.getTreeValue(e,2),s=this.getTreeValue(e,3),u=this.getTreeValue(e,4),h=this.getTreeValue(e,5),o=this.getTreeValue(e,6),c=this.getTreeValue(e,7);return(t*5+t/5+r/5+i/5+s+(s+u)*h)*o*c}finalMagicAttack(e){if(e.length<6)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1),i=this.getTreeValue(e,2),s=this.getTreeValue(e,3),u=this.getTreeValue(e,4),h=this.getTreeValue(e,5);return(t*7+t/5+r+(r+i)*s)*u*h}physicalDamage(e){if(e.length<2)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1);return t*(4e3+r)/(4e3+r*10)}magicDamage(e){if(e.length<2)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1);return t*(1e3+r)/(1e3+r*10)}hitChance(e){if(e.length<2)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1);return(t-r+80)/100}critChance(e){if(e.length<2)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1);return(t-r)/100}growthFormula(e){if(e.length<2)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1);return(t-1)*r}getFormulaTextValueBody(){const t=this.getFormulaTextBuilders()[this.funcType];return t?t(this.formulaTextValue,this.tree):this.formulaTextValue}getFormulaTextBuilders(){return{0:e=>e,1:e=>`(1-(${e}))`,2:e=>`1/(${e})`,3:e=>`-(${e})`,15:e=>`(${e})*2`,16:e=>`(${e})/2`,17:e=>`(${e})*100`,18:e=>`(${e})/100`,19:e=>`(${e})*(${e})`,4:e=>`abs(${e})`,5:e=>`random()*(${e})`,6:e=>`floor(${e})`,7:e=>`sqrt(${e})`,8:(e,t)=>this.buildMaxText(t),9:(e,t)=>this.buildMinText(t),11:(e,t)=>this.buildPowerText(t),12:e=>`log(${e})`,13:e=>`exp(${e})`,14:e=>`cbrt(${e})`,52:e=>`sign(${e})`,53:e=>`imul(${e})`,54:e=>`ceil(${e})`,55:e=>`round(${e})`,10:(e,t)=>this.buildRandomRangeText(t),20:(e,t)=>this.buildDivisionText(t),21:(e,t)=>this.buildDivisionSumText(t),22:(e,t)=>this.buildDivisionDiffText(t),23:(e,t)=>this.buildWeightedText(t),24:(e,t)=>this.buildAttackDefenseText(t,"-"),25:(e,t)=>this.buildComplexAttackText(t,1),26:(e,t)=>this.buildComplexAttackText(t,2),27:(e,t)=>this.buildComplexAttackText(t,3),28:(e,t)=>this.buildAttackDefenseText(t,"/"),36:e=>`(${e})*PI`,37:e=>`cos(${e})`,38:e=>`sin(${e})`,39:e=>`tan(${e})`,40:e=>`acos(${e})`,41:e=>`asin(${e})`,42:e=>`atan(${e})`,43:(e,t)=>this.buildAtan2Text(t),44:(e,t)=>this.buildIfText(t,">"),45:(e,t)=>this.buildIfText(t,">="),46:(e,t)=>this.buildIfText(t,"<"),47:(e,t)=>this.buildIfText(t,"<="),48:(e,t)=>this.buildIfText(t,"=="),49:(e,t)=>this.buildIfText(t,"!="),50:(e,t)=>this.buildForLoopText(t),51:(e,t)=>this.buildArrayAccessText(t),56:(e,t)=>this.buildAlgorithmText(t,"length"),57:(e,t)=>this.buildAlgorithmText(t,"distance"),58:(e,t)=>this.buildAlgorithmText(t,"dot"),59:(e,t)=>this.buildAlgorithmText(t,"cross"),60:(e,t)=>this.buildMixText(t),61:(e,t)=>this.buildBattleFormulaText(t),62:(e,t)=>this.buildCharacterHealthText(t),63:(e,t)=>this.buildMeleeAttackText(t),64:(e,t)=>this.buildRangedAttackText(t),65:(e,t)=>this.buildMageAttackText(t),76:(e,t)=>this.buildPhysicalDamageText(t),77:(e,t)=>this.buildMagicDamageText(t),78:(e,t)=>this.buildHitChanceText(t),79:(e,t)=>this.buildCritChanceText(t),80:(e,t)=>this.buildGrowthText(t)}}buildMaxText(e){return`max(${e.map(r=>r.getFormulaTextValue()).join(",")})`}buildMinText(e){return`min(${e.map(r=>r.getFormulaTextValue()).join(",")})`}buildPowerText(e){return e.length<2?"参数不匹配,请输入[值,值]":`pow(${e[0].getFormulaTextValue()},${e[1].getFormulaTextValue()})`}buildRandomRangeText(e){if(e.length<2)return"参数不匹配,请输入[最小值,最大值]";const t=e[0].getFormulaTextValue();return`random()*(${e[1].getFormulaTextValue()}-${t})+${t}`}buildDivisionText(e){return e.length<2?"参数不匹配,请输入[值,值]":`(${e[0].getFormulaTextValue()})/(${e[1].getFormulaTextValue()})`}buildDivisionSumText(e){if(e.length<2)return"参数不匹配,请输入[值,值]";const t=e[0].getFormulaTextValue(),r=e[1].getFormulaTextValue();return`${t}/(${t}+${r})`}buildDivisionDiffText(e){if(e.length<2)return"参数不匹配,请输入[值,值]";const t=e[0].getFormulaTextValue(),r=e[1].getFormulaTextValue();return`${t}/(${r}-${t})`}buildWeightedText(e){if(e.length%2!==0)return"参数不匹配,请输入[值,权重]";const t=[];for(let r=0;r<e.length;r+=2)t.push(`[值:${e[r].getFormulaTextValue()},权重:${e[r+1].getFormulaTextValue()}]`);return t.join(",")}buildAttackDefenseText(e,t){return e.length<2?"参数不匹配,请输入[攻击,防御]":`${e[0].getFormulaTextValue()}${t}${e[1].getFormulaTextValue()}`}buildComplexAttackText(e,t){if(e.length<2)return"参数不匹配,请输入[攻击,防御]";const r=e[0].getFormulaTextValue(),i=e[1].getFormulaTextValue();switch(t){case 1:return`${r}*${r}/(${r}+${i})`;case 2:return`(${r}-${i})*(${r}/${i})`;case 3:return`${r}*${r}/${i}`;default:return""}}buildAtan2Text(e){return e.length<2?"参数不匹配,请输入[值,值]":`atan2(${e[0].getFormulaTextValue()},${e[1].getFormulaTextValue()})`}buildIfText(e,t){if(e.length<4)return"参数不匹配,请输入[值,值,值,值]";const[r,i,s,u]=e.map(h=>h.getFormulaTextValue());return`if(${r}${t}${i}){return ${s}}else{return ${u}}`}buildForLoopText(e){if(e.length<4)return"参数不匹配,请输入[初始等级,当前等级,间隔值,初始值]";const[t,r,i,s]=e.map(u=>u.getFormulaTextValue());return`for(var i=${t};i<=${r};i++){if(i%${i}==1){a++}c+=a+${s}}`}buildArrayAccessText(e){return e.length<2?"参数不匹配,请输入下标和数组":`[${e[0].getFormulaTextValue()}]`}buildAlgorithmText(e,t){const r=t==="mix"?3:4,i=t==="mix"?"[值1,值2,混合比例]":"[x1,y1,x2,y2]";if(e.length<r)return`参数不匹配,请输入${i}`;const s=e.slice(0,r).map(u=>u.getFormulaTextValue()).join(",");return`${t}(${s})`}buildMixText(e){return e.length<3?"参数不匹配,请输入[值1,值2,混合比例]":`mix(${e.slice(0,3).map(r=>r.getFormulaTextValue()).join(",")})`}buildBattleFormulaText(e){if(e.length<3)return"参数不匹配,请输入[攻击,防御,技能系数]";const[t,r,i]=e.map(s=>s.getFormulaTextValue());return`${t}*${i}*(1-(1/(1+((${t}*${i})/(5*${r})))))`}buildCharacterHealthText(e){if(e.length<4)return"参数不匹配,请输入[基础生命,等级,职业系数A,职业系数B]";const[t,r,i,s]=e.map(u=>u.getFormulaTextValue());return`${t}+${i}*${r}+${s}*(1+${r})*${r}/2`}buildMeleeAttackText(e){if(e.length<5)return"参数不匹配,请输入[力量,灵巧,幸运,等级,职业攻击系数]";const[t,r,i,s,u]=e.map(h=>h.getFormulaTextValue());return`${t}*2+pow((${t}/10),2)+${r}/5+${i}/5+${u}*${s}`}buildRangedAttackText(e){if(e.length<5)return"参数不匹配,请输入[灵巧,力量,幸运,等级,职业攻击系数]";const[t,r,i,s,u]=e.map(h=>h.getFormulaTextValue());return`${t}*2+pow((${t}/10),2)+${r}/5+${i}/5+${u}*${s}`}buildMageAttackText(e){if(e.length<1)return"参数不匹配,请输入[力量]";const t=e[0].getFormulaTextValue();return`${t}*2+pow(${t}/10,2)`}buildPhysicalDamageText(e){if(e.length<2)return"参数不匹配,请输入[物攻,物防]";const[t,r]=e.map(i=>i.getFormulaTextValue());return`${t}*(4000+${r})/(4000+(${r}*10))`}buildMagicDamageText(e){if(e.length<2)return"参数不匹配,请输入[魔攻,魔防]";const[t,r]=e.map(i=>i.getFormulaTextValue());return`${t}*(1000+${r})/(1000+(${r}*10))`}buildHitChanceText(e){if(e.length<2)return"参数不匹配,请输入[命中,闪避]";const[t,r]=e.map(i=>i.getFormulaTextValue());return`(${t}-${r}+80)/100`}buildCritChanceText(e){if(e.length<2)return"参数不匹配,请输入[暴击,抗暴]";const[t,r]=e.map(i=>i.getFormulaTextValue());return`(${t}-${r})/100`}buildGrowthText(e){if(e.length<2)return"参数不匹配,请输入[等级,属性成长值]";const[t,r]=e.map(i=>i.getFormulaTextValue());return`(${t}-1)*${r}`}getFormulaTextValue(){return this.getFormulaTextValueBody()}getFormulaTextCharacterBody(){return this.formulaTextCharacter}getFormulaTextCharacter(){return this.getFormulaTextCharacterBody()}},SymbolBody=class extends BasicBody{constructor(){super();n(this,"operator",null);n(this,"type","SymbolBody");n(this,"isFunctionId",1);n(this,"funcType",0);n(this,"constructorName","SymbolBody")}copy(){var t=new fx.SymbolBody;return t.operator=this.operator,t.isFunctionId=this.isFunctionId,t.tree=this.tree,t.parent=this.parent,t.value=this.value,t.isWeight=this.isWeight,t.isBindingOperation=this.isBindingOperation,t.isBindingFormula=this.isBindingFormula,t.formulaTextValue=this.formulaTextValue,t.formulaTextCharacter=this.formulaTextCharacter,t.operationalLogicText=this.operationalLogicText,t.cacheElementValue=this.cacheElementValue,t}setFunctionId(t){this.isFunctionId=t}getRunFunctionId(){var t=this.getFunctionLength();return this.isFunctionId++,this.isFunctionId>t&&(this.isFunctionId=1),this.isFunctionId}getFunctionLength(){for(var t=0,r=0;r<this.tree.length;r++)this.tree[r].isFunction&&t++;return t}getFunction(t){for(var r=0,i=0;i<this.tree.length;i++)if(this.tree[i].isFunction&&(r++,r==t))return this.tree[i];return null}getValue(){if((this.operator=="fx"||this.operator=="=")&&this.getFunctionLength()>0){const r=this.getFunction(this.isFunctionId);return r?this.value=this.returnFunc(getCatchValue(r)):this.value=null,this.value}else{this.value=null,this.operationalLogicText="";for(var t=0;t<this.tree.length;t++)t<this.tree.length-1?this.operationalLogicText+=Number(getCatchValue(this.tree[t]))+(this.operator||""):this.operationalLogicText+="("+Number(getCatchValue(this.tree[t]))+")";this.value=fx.eval(this.operationalLogicText)}return isNaN(this.value)?(this.value=this.returnFunc(this.value),this.value):(this.value=this.returnFunc(Number(this.value)),this.value)}getFormulaTextCharacter(){if(this.operator=="="&&this.getFunctionLength()>0){const s=this.getFunction(this.isFunctionId);s?this.formulaTextCharacter="("+s.getFormulaTextCharacter()+")":this.formulaTextCharacter=""}else{this.formulaTextCharacter="";for(var t=0;t<this.tree.length;t++)if(t<this.tree.length-1)this.formulaTextCharacter+="("+this.tree[t].getFormulaTextCharacter()+")"+(this.operator||"");else{var r=this.tree[t].getFormulaTextCharacter();r.indexOf("+")==-1&&r.indexOf("-")==-1&&r.indexOf("*")==-1&&r.indexOf("/")==-1&&r.indexOf("%")==-1&&r.indexOf(">")==-1&&r.indexOf(">=")==-1&&r.indexOf("<")==-1&&r.indexOf("<=")==-1&&r.indexOf("==")==-1?this.formulaTextCharacter+=r:this.formulaTextCharacter+="("+r+")"}}var i=this.formulaTextCharacter;return this.funcType!=0&&(i=this.getFormulaTextCharacterBody()),i}getFormulaTextValue(){if(this.funcType==0){if(this.operator=="="&&this.getFunctionLength()>0){const i=this.getFunction(this.isFunctionId);i?this.formulaTextValue="("+i.getFormulaTextValue()+")":this.formulaTextValue=""}else{this.formulaTextValue="";for(var t=0;t<this.tree.length;t++){var r=this.tree[t].getFormulaTextValue();t<this.tree.length-1?this.formulaTextValue+="("+r+")"+(this.operator||""):r.indexOf("+")==-1&&r.indexOf("-")==-1&&r.indexOf("*")==-1&&r.indexOf("/")==-1&&r.indexOf("%")==-1&&r.indexOf(">")==-1&&r.indexOf(">=")==-1&&r.indexOf("<")==-1&&r.indexOf("<=")==-1&&r.indexOf("==")==-1?this.formulaTextValue+=r:this.formulaTextValue+="("+r+")"}}return this.formulaTextValue}else return this.getFormulaTextValueBody()}dispose(){for(var t=0;t<this.tree.length;t++)this.tree[t].dispose()}},OperationBody=class extends BasicBody{constructor(){super();n(this,"type","OperationBody");n(this,"constructorName","OperationBody");n(this,"isFunction",!1)}},FormulaData=class{constructor(e,t,r){n(this,"name");n(this,"x");n(this,"y");n(this,"body",null);n(this,"type","Formula");n(this,"cacheTargetStoragePool",null);n(this,"cacheTargetFolder",null);n(this,"constructorName","FormulaData");n(this,"id",0);this.name=e,this.x=t,this.y=r,this.cacheTargetStoragePool=fx.targetStoragePool,this.cacheTargetFolder=fx.targetFolder.formulaTree,this.cacheTargetStoragePool.push(this),this.cacheTargetFolder.push(this),this.id=++EventManager.IDINDEX}getValue(){return this.body!=null?getCatchValue(this.body):0}dispose(){let e=this.cacheTargetStoragePool.indexOf(this);e>=0&&this.cacheTargetStoragePool.splice(e,1),e=this.cacheTargetFolder.indexOf(this),this.cacheTargetFolder.splice(e,1)}},Player=class{constructor(){n(this,"name","");n(this,"hp",0);n(this,"maxHp",0);n(this,"maxShield",0);n(this,"shield",0);n(this,"enemyBody",null);n(this,"battlePool",[]);n(this,"valist",[]);n(this,"lflist",[]);n(this,"brlist",[]);n(this,"instantiation",null);n(this,"playerData",null);n(this,"folder",null);n(this,"comboxMaxHp","未设置血量公式");n(this,"combBoxAttack","未设置攻击公式");n(this,"underAttackName","");n(this,"shieldRuptureName","");n(this,"isShieldDetection",!1);n(this,"dieName","");n(this,"isDie",!1);n(this,"delayCustomList",[]);n(this,"callCenter",null);n(this,"tagArray",[]);n(this,"id",0);n(this,"constructorName","Player");n(this,"attackNum",0);n(this,"level",1);n(this,"levelVar","");n(this,"maxLEvel",100);n(this,"exp",0);n(this,"expName","");n(this,"levelUpConfig",{});n(this,"parameterInfoArray",[]);this.name="",this.hp=0,this.maxHp=0,this.maxShield=0,this.shield=0,this.enemyBody=null,this.level=1,this.levelVar="",this.battlePool=[],this.valist=[],this.lflist=[],this.brlist=[],this.instantiation=null,this.playerData=null,this.updatePlayerData(),this.comboxMaxHp="未设置血量公式",this.combBoxAttack="未设置攻击公式",this.underAttackName="",this.shieldRuptureName="",this.isShieldDetection=!1,this.dieName="",this.isDie=!1,this.delayCustomList=[],this.callCenter=new CallCenter,this.callCenter.addEventListener(EventManager.UP_DATA_PLAYER,this.upDataPlayerFunction,null,this),this.tagArray=[],this.id=++EventManager.IDINDEX,this.constructorName="Player",this.attackNum=0}resetTag(){this.tagArray=[]}gesetTagPopulation(e){let t=0;for(let r=0;r<this.tagArray.length;r++)this.tagArray[r].name==e&&t++;return t}gesetTagAll(){return this.tagArray}addTag(e){this.tagArray.push({name:e})}upDataPlayerFunction(e){this.updatePlayerData()}updatePlayerData(){fx.player=this,this.attackNum=0,this.playerData=this.createPlayer()}recursionSet(e,t){fx.player=this;for(let r=0;r<e.length;r++)e[r]instanceof VariableValue?e[r].enemyFlag&&(t==null?e[r].setEnemyBody(null):e[r].setEnemyBody(t.getPropertyObject(e[r].source.absoluteAddress))):this.recursionSet(e[r].tree,t)}getFormula(e){fx.player=this,fx.clearCacheRecursion(this.folder);let t=0;for(let r=0;r<this.playerData.formulaTree.length;r++)if(this.playerData.formulaTree[r].name==e){t=this.playerData.formulaTree[r].body.getValue();break}for(let r=0;r<fx.stageStoragePool.length;r++)fx.stageStoragePool[r]instanceof FormulaData&&fx.stageStoragePool[r].name==e&&(t=fx.stageStoragePool[r].body.getValue());return t}delay(e,t,r,i){const s=e+"次数";this[""+e]==null&&(this[""+e]=0,this.delayCustomList.push(""+e)),this[""+s]==null&&(this[""+s]=0,this.delayCustomList.push(""+s)),this[""+e]++,this[""+e]>=t&&Number(this[""+s])<=Number(r)+1&&(this[""+e]=0,this[""+s]++,i())}hit(e,t,r){this.instantiation!=null}attack(e,t){this.attackNum++,fx.player=this,fx.clearCacheRecursion(this.folder),fx.isCrit=!1;let r=0,i=0;for(let s=0;s<this.playerData.formulaTree.length;s++)if(this.playerData.formulaTree[s].name==e){fx.enemyBody=t,this.enemyBody=t,r=this.playerData.formulaTree[s].body.getValue();let u=t.isDie;t.getShield()!=0?t.minusShield(r):t.minusHp(r),!u&&t.isDie&&i++,fx.enemyBody=null;break}for(let s=0;s<fx.stageStoragePool.length;s++)if(fx.stageStoragePool[s]instanceof FormulaData&&fx.stageStoragePool[s].name==e){fx.enemyBody=t,this.enemyBody=t,r=fx.stageStoragePool[s].body.getValue();let u=t.isDie;t.getShield()!=0?t.minusShield(r):t.minusHp(r),!u&&t.isDie&&i++,fx.enemyBody=null}return i>0&&this.onEnmeyKilled(i),[r,fx.isCrit]}getNeedExp(){return 1}onEnmeyKilled(e){this.exp+=e,this.checkUpdateLevel()}checkUpdateLevel(){let e=this.getNeedExp();this.exp>=e&&this.level<this.maxLEvel&&(this.level++,this.exp=0,fx.Call.send(EventManager.PLAYER_INSTANCE_LEVEL_UP,[this.id,this.level,this.exp]))}setMaxShield(e){fx.player=this,fx.clearCacheRecursion(this.folder),this.maxShield=0,this.shield=0;for(let t=0;t<this.playerData.formulaTree.length;t++)if(this.playerData.formulaTree[t].name==e){this.maxShield=this.playerData.formulaTree[t].body.getValue(),this.shield=this.maxShield;break}for(let t=0;t<fx.stageStoragePool.length;t++)fx.stageStoragePool[t]instanceof FormulaData&&fx.stageStoragePool[t].name==e&&(this.maxShield=fx.stageStoragePool[t].body.getValue(),this.shield=this.maxShield);return e=="无"&&(this.maxShield=this.shield=0),this.isShieldDetection=!1,this.maxShield}setMaxHp(e){fx.player=this,fx.clearCacheRecursion(this.folder),this.maxHp=0,this.hp=0;for(let t=0;t<this.playerData.formulaTree.length;t++)if(this.playerData.formulaTree[t].name==e){this.maxHp=this.playerData.formulaTree[t].body.getValue(),this.hp=this.maxHp;break}for(let t=0;t<fx.stageStoragePool.length;t++)fx.stageStoragePool[t]instanceof FormulaData&&fx.stageStoragePool[t].name==e&&(this.maxHp=fx.stageStoragePool[t].body.getValue(),this.hp=this.maxHp);e=="无"&&(this.maxHp=this.hp=0),this.isDie=!1;for(let t=0;t<this.delayCustomList.length;t++)this[this.delayCustomList[t]]=null;return this.maxHp}getMaxHp(){return this.maxHp}getMaxShield(){return this.maxShield}getShield(){return this.shield}getHp(){return this.hp}setHp(e){this.hp=e}setShield(e){this.shield=e}underAttack(){this.getFormula(this.underAttackName)}setshieldRupture(e){this.shieldRuptureName=e}setUnderAttack(e){this.underAttackName=e}shieldRupture(){this.getFormula(this.shieldRuptureName),this.isShieldDetection=!0}minusShield(e){return this.shield-=e,this.shield<=0&&this.isShieldDetection==!1&&(this.shield=0,this.shieldRupture()),this.underAttack(),this.shield}setDie(e){this.dieName=e}die(){this.getFormula(this.dieName),this.isDie=!0}minusHp(e){return this.hp-=e,this.hp<=0&&this.isDie==!1&&(this.hp=0,this.die()),this.underAttack(),this.hp}getBillboard(){fx.player=this;const e=[];return fx.recursionGetBillboard(e,this.playerData),e.length==0?fx.billBoardList:e}getPropertyObject(e,t){return fx.player=this,fx.getBody(this.playerData,fx.parseAbsoluteAddress(e),t)}setProperty(e,t){fx.player=this;const r=this.getPropertyObject(e);return r!=null?r.setValue(t):console.log("没有找到属性"),t}getProperty(e,t){return fx.player=this,fx.clearCache(),this.getPropertyObject(e)!=null?fx.getBody(this.playerData,fx.parseAbsoluteAddress(e),t).getValue():(console.log("没有找到属性"),0)}dispose(){this.callCenter.dispose(),this.playerData.dispose(),this.name=null,this.hp=null,this.maxHp=null,this.playerData=null,this.callCenter=null,this.tagArray=null,this.id=null,this.constructorName=null,this.attackNum=null}clearCache(){fx.player=this,fx.clearCacheRecursion(this.folder)}createPlayer(){this.attackNum=0,fx.editBody=null,fx.selectBody=null,fx.isBodyView=!1,this.folder=new fx.Folder;const e=[];fx.addLibraryBody(e,fx.targetFolder.tree);const t=e;return fx.targetFolder=this.folder,fx.createLibraryBody(t,!0),fx.parseLibraryBody(t,!0),fx.recursionSyncBody(fx.targetFolder.tree),fx.editBody=null,fx.selectBody=null,fx.targetStoragePool=fx.stageStoragePool,fx.targetFolder=fx.sceneFolder,fx.isBodyView=!0,this.valist=[],this.lflist=[],this.brlist=[],fx.recursiveDataReading(this.folder,this.valist,this.lflist,this.brlist),this.folder}recoveryAttribute(){for(let e=0;e<this.valist.length;e++)this.setProperty(this.valist[e].absoluteAddress,Number(this.valist[e].value))}setParameterInfoArray(e){this.parameterInfoArray=e}getParameterInfoArray(){return this.parameterInfoArray}findParameterInfoByName(e){return this.parameterInfoArray.find(t=>t.parameterInfoname===e)||null}updateParameterValue(e,t,r){const i=this.findParameterInfoByName(e);if(!i)return!1;for(const s of i.parameterInfoArray)for(const u of s.parameter)if(u.path===t)return u.value=r,!0;return!1}getParameterValue(e,t){const r=this.findParameterInfoByName(e);if(!r)return null;for(const i of r.parameterInfoArray)for(const s of i.parameter)if(s.path===t)return s.value;return null}changeLevelAndOccupation(e,t,r={levelPath:"等级",occupationPath:"职业"}){const i=this.findParameterInfoByName(this.name);if(!i){console.warn(`未找到玩家 "${this.name}" 的参数信息`);return}for(const s of i.parameterInfoArray)for(const u of s.parameter)u.path===r.levelPath?u.value=e:u.path===r.occupationPath&&(u.value=t);this.level=e,this.gameManualOverrideParameter(i)}gameManualOverrideParameter(e){const t=this.getBillboard();e.parameterInfoArray.forEach(r=>{r&&t.forEach(i=>{r.name===i.name&&r.parameter.forEach(s=>{const u=s.path;i.metadataArray.forEach(h=>{const o=[];if(fx.getStepData(h.body.source,o),o.toString()===u){const d=h.body.getValue(),l=Number(s.value);d!==l&&h.body.setGlobalValue(l)}})})})})}},BillboardLayer=class{constructor(e){n(this,"name","");n(this,"operationArray",[]);n(this,"metadataArray",[]);n(this,"id",0);n(this,"monitored",!0);n(this,"constructorName","BillboardLayer");this.name=e,this.id=++EventManager.IDINDEX}dispose(){this.name=null,this.operationArray=null,this.metadataArray=null,this.monitored=null}pushOperationLayer(){if(fx.clickBody!=null&&fx.clickBody.type==5){const e=new fx.OperationLayerData(fx.clickBody);this.operationArray.push(e)}fx.clickBody=null}pushMetadata(e,t,r,i,s){if(fx.clickBody!=null&&fx.clickBody instanceof fx.VariableValue&&fx.clickBody.type!=5){const u=new fx.MetadataData(fx.clickBody);u.type=e,u.presentValue=getCatchValue(u.body),u.minValue=t,u.maxValue=r,u.intervalValue=i,u.list=s&&s.length?s.map(h=>({value:Number(h.value),name:h.name})):[],this.metadataArray.push(u)}fx.clickBody=null}},ChartsLayer=class{constructor(e){n(this,"name");n(this,"operationArray",[]);n(this,"metadata",null);n(this,"metadataArray",[]);n(this,"minValue",1);n(this,"maxValue",1);n(this,"intervalValue",1);n(this,"constructorName","ChartsLayer");n(this,"id");this.name=e,this.id=++EventManager.IDINDEX}addMetadataData(){fx.clickBody!=null&&(this.metadata=fx.clickBody.copy(),this.metadataArray[0]=this.metadata)}dispose(){}},Bookmark=class{constructor(){n(this,"id",0);n(this,"x",0);n(this,"y",0);n(this,"width",512);n(this,"height",512);n(this,"text","标签");n(this,"view",null);n(this,"type","Bookmark");n(this,"bookmarkView",null)}},MetadataData=class{constructor(e){n(this,"body");n(this,"view",null);n(this,"type",0);n(this,"presentValue",0);n(this,"minValue",0);n(this,"maxValue",0);n(this,"intervalValue",0);n(this,"list");this.body=e.copy()}},SheetData=class{constructor(e){n(this,"originData");this.originData=e}setData(e){this.originData=e}getValue(e,t,r){var l,p,y;if(!(this!=null&&this.originData)||typeof e>"u"||typeof t>"u"||typeof r>"u")return;const u=this.originData.sheets.find(g=>g.name===e),h=u.uniqueInfo.find(g=>g.row===t&&g.col===r),o=(l=u==null?void 0:u.data)==null?void 0:l.get(`${t},${r}`),c=o==null?void 0:o.cellData;let d=c==null?void 0:c.v;return c!=null&&c.type&&(d=(p=o==null?void 0:o.source)!=null&&p.getValue?(y=o.source)==null?void 0:y.getValue():0),(h==null?void 0:h.value)||d||0}},OperationLayerData=class{constructor(e){n(this,"body");n(this,"view",null);this.body=e.copy()}},Message=class{constructor(){n(this,"userData",null);n(this,"type",null)}},globalThis_=function(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{}}();globalThis_.target=null;var A=class{test(){try{console.log("console A")}catch(e){console.error("Error in class A test:",e)}}},B=class extends A{constructor(){super()}test(){try{console.log("console B")}catch(e){console.error("Error in class B test:",e)}}},fx=(a=class{static recursiveDataReading(t,r,i,s){try{if(!t||!t.tree||!Array.isArray(t.tree))throw new Error("Invalid object structure for recursive reading");for(let u=0;u<t.tree.length;u++){const h=t.tree[u];h!=null&&(h.isFolder?this.recursiveDataReading(h,r,i,s):h.type==1?r.push(h):h.type==5?i.push(h):h instanceof a.BillboardLayer&&s.push(h))}}catch(u){console.error("Error in recursive data reading:",u)}}},n(a,"b",new B),n(a,"code",!1),n(a,"isNumber",function(t){try{return!isNaN(Number(t))&&isFinite(Number(t))}catch(r){return console.error("Error checking if value is number:",r),!1}}),n(a,"mix",function(t,r,i){try{if(!a.isNumber(t)||!a.isNumber(r)||!a.isNumber(i))throw new Error("Invalid parameters for mix function");return t*(1-i)+r*i}catch(s){return console.error("Error in mix function:",s),0}}),n(a,"cross",function(t,r,i,s){try{if(!a.isNumber(t)||!a.isNumber(r)||!a.isNumber(i)||!a.isNumber(s))throw new Error("Invalid parameters for cross function");return t*i-r*s}catch(u){return console.error("Error in cross function:",u),0}}),n(a,"dot",function(t,r,i,s){try{if(!a.isNumber(t)||!a.isNumber(r)||!a.isNumber(i)||!a.isNumber(s))throw new Error("Invalid parameters for dot function");return t*i+r*s}catch(u){return console.error("Error in dot function:",u),0}}),n(a,"distance",function(t,r,i,s){try{if(!a.isNumber(t)||!a.isNumber(r)||!a.isNumber(i)||!a.isNumber(s))throw new Error("Invalid parameters for distance function");const u=Math.abs(t-i),h=Math.abs(r-s);return a.length(u,h)}catch(u){return console.error("Error in distance function:",u),0}}),n(a,"length",function(t,r){try{if(!a.isNumber(t)||!a.isNumber(r))throw new Error("Invalid parameters for length function");return Math.sqrt(t*t+r*r)}catch(i){return console.error("Error in length function:",i),0}}),n(a,"billBoardList",[]),n(a,"functionAddIndex",0),n(a,"visualVersionCompatibility",!1),n(a,"singletonInstance",null),n(a,"isStart",!1),n(a,"FXCentre",FXCentre),n(a,"NodeType",NodeType),n(a,"Folder",Folder),n(a,"Eve",EventManager),n(a,"CallCenter",CallCenter),n(a,"MessageList",MessageList),n(a,"VariableValue",VariableValue),n(a,"Call",Call),n(a,"SymbolBody",SymbolBody),n(a,"BasicBody",BasicBody),n(a,"OperationBody",OperationBody),n(a,"Player",Player),n(a,"BillboardLayer",BillboardLayer),n(a,"ChartsLayer",ChartsLayer),n(a,"Bookmark",Bookmark),n(a,"FormulaData",FormulaData),n(a,"MetadataData",MetadataData),n(a,"SheetData",SheetData),n(a,"OperationLayerData",OperationLayerData),n(a,"Message",Message),n(a,"noCache",!1),n(a,"enemyBody",null),n(a,"sceneFolder",null),n(a,"targetFolder",null),n(a,"isFolderDuplicationOfName",!1),n(a,"isBillboardLayerView",!0),n(a,"isBodyView",!0),n(a,"isGlobalOperations",!1),n(a,"isDragBody",!1),n(a,"stageMaskValue",{}),n(a,"stageGroup",null),n(a,"clickBody",null),n(a,"selectCellBody",null),n(a,"editBody",null),n(a,"selectBody",null),n(a,"stageStoragePool",[]),n(a,"targetStoragePool",a.stageStoragePool),n(a,"player",null),n(a,"isCrit",!1),n(a,"distribute",function(t,r){const i=r.reduce((s,u)=>s+u,0);return r.map(s=>t*s/i)}),n(a,"partitionCurve",function(t,r,i,s,u,h){var o=[],c=[],d=u,l=h;d==null&&(d=.382),l==null&&(l=.618);for(var p=0,y=1;y<=r;y++){var g=Math.pow(r,i),V=Math.pow(y,i),T=V/g,m=y*(1e4*d)/r+T*(1e4*l);o.push(m),p+=m}for(var D=0;D<o.length;D++)if(s==null)c.push(o[D]/p*t);else switch(s){case 0:c.push(o[D]/p*t);break;case 1:c.push(Math.floor(o[D]/p*t));break;case 2:c.push(Math.floor(o[D]/p*t));break}return c}),n(a,"eval",function(t){return a.evaluateExpression(t)}),n(a,"recursionLibraryBody",function(t,r,i){if(r.tree==null)return null;for(var s=0;s<r.tree.length;s++){if(r.tree[s].absoluteAddress==i){t.push(r.tree[s]);return}a.recursionLibraryBody(t,r.tree[s],i)}return null}),n(a,"double",function(t,r){switch(r){case 0:return Math.round(t*1)/1;case 1:return Math.round(t*10)/10;case 2:return Math.round(t*100)/100;case 3:return Math.round(t*1e3)/1e3;case 4:return Math.round(t*1e4)/1e4;case 5:return Math.round(t*1e5)/1e5;case 6:return Math.round(t*1e6)/1e6;case 7:return Math.round(t*1e7)/1e7}return 0}),n(a,"getLibraryBody",function(t,r,i){for(var s=0;s<r.length;s++){if(r[s].absoluteAddress==null&&(r[s].absoluteAddress=a.getAbsoluteAddress(r[s])),r[s].absoluteAddress==i){t.push(r[s]);return}r[s].isFolder&&a.getLibraryBody(t,r[s].tree,i)}}),n(a,"mapToJSON",function(t){return t?JSON.stringify([...t].reduce((r,[i,s])=>{const u={...s},h=u.source;if(h){const o=a.createVarData(h.TID,h.name,h.value,h.type,h.macros,h.operator,h.enemyFlag,h.source,h.tag,h.statistics,h.upDateValue,h.demoteValue,h.funcType,h.isLogicalOpen,h.isDragging,h.currentStep,h.snNo,h.minValue,h.maxValue,h.step,h.logicalChildArray,h.selectedOutputInfo);u.source=o}return r[i]=u,r},{})):"{}"}),n(a,"addLibraryBody",function(t,r){var c;for(var i=0;i<r.length;i++){let d=r[i],l=(c=d.sheetData)==null?void 0:c.originData;if(l&&(l={...l},l.sheets=[...l.sheets.map(p=>({...p,data:a.mapToJSON(p.data)}))]),d instanceof a.VariableValue){var s=a.createOperationLayerData(d.name,d.type,d.value,d,d.tag,d.isSystemShow,d.sheetData?JSON.stringify(l):null,d.childCell);s.id=d.id,t.push(s),a.saveBody(s.operationArray,a.seekSource(d.childBodyArray))}if(d instanceof a.Folder){var s=a.createFolderData(d.name,d.isFolder,d);s.id=d.id,t.push(s),a.addLibraryBody(s.operationArray,d.tree)}if(a.isBillboardLayerView){if(d instanceof a.BillboardLayer){var s=a.createBillboarData(d.name,d,d.monitored);s.id=d.id,t.push(s);for(var u=0;u<d.operationArray.length;u++){let y=d.operationArray[u];var h=a.createOperationLayerData(y.body.name,y.body.type,y.body.value,y.body.source,y.body.tag,y.body.isSystemShow,null,null);h.id=y.body.id,s.operationArray.push(h)}for(var u=0;u<d.metadataArray.length;u++){const g=d.metadataArray[u];var o=a.createBillboarMetadataData(g.body.name,g.body.type,g.body.value,g.body.source,g);o.id=g.body.id,s.metadataArray.push(o)}}if(d instanceof a.ChartsLayer){var s=a.createChartData(d);s.id=d.id,t.push(s)}}}}),n(a,"parseLibraryBody",function(t,r){for(var i=0;i<t.length;i++){const o=t[i];if(o.type==5){var s=[];a.getLibraryBody(s,a.targetFolder.tree,o.site),a.editBody=s[0],a.selectBody=a.editBody,a.targetStoragePool=a.editBody.childBodyArray,a.editBody.isSystemShow=o.isSystemShow,a.parseStageBody(o.operationArray)}else if(o.type==0||o.type==1||o.type==2||o.type==3){var s=[];a.getLibraryBody(s,a.targetFolder.tree,o.site),a.editBody=s[0],a.selectBody=a.editBody,a.targetStoragePool=a.stageStoragePool,a.parseStageBody(o.operationArray)}else if(o.isFile==!0){var s=[];a.getLibraryBody(s,a.targetFolder.tree,o.site),a.editBody=s[0];for(var u=s[0],h=0;h<o.operationArray.length;h++){const d=o.operationArray[h];if(d.type==5){var s=[];a.getLibraryBody(s,a.targetFolder.tree,d.site),a.editBody=s[0],a.selectBody=s[0],a.targetStoragePool=s[0].childBodyArray,a.parseStageBody(d.operationArray),a.editBody=u,a.editBody.isSystemShow=d.isSystemShow}else d.isBoard==!0?(a.selectBody=a.editBody,d.index=h,a.Call.send(a.Eve.SHIFT_ADD_BOARD,d,null)):d.isXlsx==!0&&(a.selectBody=a.editBody,d.index=h,a.Call.send(a.Eve.SHIFT_ADD_CHARTS,d,null));if(d.isFile==!0){var s=[];a.getLibraryBody(s,a.targetFolder.tree,d.site),a.editBody=s[0],a.parseLibraryBody(d.operationArray,!1)}}a.editBody=null}else o.isBoard==!0?(a.selectBody=a.editBody,a.billBoardList.push(o),a.Call.send(a.Eve.SHIFT_ADD_BOARD,o,null)):o.isXlsx==!0&&(a.selectBody=a.editBody,a.Call.send(a.Eve.SHIFT_ADD_CHARTS,o,null));r&&(a.selectBody=null)}}),n(a,"createLibraryBody",function(t,r,i,s){for(var u=0;u<t.length;u++){const l=t[u];if(l.isFile==!0){var h=new a.Folder(l.name);a.Call.send(a.Eve.CREATE_FILE_DATA,h,null),s!=null?(a.Call.send(a.Eve.ADD_DATABASE_DATA,[h,s],null),a.Call.send(a.Eve.SHIFT_REFRESH_LIBRARY_COORDINATES,[h,s],null)):(a.Call.send(a.Eve.ADD_DATABASE_DATA,[h,a.selectBody],null),a.Call.send(a.Eve.SHIFT_REFRESH_LIBRARY_COORDINATES,[h,a.selectBody],null)),a.selectBody=h,a.selectBody.absoluteAddress=l.site;for(var o=0;o<l.operationArray.length;o++){const p=l.operationArray[o];if(p.type==5)a.editBody=new a.VariableValue(p.name,null,5),a.editBody.tag=p.name.tag,a.Call.send(a.Eve.CREATE_OPERATION_DATA,a.editBody,null),a.Call.send(a.Eve.ADD_DATABASE_DATA,[a.editBody,a.selectBody],null),a.Call.send(a.Eve.SHIFT_REFRESH_LIBRARY_COORDINATES,[a.editBody,a.selectBody],null),a.editBody.absoluteAddress=p.site,a.targetStoragePool=a.editBody.childBodyArray;else if(p.type==0||p.type==1||p.type==2||p.type==3){var c=p.name+"="+p.value,d=new a.VariableValue(c.split("=")[0],c.split("=")[1],1);p.type==1&&(d.isAI=i||!1),a.editBody=d,a.editBody.tag=p.tag,a.Call.send(a.Eve.CREATE_METADATE_DATA,d,null),a.Call.send(a.Eve.ADD_DATABASE_DATA,[a.editBody,a.selectBody],null),a.Call.send(a.Eve.SHIFT_REFRESH_LIBRARY_COORDINATES,[a.editBody,a.selectBody],null),a.editBody.absoluteAddress=p.site,a.targetStoragePool=a.editBody.childBodyArray}else if(p.type==11){var c=p.name,d=new a.VariableValue(c.split("=")[0],void 0,p.type);d.selectedOutputInfo=p!=null&&p.selectedOutputInfo?JSON.parse(p==null?void 0:p.selectedOutputInfo):null;const V=typeof p.sheetData=="string"?JSON.parse(p.sheetData):p.sheetData;V!=null&&V.sheets&&(V.sheets=V.sheets.map(T=>{const m=JSON.parse(T.data);return Object.values(m).forEach(D=>{if(D!=null&&D.source){const I=D.source;var f=[];a.getLibraryBody(f,a.targetFolder.tree,a.getAbsoluteAddress(I));var x=f[0];D.source=x.copy()}}),{...T,data:new Map(Object.entries(m))}})),d.setSheetData(V),d.childCell=p.childCell,a.editBody=d,a.editBody.tag=p.tag,a.Call.send(a.Eve.ADD_DATABASE_DATA,[a.editBody,a.selectBody],null),a.Call.send(a.Eve.SHIFT_REFRESH_LIBRARY_COORDINATES,[a.editBody,a.selectBody],null),a.editBody.absoluteAddress=p.site,a.targetStoragePool=a.editBody.childBodyArray}if(p.isFile==!0){var h=new a.Folder(p.name);a.Call.send(a.Eve.CREATE_FILE_DATA,h,null),a.Call.send(a.Eve.ADD_DATABASE_DATA,[h,a.selectBody],null),a.Call.send(a.Eve.SHIFT_REFRESH_LIBRARY_COORDINATES,[h,a.selectBody],null),a.selectBody=h,a.selectBody.absoluteAddress=p.site,a.createLibraryBody(p.operationArray,!1,!1,h),a.selectBody=h.parentFolder}}a.selectBody=h.parentFolder}if(l.type==5)a.editBody=new a.VariableValue(l.name,null,5),a.editBody.tag=l.tag,a.editBody.isSystemShow=l.isSystemShow,a.Call.send(a.Eve.CREATE_OPERATION_DATA,a.editBody,null),a.Call.send(a.Eve.ADD_DATABASE_DATA,[a.editBody,a.selectBody],null),a.Call.send(a.Eve.SHIFT_REFRESH_LIBRARY_COORDINATES,[a.editBody,a.selectBody],null),a.editBody.absoluteAddress=l.site,a.targetStoragePool=a.editBody.childBodyArray;else if(l.type==0||l.type==1||l.type==2||l.type==3){var c=l.name+"="+l.value,d=new a.VariableValue(c.split("=")[0],c.split("=")[1],1);l.type==1&&(d.isAI=i||!1),a.editBody=d,a.editBody.tag=l.tag,a.Call.send(a.Eve.CREATE_METADATE_DATA,d,null),a.Call.send(a.Eve.ADD_DATABASE_DATA,[a.editBody,a.selectBody],null),a.Call.send(a.Eve.SHIFT_REFRESH_LIBRARY_COORDINATES,[a.editBody,a.selectBody],null),a.editBody.absoluteAddress=l.site,a.targetStoragePool=a.editBody.childBodyArray}else if(l.type==11){var c=l.name,d=new a.VariableValue(c.split("=")[0],void 0,l.type);d.selectedOutputInfo=l!=null&&l.selectedOutputInfo?JSON.parse(l==null?void 0:l.selectedOutputInfo):null;const g=typeof l.sheetData=="string"?JSON.parse(l.sheetData):l.sheetData;g!=null&&g.sheets&&(g.sheets=g.sheets.map(V=>{const T=JSON.parse(V.data);return Object.values(T).forEach(m=>{if(m!=null&&m.source){const x=m.source;var D=[];a.getLibraryBody(D,a.targetFolder.tree,a.getAbsoluteAddress(x));var f=D[0];m.source=f.copy()}}),{...V,data:new Map(Object.entries(T))}})),d.setSheetData(g),d.childCell=l.childCell,a.editBody=d,a.editBody.tag=l.tag,a.Call.send(a.Eve.ADD_DATABASE_DATA,[a.editBody,a.selectBody],null),a.Call.send(a.Eve.SHIFT_REFRESH_LIBRARY_COORDINATES,[a.editBody,a.selectBody],null),a.editBody.absoluteAddress=l.site,a.targetStoragePool=a.editBody.childBodyArray}r&&(a.selectBody=null)}}),n(a,"getBody",function(t,r,i){var s=[];return a.recursionLibraryBody(s,t,r),i!=null&&s[0].body.setFunctionId(i),s[0]}),n(a,"evaluateExpression",function(t){var r=a.toRPN(t),i=[];for(let s of r)if(a.isNumber(s))i.push(Number(s));else{const u=i.pop(),h=i.pop();let o;if(h!==void 0&&u!==void 0)switch(s){case"+":o=h+u;break;case"-":o=h-u;break;case"*":o=h*u;break;case"/":o=h/u;break;case"%":o=h%u;break;case"^":o=Math.pow(h,u);break;case">":o=h>u;break;case"<":o=h<u;break;case">=":o=h>=u;break;case"<=":o=h<=u;break;case"==":o=h===u;break;case"!=":o=h!==u;break}i.push(o)}return i.pop()}),n(a,"toRPN",function(t){t=t+"",t=t.replace(/\s+/g,"");var r={"+":1,"-":1,"*":2,"/":2,"%":2,"^":3,">":4,"<":4,">=":4,"<=":4,"==":4,"!=":4},i=[],s=[];function u(p){i.push(p)}function h(){var p=s.pop();p&&u(p)}function o(p){return r.hasOwnProperty(p)}function c(p,y){return p==="-"&&y===0||p==="-"&&!a.isNumber(t[y-1])&&t[y-1]!==")"}for(let p=0;p<t.length;p++){var d=t[p];if(a.isNumber(d)||c(d,p)){let y=d,g=p+1;for(;g<t.length&&(a.isNumber(t[g])||t[g]===".");)y+=t[g],g++;u(y),p=g-1}else if(o(d)){for(var l=s[s.length-1];o(l)&&(r[d]<=r[l]&&d!=="^"||r[d]<r[l]&&d==="^");)h(),l=s[s.length-1];s.push(d)}else if(d==="(")s.push(d);else if(d===")"){for(var l=s[s.length-1];l!=="("&&l!==void 0;)h(),l=s[s.length-1];s.pop()}}for(;s.length>0;)h();return i}),n(a,"Rectangle",class{constructor(r,i){n(this,"width");n(this,"height");this.width=r,this.height=i}calculateArea(){return this.width*this.height}calculatePerimeter(){return 2*(this.width+this.height)}}),n(a,"recursionSyncBody",function(t){for(var r=0;r<t.length;r++)t[r].type==5&&t[r].syncBody(),t[r].isFolder&&a.recursionSyncBody(t[r].tree)}),n(a,"clearCache",function(){a.clearCacheRecursion(a.sceneFolder)}),n(a,"clearCacheRecursion",function(t){for(var r=0;r<t.tree.length;r++){const i=t.tree[r];i.type==5&&(i.cacheValue=null),i.isFolder==!0&&a.clearCacheRecursion(i)}}),n(a,"initDataBase",function(t){a.isBillboardLayerView=!1,new a.FXCentre,JSON.parse(t).stage.operationArray;var r=JSON.parse(t).library.operationArray;a.editBody=null,a.selectBody=null,a.createLibraryBody(r,!0),a.parseLibraryBody(r,!0)}),n(a,"parseAbsoluteAddress",function(t){return t.replace(/\./g,"")}),n(a,"recursionGetBillboard",function(t,r){if(r.tree==null)return null;for(var i=0;i<r.tree.length;i++)r.tree[i]instanceof a.BillboardLayer&&t.push(r.tree[i]),a.recursionGetBillboard(t,r.tree[i]);return null}),n(a,"saveBody",function(t,r){for(var i=0;i<r.length;i++){const y=r[i];if(y.type=="OperationBody"){var s=0,u=0;y.view!=null&&(s=y.view.getX(),u=y.view.getY());var h=a.createBodyData(y.type,y.isFunction,y.isBindingOperation,s,u,y.isWeight,y.isAdvance,y.funcType);y.isBindingFormula&&(h.isFormula=!0,h.formulaName=y.formulaBody.name,h.formulaX=y.formulaBody.x,h.formulaY=y.formulaBody.y),h.id=y.id,t.push(h);for(var o=0;o<y.tree.length;o++){const g=y.tree[o];let V=a.createVarData(g.TID,g.name,g.value,g.type,g.macros,g.operator,g.enemyFlag,g.source,g.tag,g.statistics,g.upDateValue,g.demoteValue,g.funcType,g.isLogicalOpen,g.isDragging,g.currentStep,g.snNo,g.minValue,g.maxValue,g.step,g.logicalChildArray,g.selectedOutputInfo);V.id=g.id,h.tree.push(V)}}else if(y.type=="SymbolBody"){var s=0,u=0;y.view!=null&&(s=y.view.getX(),u=y.view.getY());var c=a.createSymbolData(y.type,y.operator,y.isFunctionId,y.isBindingOperation,s,u,y.isWeight,y.funcType);y.isBindingFormula&&(c.isFormula=!0,c.formulaName=y.formulaBody.name,c.formulaX=y.formulaBody.x,c.formulaY=y.formulaBody.y),c.id=y.id,t.push(c);for(var o=0;o<y.tree.length;o++){const m=y.tree[o];switch(m.type){case"OperationBody":var s=0,u=0;m.view!=null&&(s=m.view.getX(),u=m.view.getY());var l=a.createBodyData(m.type,m.isFunction,m.isBindingOperation,s,u,m.isWeight,m.isAdvance,m.funcType);l.id=m.id,c.tree.push(l);for(var d=0;d<m.tree.length;d++){const x=m.tree[d];let I=a.createVarData(x.TID,x.name,x.value,x.type,x.macros,x.operator,x.enemyFlag,x.source,x.tag,x.statistics,x.upDateValue,x.demoteValue,x.funcType,x.isLogicalOpen,x.isDragging,x.currentStep,x.snNo,x.minValue,x.maxValue,x.step,x.logicalChildArray,x.selectedOutputInfo);I.id=x.id,l.tree.push(I)}break;case"SymbolBody":var s=0,u=0;m.view!=null&&(s=m.view.getX(),u=m.view.getY());var l=a.createSymbolData(m.type,m.operator,m.isFunctionId,m.isBindingOperation,s,u,m.isWeight,m.funcType);l.id=m.id,c.tree.push(l),a.recursionSeekBody(l.tree,m.tree);break}}}else if(y.type=="Bookmark"){var p=a.createBookmarkData(y);p.id=y.id,t.push(p)}}}),n(a,"coordinateDetection",function(t){return t!=null?{x:t.getX(),y:t.getY()}:{x:0,y:0}}),n(a,"recursionSeekBody",function(t,r){for(var i=0;i<r.length;i++){const o=r[i];switch(o.type){case"OperationBody":var u=a.coordinateDetection(o.view),h=a.createBodyData(o.type,o.isFunction,o.isBindingOperation,u.x,u.y,o.isWeight,o.isAdvance,o.funcType);t.push(h);for(var s=0;s<o.tree.length;s++){const c=o.tree[s];h.tree.push(a.createVarData(c.TID,c.name,c.value,c.type,c.macros,c.operator,c.enemyFlag,c.source,c.tag,c.statistics,c.upDateValue,c.demoteValue,c.funcType,c.isLogicalOpen,c.isDragging,c.currentStep,c.snNo,c.minValue,c.maxValue,c.step,c.logicalChildArray,c.selectedOutputInfo))}break;case"SymbolBody":var u=a.coordinateDetection(o.view),h=a.createSymbolData(o.type,o.operator,o.isFunctionId,o.isBindingOperation,u.x,u.y,o.isWeight,o.funcType);t.push(h),a.recursionSeekBody(h.tree,o.tree);break}}}),n(a,"getAbsoluteAddress",function(t,r){if(r){var i=[];return a.getStepData(t,i,r),i.join(",")}if(t.site!=null&&t.site!=null)return t.site;if(t.parentFolder==null)return t.source!=null?t.source.absoluteAddress:t.name;var i=[];return a.getStepData(t,i,r),i.join(",")}),n(a,"copyHeadFun",function(t){return t.copyHead?!0:t.parentFolder!=null&&t.parentFolder.name!=null?a.copyHeadFun(t.parentFolder):!1}),n(a,"getStepData",function(t,r,i){r.unshift(t.name),t.parentFolder!=null&&t.parentFolder.name!=null&&a.getStepData(t.parentFolder,r,i)}),n(a,"getStepDataAll",function(t,r){r.unshift(t.name),t.parentFolder.name!=null&&a.getStepDataAll(t.parentFolder,r)}),n(a,"createVarData",function(t,r,i,s,u,h,o,c,d,l,p,y,g,V,T,m,D,f,x,I,v,S){var F={};return a.code,F.TID=t,F.name=r,F.value=i,F.type=s,F.macros=u,F.operator=h,F.enemy=o,F.tag=d,F.site=a.getAbsoluteAddress(c),F.statistics=l,F.upDateValue=p,F.demoteValue=y,F.funcType=g,F.isLogicalOpen=V,F.isDragging=T,F.currentStep=m,F.snNo=D,F.minValue=f,F.maxValue=x,F.step=I,F.logicalChildArray=[],F.selectedOutputInfo=typeof S=="object"?JSON.stringify(S):"",v&&v.length&&v.forEach(E=>{const N=a.createVarData(E.TID,E.name,E.value,E.type,E.macros,E.operator,E.enemyFlag,E.source,E.tag,E.statistics,E.upDateValue,E.demoteValue,E.funcType,E.isLogicalOpen,E.isDragging,E.currentStep,E.snNo,E.minValue,E.maxValue,E.step,E.logicalChildArray);F.logicalChildArray.push(N)}),F}),n(a,"createBodyData",function(t,r,i,s,u,h,o,c){var d={};return d.tree=[],d.type=t,d.isFunction=r,d.isBoundOutput=i,d.x=s,d.y=u,d.isWeight=h,d.isAdvance=o,d.funcType=c,d}),n(a,"createSymbolData",function(t,r,i,s,u,h,o,c){var d={};return d.tree=[],d.type=t,d.operator=r,d.isFunctionId=i,d.isBoundOutput=s,d.x=u,d.y=h,d.isWeight=o,d.funcType=c,d}),n(a,"createBookmarkData",function(t){var r={};return r.x=t.x,r.y=t.y,r.width=t.width,r.height=t.height,r.text=t.text,r.type=t.type,r}),n(a,"createChartData",function(t){var r={};if(r.name=t.name,r.minValue=t.minValue,r.maxValue=t.maxValue,r.intervalValue=t.intervalValue,r.operationlayer=[],r.metadataArray=[],r.isXlsx=!0,t.operationArray!=null)for(var i=0;i<t.operationArray.length;i++)r.operationlayer.push(a.getAbsoluteAddress(t.operationArray[i].source));(t.body!=null||t.metadata!=null)&&(r.metadata=a.getAbsoluteAddress(t.metadata.source));for(var i=0,s=t.metadataArray.length;i<s;i++){var u=t.metadataArray[i],h=u.source,o={site:a.getAbsoluteAddress(h)};u.minValue!=1&&(o.minValue=u.minValue),u.intervalValue!=1&&(o.intervalValue=u.intervalValue),r.metadataArray.push(o)}return r.site=a.getAbsoluteAddress(t),r}),n(a,"seekSource",function(t){for(var r=[],i=0;i<t.length;i++){const u=t[i];if(u.parent==null){if(r.length==0)r.push(u);else for(var s=0;s<r.length;s++)if(r[s]!=u){r.push(u);break}}}return r}),n(a,"createBillboarMetadataData",function(t,r,i,s,u){var h={};return h.name=t,h.type=r,h.value=i,h.site=a.getAbsoluteAddress(s),h.componentType=u.type,h.componentValue=u.body.value,h.componentMinValue=u.minValue,h.componentMaxValue=u.maxValue,h.componentIntervalValue=u.intervalValue,h.list=u.list,h}),n(a,"createOperationLayerData",function(t,r,i,s,u,h,o,c){var d={};return d.name=t,d.type=r,d.value=i,d.site=a.getAbsoluteAddress(s),d.tag=u,d.operationArray=[],r===11&&o&&(d.sheetData=o,d.childCell=c),d.isSystemShow=h,d}),n(a,"createBillboarData",function(t,r,i){var s={};return s.name=t,s.site=a.getAbsoluteAddress(r),s.isBoard=!0,s.operationArray=[],s.metadataArray=[],s.monitored=i,s}),n(a,"createFolderData",function(t,r,i){var s={};return s.name=t,s.isFile=r,s.operationArray=[],s.site=a.getAbsoluteAddress(i),s}),n(a,"getBout",function(t){if(t.tree.length>1){if(t.tree[0].getValue()!=0&&t.tree[1].getValue()!=0&&Number(t.tree[0].getValue())>Number(t.tree[1].getValue())){for(var r=Number(t.tree[0].getValue()),i=0,s=1;s<t.tree.length;s++)i+=Number(t.treeItem.getValue());for(var u=0,h=0;r>=i;)h+=i,r-=i,u++;return[u,h/u]}return[0,0]}return[0,0]}),n(a,"copy",function(t){var r={};for(var i in t)t.hasOwnProperty(i)&&(r[i]=typeof t[i]=="object"?a.copy(t[i]):t[i]);return r}),n(a,"getIsBoundOutput",function(t,r){return r!=null?!1:t.isBoundOutput!=null?t.isBoundOutput:t.isBindingOperation}),n(a,"coordinate",function(t,r){var i=1;return a.visualVersionCompatibility&&(i=.5),t.view!=null?t.parent==null?[0,0]:[t.view.getX()*i,t.view.getY()*i]:[t.x*i,t.y*i]}),n(a,"parseStageBody",function(t,r,i,s){for(var u=null,h=0;h<t.length;h++){const m=t[h];if(i==null&&m.parent!=null)return;if(m.type=="OperationBody"||m.type=="运算体类"){var o;if(m.isFunction){o=a.createOperationBody(a.coordinate(t[h],i)[0],a.coordinate(t[h],i)[1],1,m.isWeight,m.isAdvance,m.funcType),o.isBindingOperation=a.getIsBoundOutput(t[h],i),a.operationBindBody(o),u==null&&(u=o);for(var c=0;c<m.tree.length;c++){const D=m.tree[c];if(D.type==4){var d=new a.VariableValue(D.name,null,D.type);d.TID=D.TID,d.TID==null&&(d.TID=new Date().getTime()+a.functionAddIndex,a.functionAddIndex++);var l=a.createFunctionBody(o,d);l.setMacros(a.amendMacros(D)),l.enemyFlag=D.enemy,l.funcType=D.funcType,l.funcType==null&&(l.funcType=0),l.statistics=D.statistics,l.upDateValue=D.upDateValue,l.demoteValue=D.demoteValue,a.symbolicLink(l,D.operator),a.Call.send(a.Eve.SHIFT_SHOW_VIEW,[l,D.operator,r],null)}else if([12,16,14].includes(D.type)){var d=new a.VariableValue(D.name,D.value,D.type);d.TID=D.TID,d.TID==null&&(d.TID=new Date().getTime()+a.functionAddIndex,a.functionAddIndex++);var l=a.createFunctionBody(o,d);l.enemyFlag=D.enemy,l.funcType=D.funcType,l.funcType==null&&(l.funcType=0),D.type==11&&(l.selectedOutputInfo=D.selectedOutputInfo?JSON.parse(D.selectedOutputInfo):""),l.statistics=D.statistics,l.upDateValue=D.upDateValue,l.demoteValue=D.demoteValue,l.isLogicalOpen=D.isLogicalOpen,l.isDragging=D.isDragging,l.snNo=D.snNo,l.logicalNumberList=D.logicalNumberList,l.currentStep=D.currentStep,l.snNo=D.snNo,l.minValue=D.minValue,l.maxValue=D.maxValue,l.step=D.step,l.logicalChildArray=[],D.logicalChildArray.forEach(I=>{var v=[];a.getLibraryBody(v,a.targetFolder.tree,a.getAbsoluteAddress(I));var S=v[0],F=S.copy();F.enemyFlag=D.enemy,F.funcType=D.funcType,F.funcType==null&&(F.funcType=0),F.statistics=D.statistics,F.upDateValue=D.upDateValue,F.demoteValue=D.demoteValue,l.logicalChildArray.push(F)}),a.symbolicLink(l,D.operator),a.Call.send(a.Eve.SHIFT_SHOW_VIEW,[l,D.operator,r],null)}else{var p=[];s?a.getLibraryBody(p,a.targetFolder.tree,a.getAbsoluteAddress(D.source)):a.getLibraryBody(p,a.targetFolder.tree,a.getAbsoluteAddress(D));var y=p[0],l=a.createVariableBody(o,y);l.enemyFlag=D.enemy,l.funcType=D.funcType,l.funcType==null&&(l.funcType=0),D.type==11&&(l.selectedOutputInfo=D.selectedOutputInfo?JSON.parse(D.selectedOutputInfo):""),l.statistics=D.statistics,l.upDateValue=D.upDateValue,l.demoteValue=D.demoteValue,a.symbolicLink(l,D.operator),a.Call.send(a.Eve.SHIFT_SHOW_VIEW,[l,D.operator,r],null)}}a.Call.send(a.Eve.SHIFT_SHOW_VIEW_ON,[o,r],null)}else{o=a.createOperationBody(a.coordinate(t[h],i)[0],a.coordinate(t[h],i)[1],0,m.isWeight,m.isAdvance,m.funcType),o.isBindingOperation=a.getIsBoundOutput(t[h],i),a.operationBindBody(o),u==null&&(u=o);for(var c=0;c<m.tree.length;c++){const f=m.tree[c];if(f.type==4){var d=new a.VariableValue(f.name,null,f.type);d.TID=f.TID,d.TID==null&&(d.TID=new Date().getTime()+a.functionAddIndex,a.functionAddIndex++);var l=a.createFunctionBody(o,d);l.setMacros(a.amendMacros(f)),l.enemyFlag=f.enemy,l.funcType=f.funcType,l.funcType==null&&(l.funcType=0),l.statistics=f.statistics,l.upDateValue=f.upDateValue,l.demoteValue=f.demoteValue,a.symbolicLink(l,f.operator),a.Call.send(a.Eve.SHIFT_SHOW_VIEW,[l,f.operator,r],null)}else if([12,16,14].includes(f.type)){var d=new a.VariableValue(f.name,f.value,f.type);d.TID=f.TID,d.TID==null&&(d.TID=new Date().getTime()+a.functionAddIndex,a.functionAddIndex++);var l=a.createFunctionBody(o,d);l.enemyFlag=f.enemy,l.funcType=f.funcType,l.funcType==null&&(l.funcType=0),f.type==11&&(l.selectedOutputInfo=f.selectedOutputInfo?JSON.parse(f.selectedOutputInfo):""),l.statistics=f.statistics,l.upDateValue=f.upDateValue,l.demoteValue=f.demoteValue,l.isLogicalOpen=f.isLogicalOpen,l.isDragging=f.isDragging,l.snNo=f.snNo,l.logicalNumberList=f.logicalNumberList,l.currentStep=f.currentStep,l.snNo=f.snNo,l.minValue=f.minValue,l.maxValue=f.maxValue,l.step=f.step,l.logicalChildArray=[],f.logicalChildArray.forEach(v=>{var S=[];a.getLibraryBody(S,a.targetFolder.tree,a.getAbsoluteAddress(v));var F=S[0],E=F.copy();E.enemyFlag=f.enemy,E.funcType=f.funcType,E.funcType==null&&(E.funcType=0),E.statistics=f.statistics,E.upDateValue=f.upDateValue,E.demoteValue=f.demoteValue,l.logicalChildArray.push(E)}),a.symbolicLink(l,f.operator),a.Call.send(a.Eve.SHIFT_SHOW_VIEW,[l,f.operator,r],null)}else{var p=[];s||f.source?a.getLibraryBody(p,a.targetFolder.tree,a.getAbsoluteAddress(f.source)):a.getLibraryBody(p,a.targetFolder.tree,a.getAbsoluteAddress(f));var y=p[0],l=a.createVariableBody(o,y);l.enemyFlag=f.enemy,l.funcType=f.funcType,l.funcType==null&&(l.funcType=0),f.type==11&&(l.selectedOutputInfo=f.selectedOutputInfo?JSON.parse(f.selectedOutputInfo):""),l.statistics=f.statistics,l.upDateValue=f.upDateValue,l.demoteValue=f.demoteValue,a.symbolicLink(l,f.operator),a.Call.send(a.Eve.SHIFT_SHOW_VIEW,[l,f.operator,r],null)}}a.Call.send(a.Eve.SHIFT_SHOW_VIEW_ON,[o,r],null)}if(m.isFormula){var g=new a.FormulaData(m.formulaName,m.formulaX,m.formulaY);g.body=o,g.body.isBindingFormula=!0,o.formulaBody=g,a.Call.send(a.Eve.SHIFT_ADD_FORMULA,[g,o.view,r],null)}}else if(m.type=="SymbolBody"||m.type=="符号运算体类"){var V=a.createSymbolBody(null,null,m.operator,m.isFunctionId,m.isWeight,m.funcType);V.isBindingOperation=a.getIsBoundOutput(t[h],i),a.operationBindBody(V),u==null&&(u=V),V.view!=null&&(V.view.setX(a.coordinate(t[h],i)[0]),V.view.setY(a.coordinate(t[h],i)[1]));for(var c=0;c<m.tree.length;c++){const f=m.tree[c];if(f.type=="OperationBody"||f.type=="运算体类")if(f.isFunction){var o=a.createOperationBody(a.coordinate(f,i)[0],a.coordinate(f,i)[1],1,f.isWeight,f.isAdvance,f.funcType);o.isBindingOperation=a.getIsBoundOutput(f,i),a.operationBindBody(o),a.addBody(V,o,!1);for(var T=0;T<f.tree.length;T++){const I=f.tree[T];if(I.type==4){var d=new a.VariableValue(I.name,null,4);d.TID=I.TID,d.TID==null&&(d.TID=new Date().getTime()+a.functionAddIndex,a.functionAddIndex++);var l=a.createFunctionBody(o,d);l.macros=a.amendMacros(I),l.enemyFlag=I.enemy,l.funcType=I.funcType,l.funcType==null&&(l.funcType=0),l.statistics=I.statistics,l.upDateValue=I.upDateValue,l.demoteValue=I.demoteValue,a.symbolicLink(l,I.operator),a.Call.send(a.Eve.SHIFT_SHOW_VIEW,[l,I.operator,r],null)}else if([12,16,14].includes(I.type)){var d=new a.VariableValue(f.name,f.value,f.type);d.TID=f.TID,d.TID==null&&(d.TID=new Date().getTime()+a.functionAddIndex,a.functionAddIndex++);var l=a.createFunctionBody(o,d);l.enemyFlag=f.enemy,l.funcType=f.funcType,l.funcType==null&&(l.funcType=0),f.type==11&&(l.selectedOutputInfo=f.selectedOutputInfo?JSON.parse(f.selectedOutputInfo):""),l.statistics=f.statistics,l.upDateValue=f.upDateValue,l.demoteValue=f.demoteValue,l.isLogicalOpen=f.isLogicalOpen,l.isDragging=f.isDragging,l.snNo=f.snNo,l.logicalNumberList=f.logicalNumberList,l.currentStep=f.currentStep,l.snNo=f.snNo,l.minValue=f.minValue,l.maxValue=f.maxValue,l.step=f.step,l.logicalChildArray=[],f.logicalChildArray.forEach(F=>{var E=[];a.getLibraryBody(E,a.targetFolder.tree,a.getAbsoluteAddress(F));var N=E[0],O=N.copy();O.enemyFlag=f.enemy,O.funcType=f.funcType,O.funcType==null&&(O.funcType=0),O.statistics=f.statistics,O.upDateValue=f.upDateValue,O.demoteValue=f.demoteValue,l.logicalChildArray.push(O)}),a.symbolicLink(l,f.operator),a.Call.send(a.Eve.SHIFT_SHOW_VIEW,[l,f.operator,r],null)}else{var p=[];s?a.getLibraryBody(p,a.targetFolder.tree,a.getAbsoluteAddress(I.source)):a.getLibraryBody(p,a.targetFolder.tree,a.getAbsoluteAddress(I));var y=p[0],l=a.createVariableBody(o,y);l.enemyFlag=I.enemy,l.funcType=I.funcType,l.funcType==null&&(l.funcType=0),I.type==11&&(l.selectedOutputInfo=I.selectedOutputInfo?JSON.parse(I.selectedOutputInfo):""),l.statistics=I.statistics,l.upDateValue=I.upDateValue,l.demoteValue=I.demoteValue,a.symbolicLink(l,I.operator),a.Call.send(a.Eve.SHIFT_SHOW_VIEW,[l,I.operator,r],null)}}a.Call.send(a.Eve.SHIFT_SHOW_VIEW_ON,[o,r],null)}else{var o=a.createOperationBody(a.coordinate(f,i)[0],a.coordinate(f,i)[1],0,f.isWeight,f.isAdvance,f.funcType);if(o.isBindingOperation=a.getIsBoundOutput(f,i),a.operationBindBody(o),a.addBody(V,o,!1),f.tree==null)return null;for(var T=0;T<f.tree.length;T++){const v=f.tree[T];if(v.type==4){var d=new a.VariableValue(v.name,null,v.type);d.TID=v.TID,d.TID==null&&(d.TID=new Date().getTime()+a.functionAddIndex,a.functionAddIndex++);var l=a.createFunctionBody(o,d);l.setMacros(a.amendMacros(v)),l.enemyFlag=v.enemy,l.funcType=v.funcType,l.funcType==null&&(l.funcType=0),l.statistics=v.statistics,l.upDateValue=v.upDateValue,l.demoteValue=v.demoteValue,a.symbolicLink(l,v.operator),a.Call.send(a.Eve.SHIFT_SHOW_VIEW,[l,v.operator,r],null)}else if([12,16,14].includes(v.type)){var d=new a.VariableValue(v.name,v.value,v.type);d.TID=v.TID,d.TID==null&&(d.TID=new Date().getTime()+a.functionAddIndex,a.functionAddIndex++);var l=a.createFunctionBody(o,d);l.enemyFlag=v.enemy,l.funcType=v.funcType,l.funcType==null&&(l.funcType=0),v.type==11&&(l.selectedOutputInfo=v.selectedOutputInfo?JSON.parse(v.selectedOutputInfo):""),l.statistics=v.statistics,l.upDateValue=v.upDateValue,l.demoteValue=v.demoteValue,l.isLogicalOpen=v.isLogicalOpen,l.isDragging=v.isDragging,l.snNo=v.snNo,l.logicalNumberList=v.logicalNumberList,l.currentStep=v.currentStep,l.snNo=v.snNo,l.minValue=v.minValue,l.maxValue=v.maxValue,l.step=v.step,l.logicalChildArray=[],v.logicalChildArray.forEach(E=>{var N=[];a.getLibraryBody(N,a.targetFolder.tree,a.getAbsoluteAddress(E));var O=N[0],L=O.copy();L.enemyFlag=v.enemy,L.funcType=v.funcType,L.funcType==null&&(L.funcType=0),L.statistics=v.statistics,L.upDateValue=v.upDateValue,L.demoteValue=v.demoteValue,l.logicalChildArray.push(L)}),a.symbolicLink(l,v.operator),a.Call.send(a.Eve.SHIFT_SHOW_VIEW,[l,v.operator,r],null)}else{var p=[];s||v.source?a.getLibraryBody(p,a.targetFolder.tree,a.getAbsoluteAddress(v.source)):a.getLibraryBody(p,a.targetFolder.tree,a.getAbsoluteAddress(v));var y=p[0],l=a.createVariableBody(o,y);l.enemyFlag=v.enemy,l.funcType=v.funcType,l.funcType==null&&(l.funcType=0),v.type==11&&(l.selectedOutputInfo=v.selectedOutputInfo?JSON.parse(v.selectedOutputInfo):""),l.statistics=v.statistics,l.upDateValue=v.upDateValue,l.demoteValue=v.demoteValue,a.symbolicLink(l,v.operator),a.Call.send(a.Eve.SHIFT_SHOW_VIEW,[l,v.operator,r],null)}}a.Call.send(a.Eve.SHIFT_SHOW_VIEW_ON,[o,r],null)}else if(f.type=="SymbolBody"||f.type=="符号运算体类"){var o=a.createSymbolBody(null,null,f.operator,f.isFunctionId,f.isWeight,f.funcType);o.isBindingOperation=a.getIsBoundOutput(f,i),a.operationBindBody(o),o.view!=null&&(o.view.setX(a.coordinate(f,i)[0]),o.view.setY(a.coordinate(f,i)[1])),a.loopGenerateBody(o,f.tree,r),a.addBody(V,o,!1),a.Call.send(a.Eve.SHIFT_SHOW_VIEW_ON,[o,r],null)}}if(a.Call.send(a.Eve.SHIFT_SHOW_VIEW_ON,[V,r],null),m.isFormula){var g=new a.FormulaData(m.formulaName,m.formulaX,m.formulaY);g.body=V,g.body.isBindingFormula=!0,V.formulaBody=g,a.Call.send(a.Eve.SHIFT_ADD_FORMULA,[g,V.view,r],null)}}else if(m.type=="Bookmark"){var o=a.createBookmark(m.x,m.y,m.width,m.height,m.text);a.Call.send(a.Eve.SHIFT_SHOW_VIEW_ON,[o,r],null)}}return u}),n(a,"amendMacros",function(t){return t.macros==null?t.macro:t.macros}),n(a,"fixedDecimal",function(t,r){switch(r){case 0:return Math.round(t);case 1:return Math.round(t*10)/10;case 2:return Math.round(t*100)/100;case 3:return Math.round(t*1e3)/1e3;case 4:return Math.round(t*1e4)/1e4}return 0}),n(a,"currencyConversion",function(t){var r=t%100,i=parseInt(String(t/100%100)),s=0;return t<1e5?s=parseInt(String(t/100/100%100)):s=parseInt(String(t/100/100)),[s,i,r]}),n(a,"replaceVariableBody",function(t,r,i){var s=r.copy();return t.replace(s,i),a.Call.send(a.Eve.SHIFT_ADD_VARIABLEBODY,[t,s],(function(u){}).bind(this)),s}),n(a,"createVariableBody",function(t,r){var i=r.copy();return t.addBody(i),a.Call.send(a.Eve.SHIFT_ADD_VARIABLEBODY,[t,i],(function(s){}).bind(this)),i}),n(a,"createFunctionBody",function(t,r){var i=r.copy();return t.addBody(i),a.Call.send(a.Eve.SHIFT_ADD_FUNCTION,[t,i],(function(s){}).bind(this)),i}),n(a,"replaceFunctionBody",function(t,r,i){var s=r.copy();return t.replace(s,i),a.Call.send(a.Eve.SHIFT_ADD_FUNCTION,[t,s],(function(u){}).bind(this)),s}),n(a,"createOperationBody",function(t,r,i,s,u,h){var o=new a.OperationBody;o.isFunction=!!i,a.targetStoragePool.push(o),o.isWeight=s,o.isAdvance=u,o.funcType=h,(o.funcType==null||o.funcType==null)&&(o.funcType=0),o.x=t,o.y=r;var c=null;return a.Call.send(a.Eve.SHIFT_ADD_OPERATIONBODY,[t,r,i,o],(function(d){c=d,s&&c&&c.openWeight(),u&&c&&c.openAdvance()}).bind(this)),o}),n(a,"createBookmark",function(t,r,i,s,u){var h=new a.Bookmark;return h.x=t,h.y=r,h.width=i,h.id=++EventManager.IDINDEX,h.width==null&&(h.width=256),h.height=s,h.height==null&&(h.height=256),h.text=u,a.targetStoragePool.push(h),a.Call.send(a.Eve.SHIFT_ADD_BOOKMARK,[h],(function(o){}).bind(this)),h}),n(a,"createSymbolBody",function(t,r,i,s,u,h){var o=new a.SymbolBody;return o.isWeight=u,o.isFunctionId=s,o.funcType=h,(o.funcType==null||o.funcType==null)&&(o.funcType=0),o.operator=i,o.isFunctionId==null&&(o.isFunctionId=1),t!=null&&o.addBody(t),r!=null&&o.addBody(r),a.targetStoragePool.push(o),a.Call.send(a.Eve.SHIFT_ADD_SYMBOLBODY,[t,r,i,s,o],null),o}),n(a,"operationBindBody",function(t){t.isBindingOperation&&a.editBody!=null&&(a.editBody.body=t)}),n(a,"addBody",function(t,r,i){a.Call.send(a.Eve.ADD_OPERAND_DATA,[t,r,i],null)}),n(a,"symbolicLink",function(t,r){r!=null&&(r=="删除符号"||r=="删除运算体"||r=="导出公式"||r=="敌方标记"||(t.operator=r))}),n(a,"loopGenerateBody",function(t,r,i){for(var s=0;s<r.length;s++){const y=r[s];switch(y.type){case"OperationBody":if(y.isFunction){var u=a.createOperationBody(a.coordinate(r[s])[0],a.coordinate(r[s])[1],1,y.isWeight,y.isAdvance,y.funcType);u.isBindingOperation=a.getIsBoundOutput(r[s]),a.operationBindBody(u),a.addBody(t,u,!1);for(var h=0;h<y.tree.length;h++){const g=y.tree[h];if(g.type==4){var o=new a.VariableValue(g.name,null,g.type);o.TID=g.TID,o.TID==null&&(o.TID=new Date().getTime()+a.functionAddIndex,a.functionAddIndex++);var c=a.createFunctionBody(u,o);c.macros=a.amendMacros(g),c.enemyFlag=g.enemy,c.funcType=g.funcType,c.funcType==null&&(c.funcType=0),c.statistics=g.statistics,c.upDateValue=g.upDateValue,c.demoteValue=g.demoteValue,a.symbolicLink(c,g.operator),a.clickBody=c,a.Call.send(a.Eve.SHIFT_SHOW_VIEW,[c,g.operator,i],null)}else if([12,16,14].includes(g.type)){var o=new a.VariableValue(g.name,g.value,g.type);o.TID=g.TID,o.TID==null&&(o.TID=new Date().getTime()+a.functionAddIndex,a.functionAddIndex++);var c=a.createFunctionBody(u,o);c.enemyFlag=g.enemy,c.funcType=g.funcType,c.funcType==null&&(c.funcType=0),g.type==11&&(c.selectedOutputInfo=g.selectedOutputInfo?JSON.parse(g.selectedOutputInfo):""),c.statistics=g.statistics,c.upDateValue=g.upDateValue,c.demoteValue=g.demoteValue,c.isLogicalOpen=g.isLogicalOpen,c.isDragging=g.isDragging,c.snNo=g.snNo,c.logicalNumberList=g.logicalNumberList,c.currentStep=g.currentStep,c.snNo=g.snNo,c.minValue=g.minValue,c.maxValue=g.maxValue,c.step=g.step,c.logicalChildArray=[],g.logicalChildArray.forEach(m=>{var D=[];a.getLibraryBody(D,a.targetFolder.tree,a.getAbsoluteAddress(m));var f=D[0],x=f.copy();x.enemyFlag=g.enemy,x.funcType=g.funcType,x.funcType==null&&(x.funcType=0),x.statistics=g.statistics,x.upDateValue=g.upDateValue,x.demoteValue=g.demoteValue,c.logicalChildArray.push(x)}),a.symbolicLink(c,g.operator),a.Call.send(a.Eve.SHIFT_SHOW_VIEW,[c,g.operator,i],null)}else{var d=[];a.getLibraryBody(d,a.targetFolder.tree,a.getAbsoluteAddress(g));var l=d[0],c=a.createVariableBody(u,l);c.enemyFlag=g.enemy,c.funcType=g.funcType,c.funcType==null&&(c.funcType=0),g.type==11&&(c.selectedOutputInfo=g.selectedOutputInfo?JSON.parse(g.selectedOutputInfo):""),c.statistics=g.statistics,c.upDateValue=g.upDateValue,c.demoteValue=g.demoteValue,a.symbolicLink(c,g.operator),a.Call.send(a.Eve.SHIFT_SHOW_VIEW,[c,g.operator,i],null)}}a.Call.send(a.Eve.SHIFT_SHOW_VIEW_ON,[u,i],null)}else{var u=a.createOperationBody(a.coordinate(r[s])[0],a.coordinate(r[s])[1],0,y.isWeight,y.isAdvance,y.funcType);u.isBindingOperation=a.getIsBoundOutput(r[s]),a.operationBindBody(u),a.addBody(t,u,!1);for(var h=0;h<y.tree.length;h++){const T=y.tree[h];if(T.type==4){var o=new a.VariableValue(T.name,null,T.type);o.TID=T.TID,o.TID==null&&(o.TID=new Date().getTime()+a.functionAddIndex,a.functionAddIndex++);var c=a.createFunctionBody(u,o);c.setMacros(a.amendMacros(T)),c.enemyFlag=T.enemy,c.funcType=T.funcType,c.funcType==null&&(c.funcType=0),c.statistics=T.statistics,c.upDateValue=T.upDateValue,c.demoteValue=T.demoteValue,a.symbolicLink(c,T.operator),a.Call.send(a.Eve.SHIFT_SHOW_VIEW,[c,T.operator,i],null)}else if([12,16,14].includes(T.type)){var o=new a.VariableValue(T.name,T.value,T.type);o.TID=T.TID,o.TID==null&&(o.TID=new Date().getTime()+a.functionAddIndex,a.functionAddIndex++);var c=a.createFunctionBody(u,o);c.enemyFlag=T.enemy,c.funcType=T.funcType,c.funcType==null&&(c.funcType=0),T.type==11&&(c.selectedOutputInfo=T.selectedOutputInfo?JSON.parse(T.selectedOutputInfo):""),c.statistics=T.statistics,c.upDateValue=T.upDateValue,c.demoteValue=T.demoteValue,c.isLogicalOpen=T.isLogicalOpen,c.isDragging=T.isDragging,c.snNo=T.snNo,c.logicalNumberList=T.logicalNumberList,c.currentStep=T.currentStep,c.snNo=T.snNo,c.minValue=T.minValue,c.maxValue=T.maxValue,c.step=T.step,c.logicalChildArray=[],T.logicalChildArray.forEach(f=>{var x=[];a.getLibraryBody(x,a.targetFolder.tree,a.getAbsoluteAddress(f));var I=x[0],v=I.copy();v.enemyFlag=T.enemy,v.funcType=T.funcType,v.funcType==null&&(v.funcType=0),v.statistics=T.statistics,v.upDateValue=T.upDateValue,v.demoteValue=T.demoteValue,c.logicalChildArray.push(v)}),a.symbolicLink(c,T.operator),a.Call.send(a.Eve.SHIFT_SHOW_VIEW,[c,T.operator,i],null)}else{var d=[];a.getLibraryBody(d,a.targetFolder.tree,a.getAbsoluteAddress(T));var l=d[0],c=a.createVariableBody(u,l);c.enemyFlag=T.enemy,c.funcType=T.funcType,c.funcType==null&&(c.funcType=0),T.type==11&&(c.selectedOutputInfo=T.selectedOutputInfo?JSON.parse(T.selectedOutputInfo):""),c.statistics=T.statistics,c.upDateValue=T.upDateValue,c.demoteValue=T.demoteValue,a.symbolicLink(c,T.operator),a.Call.send(a.Eve.SHIFT_SHOW_VIEW,[c,T.operator,i],null)}}a.Call.send(a.Eve.SHIFT_SHOW_VIEW_ON,[u,i],null)}break;case"SymbolBody":var p=a.createSymbolBody(null,null,y.operator,y.isFunctionId,y.isWeight,y.funcType);p.isBindingOperation=a.getIsBoundOutput(r[s]),a.operationBindBody(p),p.view!=null&&(p.view.setX(a.coordinate(r[s])[0]),p.view.setY(a.coordinate(r[s])[1])),a.loopGenerateBody(p,y.tree,i),a.addBody(t,p,!1),a.Call.send(a.Eve.SHIFT_SHOW_VIEW_ON,[p,i],null);break}}}),n(a,"saveFXTree",function(t,r){if(t!=null)for(var i=0;i<t.length;i++){const u=t[i];if(u.type==4){var s={TID:u.TID,name:u.name,code:u.macros};r.push(s)}else a.saveFXTree(u.tree,r)}}),n(a,"recursiveStorage",function(t,r){if(t.operationArray!=null)for(var i=0;i<t.operationArray.length;i++){const h=t.operationArray[i];if(h.tree!=null)for(var s=0;s<h.tree.length;s++){const o=h.tree[s];if(o.type==4){var u={TID:o.TID,name:o.name,code:o.macros};r.push(u)}else a.saveFXTree(o.tree,r)}h.operationArray!=null&&a.recursiveStorage(h,r)}}),n(a,"init",function(){try{a.isStart===!1&&(a.isStart=!0,a.code=!0,new a.FXCentre)}catch(t){console.error("Error initializing FX system:",t),a.isStart=!1,a.code=!1}}),a),globalThis_2=function(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{}}();globalThis_2.fx=fx,globalThis_2.seer=fx;const M=class M{constructor(){n(this,"_fxData");n(this,"_fxPlayer");n(this,"playerList",[])}static getInstance(){return this._instance||(this._instance=new M),this._instance}getPlayerInstance(){let t=this._fxData[0],r=new Player;r.name=t.name,console.log(r.name);let i=r.getBillboard();return console.log(i),r.parameterInfoArray=t.parameterInfoArray,r}getEnemyInstance(t){let r=this._fxData[t],i=new Player;return i.name=r.name,i.parameterInfoArray=r.parameterInfoArray,i}getInstanceByName(t){let r=this._fxData.find(s=>s.name===t);if(!r)return console.warn(`未找到名称为 "${t}" 的角色配置`),null;let i=new Player;return i.name=r.name,i.parameterInfoArray=r.parameterInfoArray,i}loadConfig(t){new FXCentre;var r=t,i=typeof r=="string"?JSON.parse(r):r;i.stage.operationArray;var s=i.library.operationArray;fx.createLibraryBody(s,!0),this._fxPlayer=Player,this.playerList=[];let u=new fx.CallCenter;u.addEventListener(EventManager.SHIFT_ADD_BOARD,c=>{let d=new BillboardLayer(c.name);d.monitored=c.monitored;let l=d;for(var p=0;p<c.operationArray.length;p++){var y=[];fx.getLibraryBody(y,fx.targetFolder.tree,c.operationArray[p].site),fx.clickBody=y[0],l.pushOperationLayer(),fx.clickBody=null}for(var p=0;p<c.metadataArray.length;p++){var y=[];fx.getLibraryBody(y,fx.targetFolder.tree,c.metadataArray[p].site),fx.clickBody=y[0];let T=c.metadataArray[p];l.pushMetadata(T.componentType,T.componentMinValue,T.componentMaxValue,T.componentIntervalValue),fx.clickBody=null}fx.Call.send(fx.Eve.ADD_DATABASE_DATA,[l,fx.selectBody,c.index]),fx.Call.send(fx.Eve.SHIFT_REFRESH_LIBRARY_COORDINATES,[l,fx.selectBody])}),u.addEventListener(EventManager.SHIFT_ADD_CHARTS,c=>{var d=new ChartsLayer(c.name);let l=d;for(var p=0;p<c.operationlayer.length;p++){var y=[];fx.getLibraryBody(y,fx.targetFolder.tree,c.operationlayer[p]),l.operationArray.push(y[0].copy())}var y=[];l.minValue=c.minValue,l.intervalValue=c.intervalValue,l.maxValue=c.maxValue,c.metadataArray||(c.metadataArray=[]),c.metadata&&(c.metadataArray=[{site:c.metadata,intervalValue:l.intervalValue,minValue:l.minValue}],c.metadata=null);for(var p=0;p<c.metadataArray.length;p++){var y=[],g=c.metadataArray[p];fx.getLibraryBody(y,fx.targetFolder.tree,g.site);var V=y[0].copy();V.intervalValue=g.intervalValue||1,V.minValue=g.minValue||1,l.metadataArray.push(V),l.metadata=V}Call.send(fx.Eve.ADD_DATABASE_DATA,[l,fx.selectBody,c.index]),fx.Call.send(fx.Eve.SHIFT_REFRESH_LIBRARY_COORDINATES,[l,fx.selectBody]),fx.clickBody=null}),fx.parseLibraryBody(s,!0),fx.recursionSyncBody(fx.targetFolder.tree);let h=i.entity.operationArray;this._fxData=h;let o=this.createPlayersFromEntityArray(h);console.log("-------------------"),o.forEach(c=>{let d=c.getFormula("攻击"),l=c.getFormula("生命"),p=c.getFormula("防御");console.log("name",c.name),console.log("attack",d),console.log("hp",l),console.log("defense",p)}),this.playerList=o}getDataByOccuAndLevel(t,r){this._fxPlayer.changePlayerLevelAndOccupation(r,t);let i=this._fxPlayer.getFormula("攻击1"),s=this._fxPlayer.getFormula("生命"),u=this._fxPlayer.getFormula("防御");return{attack:i,hp:s,defense:u}}getInstanceDataByNameAndOccuAndLevel(t,r,i){let s=this.playerList.find(c=>c.name===t);if(!s)throw new Error(`未找到名称为 "${t}" 的玩家`);s.changeLevelAndOccupation(i,r);let u=s.getFormula("攻击"),h=s.getFormula("生命"),o=s.getFormula("防御");return{attack:u,hp:h,defense:o}}createPlayersFromEntityArray(t){let r=[];for(var i=0;i<t.length;i++){let s=t[i],u=this.getInstanceByName(s.name);u?r.push(u):console.warn(`创建玩家实例失败: ${s.name}`)}return r}getSheetDataByPath(t){var u;let r=t.split("."),i=fx.targetFolder,s;for(let h=0;h<r.length;h++){let o;if(i.isFolder){if(o=i.tree.find(c=>c.name==r[h]),!o)throw new Error("getSheetDataByPath - 路径未找到: "+r[h])}else s=i;i=o,h==r.length-1&&(s=i)}return(u=s==null?void 0:s.sheetData)==null?void 0:u.originData}};n(M,"_instance");let FxUtil=M;window.FxUtil=FxUtil;class BattleLogger{constructor(){n(this,"logs",[]);n(this,"battleData",[])}addLog(t){const i=`[${new Date().toLocaleTimeString("zh-CN")}] ${t}`;this.logs.push(i),console.log(i)}addRoundData(t,r){this.battleData.push({round:t,timestamp:new Date().toISOString(),...r})}getLogs(){return[...this.logs]}getBattleData(){return[...this.battleData]}clear(){this.logs=[],this.battleData=[]}generateReport(){let t=`
========== 战斗报告 ==========
`;return t+=this.logs.join(`
`),t+=`

========== 战斗数据统计 ==========
`,t+=JSON.stringify(this.battleData,null,2),t+=`
================================
`,t}}class BattleEntity{constructor(t,r,i,s,u=1,h=1){n(this,"name");n(this,"maxHp");n(this,"currentHp");n(this,"attack");n(this,"defense");n(this,"level");n(this,"occupation");this.name=t,this.maxHp=r,this.currentHp=r,this.attack=i,this.defense=s,this.level=u,this.occupation=h}isAlive(){return this.currentHp>0}takeDamage(t){const r=Math.max(1,t-this.defense);return this.currentHp=Math.max(0,this.currentHp-r),r}getStatus(){return`${this.name} [Lv.${this.level}] HP: ${this.currentHp}/${this.maxHp} | 攻击: ${this.attack} | 防御: ${this.defense}`}getHpPercentage(){return this.currentHp/this.maxHp*100}}class BattleSimulator{constructor(t,r,i){n(this,"logger");n(this,"hero");n(this,"enemy");n(this,"round",0);n(this,"maxRounds",100);this.hero=t,this.enemy=r,this.logger=i}calculateDamage(t,r){let i=t.attack-r.defense;const s=.8+Math.random()*.4;return i=Math.floor(i*s),Math.max(1,i)}executeAttack(t,r){const i=this.calculateDamage(t,r),s=r.takeDamage(i);return this.logger.addLog(`  ${t.name} 攻击 ${r.name}，造成 ${s} 点伤害！（${r.name} 剩余血量: ${r.currentHp}/${r.maxHp}）`),s}battleRound(){this.round++,this.logger.addLog(`
----- 第 ${this.round} 回合 -----`),this.logger.addLog(`${this.hero.getStatus()}`),this.logger.addLog(`${this.enemy.getStatus()}`);const t={heroHp:this.hero.currentHp,heroHpPercent:this.hero.getHpPercentage(),enemyHp:this.enemy.currentHp,enemyHpPercent:this.enemy.getHpPercentage()},r=this.executeAttack(this.hero,this.enemy),i=()=>{t.enemyHp=this.enemy.currentHp,t.enemyHpPercent=this.enemy.getHpPercentage(),t.heroHp=this.hero.currentHp,t.heroHpPercent=this.hero.getHpPercentage()};if(!this.enemy.isAlive())return i(),this.logger.addLog(`
🎉 ${this.enemy.name} 被击败了！`),this.logger.addRoundData(this.round,{...t,heroDamageDealt:r,enemyDamageDealt:0,winner:this.hero.name,battleEnd:!0}),!0;const s=this.executeAttack(this.enemy,this.hero);return this.hero.isAlive()?(i(),this.logger.addRoundData(this.round,{...t,heroDamageDealt:r,enemyDamageDealt:s,battleEnd:!1}),!1):(this.logger.addLog(`
💀 ${this.hero.name} 被击败了！`),i(),this.logger.addRoundData(this.round,{...t,heroDamageDealt:r,enemyDamageDealt:s,winner:this.enemy.name,battleEnd:!0}),!0)}startBattle(){for(this.logger.addLog(`
========================================`),this.logger.addLog("⚔️  战斗开始！"),this.logger.addLog("========================================"),this.logger.addLog(`${this.hero.getStatus()}`),this.logger.addLog("VS"),this.logger.addLog(`${this.enemy.getStatus()}`),this.logger.addLog(`========================================
`);this.round<this.maxRounds&&!this.battleRound(););this.round>=this.maxRounds&&this.logger.addLog(`
⏱️  战斗超时，平局！`);const t=this.hero.isAlive()?this.hero.name:this.enemy.isAlive()?this.enemy.name:"平局";return this.logger.addLog(`
========================================`),this.logger.addLog("📊 战斗结束统计"),this.logger.addLog("========================================"),this.logger.addLog(`胜利者: ${t}`),this.logger.addLog(`总回合数: ${this.round}`),this.logger.addLog(`${this.hero.name} 最终状态: ${this.hero.getStatus()}`),this.logger.addLog(`${this.enemy.name} 最终状态: ${this.enemy.getStatus()}`),this.logger.addLog(`========================================
`),{winner:t,rounds:this.round,battleData:this.logger.getBattleData()}}}let fxInit=!1;async function init(){if(fxInit)return;const e=FxUtil.getInstance(),r=await(await fetch("./assets/fx.json")).json();e.loadConfig(r),fxInit=!0}async function exampleMultipleBattles(){console.log(`

========================================`),console.log("示例2: 多场战斗对比测试"),console.log(`========================================
`),await init();const e=FxUtil.getInstance(),t=[],r=[{heroLevel:5,enemyLevel:5,name:"势均力敌"},{heroLevel:10,enemyLevel:5,name:"主角优势"},{heroLevel:5,enemyLevel:10,name:"敌人优势"},{heroLevel:15,enemyLevel:15,name:"高等级对决"},{heroLevel:1,enemyLevel:1,name:"新手对决"}];for(const i of r){console.log(`
🏆 战斗场景: ${i.name}`),console.log(`主角等级: ${i.heroLevel} | 敌人等级: ${i.enemyLevel}`);const s=new BattleLogger,u=e.getInstanceDataByNameAndOccuAndLevel("主角1",1,i.heroLevel),h=new BattleEntity("勇者",u.hp,u.attack,u.defense,i.heroLevel,1),o=e.getInstanceDataByNameAndOccuAndLevel("怪物1",2,i.enemyLevel),c=new BattleEntity("巨龙",o.hp,o.attack,o.defense,i.enemyLevel,1),l=new BattleSimulator(h,c,s).startBattle();console.log(`[调试] ${i.name} 战斗结束`),console.log("[调试] result.battleData 存在?",!!l.battleData),console.log("[调试] result.battleData 长度:",l.battleData?l.battleData.length:"undefined"),console.log("[调试] result.battleData 内容:",l.battleData),t.push({场景:i.name,主角等级:i.heroLevel,敌人等级:i.enemyLevel,胜利者:l.winner,回合数:l.rounds,主角最终HP:h.currentHp,敌人最终HP:c.currentHp,battleData:l.battleData,heroName:"勇者",enemyName:"巨龙"})}return console.log(`

📊 多场战斗统计结果:`),console.table(t),console.log("[调试] 返回results前的最终检查:"),t.forEach((i,s)=>{console.log(`  结果 ${s}: 场景="${i.场景}", battleData长度=${i.battleData?i.battleData.length:"undefined"}`)}),t}async function generatePVEDataRange(e,t=50,r=1){const i=[],s=r+t-1;await init();const u=FxUtil.getInstance();for(let h=r;h<=s;h++){await new Promise(o=>{requestAnimationFrame(()=>o(!0))});try{const o=new BattleLogger,c=u.getInstanceDataByNameAndOccuAndLevel("主角1",1,h),d=new BattleEntity("Hero",c.hp,c.attack,c.defense,h,1),l=u.getInstanceDataByNameAndOccuAndLevel("怪物1",1,h),p=new BattleEntity("Enemy",l.hp,l.attack,l.defense,h,1),g=new BattleSimulator(d,p,o).startBattle();let V=0,T=0;if(g.battleData&&g.battleData.length>0)for(const f of g.battleData)f.heroDamageDealt!==void 0&&(V+=f.heroDamageDealt,T++);const m=T>0?V/T:0,D={level:h,hp:d.currentHp,damage:m,rounds:g.rounds,battleData:g.battleData,heroName:"Hero",enemyName:"Enemy"};i.push(D),e&&e(i,h,s)}catch(o){console.error(`Level ${h} battle simulation failed:`,o);const c={level:h,hp:100,damage:20,rounds:10,battleData:[],heroName:"Hero",enemyName:"Enemy"};i.push(c),e&&e(i,h,s)}}return console.log(`PVE data generation complete: ${i.length} levels`),i}async function generatePVEData(e,t=50){var s;const r=[];await init();const i=FxUtil.getInstance();for(let u=1;u<=t;u++){await new Promise(h=>{requestAnimationFrame(()=>h(!0))});try{const h=new BattleLogger,o=i.getInstanceDataByNameAndOccuAndLevel("主角1",1,u),c=new BattleEntity("Hero",o.hp,o.attack,o.defense,u,1),d=i.getInstanceDataByNameAndOccuAndLevel("怪物1",1,u),l=new BattleEntity("Enemy",d.hp,d.attack,d.defense,u,1),y=new BattleSimulator(c,l,h).startBattle();let g=0,V=0;if(y.battleData&&y.battleData.length>0)for(const D of y.battleData)D.heroDamageDealt!==void 0&&(g+=D.heroDamageDealt,V++);const T=V>0?g/V:0,m={level:u,hp:c.currentHp,damage:T,rounds:y.rounds,battleData:y.battleData,heroName:"Hero",enemyName:"Enemy"};(u===1||u===10||u===50)&&console.log(`[调试] 等级${u}数据:`,{level:m.level,rounds:m.rounds,battleDataLength:(s=m.battleData)==null?void 0:s.length,battleDataExists:!!m.battleData}),r.push(m),e&&e(r,u,t),u%10===0&&console.log(`PVE数据生成进度: ${u}/${t}`)}catch(h){console.error(`Level ${u} battle simulation failed:`,h);const o={level:u,hp:100,damage:20,rounds:10,battleData:[],heroName:"Hero",enemyName:"Enemy"};r.push(o),e&&e(r,u,t)}}return console.log(`PVE data generation complete: ${r.length} levels`),r}async function runAllExamples(){console.log(`

`),console.log("╔════════════════════════════════════════╗"),console.log("║   Seer Engine 多场战斗对比演示程序     ║"),console.log("║   Multiple Battles Comparison Demo      ║"),console.log("╚════════════════════════════════════════╝"),console.log(`
`),await init();try{await exampleMultipleBattles(),console.log(`
✅ 多场战斗对比示例运行完成！`),console.log(`查看控制台以获取详细的战斗日志和数据分析。
`)}catch(e){console.error("❌ 运行示例时出错:",e)}}typeof window<"u"&&(window.battleDemo={runAllExamples,exampleMultipleBattles,generatePVEData,generatePVEDataRange},console.log("💡 Usage:"),console.log("  - battleDemo.runAllExamples() - Run multiple battle comparison examples"),console.log("  - battleDemo.exampleMultipleBattles() - Multiple battle comparison"),console.log("  - battleDemo.generatePVEData() - Generate PVE test data"),console.log("  - battleDemo.generatePVEDataRange() - Generate PVE data for specific level range")),exports.BattleEntity=BattleEntity,exports.BattleLogger=BattleLogger,exports.BattleSimulator=BattleSimulator,exports.exampleMultipleBattles=exampleMultipleBattles,exports.generatePVEData=generatePVEData,exports.generatePVEDataRange=generatePVEDataRange,exports.runAllExamples=runAllExamples,Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})});
