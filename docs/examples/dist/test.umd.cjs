(function(I,x){typeof exports=="object"&&typeof module<"u"?x(exports):typeof define=="function"&&define.amd?define(["exports"],x):(I=typeof globalThis<"u"?globalThis:I||self,x(I.SeerEngineTest={}))})(this,function(exports){"use strict";var N=Object.defineProperty;var M=(I,x,a)=>x in I?N(I,x,{enumerable:!0,configurable:!0,writable:!0,value:a}):I[x]=a;var n=(I,x,a)=>M(I,typeof x!="symbol"?x+"":x,a);var I,x,a;var MessageList=(I=class{constructor(){n(this,"eventMessageList",[])}static getInstance(){return I._instance==null&&(I._instance=new I),I._instance}removeEventObject(t){const r=this.eventMessageList.indexOf(t);r!==-1&&this.eventMessageList.splice(r,1)}addEventObject(t){this.eventMessageList.indexOf(t)===-1&&this.eventMessageList.push(t)}},n(I,"_instance",null),I),Call=class{constructor(){}static send(e,t,r){t!=null&&(t.Call_Event_type=e);for(let i=0;i<MessageList.getInstance().eventMessageList.length;i++)if(MessageList.getInstance().eventMessageList[i].getEvents(e)){const s=MessageList.getInstance().eventMessageList[i].execute(e,t);r&&r.apply([e],[s])}}},CallCenter=class{constructor(){n(this,"eventsList",null);this.eventsList=null,MessageList.getInstance().addEventObject(this)}execute(e,t){return this.eventsList[e].apply([e],[t])}getEvents(e){return this.eventsList==null?!1:this.eventsList[e]!=null}addEventListener(e,t,r,i){this.eventsList==null&&(this.eventsList={}),this.eventsList[e]=t.bind(i)}dispose(){for(const e in this.eventsList)delete this.eventsList[e];this.eventsList=null}removeEventListener(e){this.eventsList!=null&&(this.eventsList[e]=null)}},EventManager=(x=class{constructor(){}},n(x,"UP_DATA_PLAYER","UP_DATA_PLAYER"),n(x,"CREATE_FILE_DATA","CREATE_FILE_DATA"),n(x,"CREATE_OPERATION_DATA","CREATE_OPERATION_DATA"),n(x,"CREATE_METADATE_DATA","CREATE_METADATE_DATA"),n(x,"ADD_DATABASE_DATA","ADD_DATABASE_DATA"),n(x,"ADD_OPERAND_DATA","ADD_OPERAND_DATA"),n(x,"SEND_ANCHOR_FORMULA","SEND_ANCHOR_FORMULA"),n(x,"SHIFT_ADD_BOOKMARK","SHIFT_ADD_BOOKMARK"),n(x,"SHIFT_ADD_BOARD","SHIFT_ADD_BOARD"),n(x,"SHIFT_ADD_CHARTS","SHIFT_ADD_CHARTS"),n(x,"SHIFT_ADD_FORMULA","SHIFT_ADD_FORMULA"),n(x,"SHIFT_ADD_FUNCTION","SHIFT_ADD_FUNCTION"),n(x,"SHIFT_ADD_OPERATIONBODY","SHIFT_ADD_OPERATIONBODY"),n(x,"SHIFT_ADD_VARIABLEBODY","SHIFT_ADD_VARIABLEBODY"),n(x,"SHIFT_ADD_SYMBOLBODY","SHIFT_ADD_SYMBOLBODY"),n(x,"SHIFT_SHOW_VIEW","SHIFT_SHOW_VIEW"),n(x,"SHIFT_SHOW_VIEW_ON","SHIFT_SHOW_VIEW_ON"),n(x,"SHIFT_REMOVE_BODY","SHIFT_REMOVE_BODY"),n(x,"SHIFT_ADD_BODY_VIEW","SHIFT_ADD_BODY_VIEW"),n(x,"SHIFT_REFRESH_LIBRARY_COORDINATES","SHIFT_REFRESH_LIBRARY_COORDINATES"),n(x,"IDINDEX",1),n(x,"PLAYER_INSTANCE_LEVEL_UP","PLAYER_INSTANCE_LEVEL_UP"),x),Folder=class{constructor(e=null){n(this,"name");n(this,"isFolder",!0);n(this,"isShow",!0);n(this,"isShowChild",!0);n(this,"tree",[]);n(this,"formulaTree",[]);n(this,"minArrowsView",null);n(this,"constructorName","Folder");n(this,"id");this.name=e,this.id=++EventManager.IDINDEX}setName(e){this.name=e}dispose(){this.name=null,this.isFolder=!1,this.isShowChild=!1,this.tree=[],this.formulaTree=[]}getMaxHeight(){let e=1;for(let t=0;t<this.tree.length;t++)this.tree[t].isShow&&(this.tree[t].isFolder?e+=this.tree[t].getMaxHeight():e++);return e}addTest(e){return this.tree.indexOf(e)==-1}spliceChild(e,t){this.addTest(e)&&this.tree.splice(t,0,e)}pushChild(e){this.addTest(e)&&this.tree.push(e)}unshiftChild(e){this.addTest(e)&&this.tree.unshift(e)}removeChild(e){if(!this.addTest(e)){const t=this.tree.indexOf(e);this.tree.splice(t,1)}}},FXCentre=class{constructor(){n(this,"callCenter",null);fx.sceneFolder=new Folder("场景根目录"),fx.targetFolder=fx.sceneFolder,this.initEventListener()}initEventListener(){this.callCenter=new CallCenter,this.callCenter.addEventListener(fx.Eve.ADD_DATABASE_DATA,this.addDataBaseFunction,null,this),this.callCenter.addEventListener(fx.Eve.ADD_OPERAND_DATA,this.addOperandFunction.bind(this))}addBody(e,t,r){e!=null&&!e.addTest(t)&&(Call.send(fx.Eve.SHIFT_REMOVE_BODY,[t,!1],null),e.addBody(t),Call.send(fx.Eve.SHIFT_ADD_BODY_VIEW,[e,t,r],null))}addOperandFunction(e){this.addBody(e[0],e[1],e[2])}addDataBaseFunction(e){this.addData(e[0],e[1],e[2])}addData(e,t,r){t!=null&&t.typeView!=null&&(t=null),t!=null&&t.isFolder?(e.parentFolder=t,r!=null?t.spliceChild(e,r):t.pushChild(e)):t==null?(e.parentFolder=fx.targetFolder,r!=null?fx.targetFolder.spliceChild(e,r):fx.targetFolder.pushChild(e)):(e.parentFolder=t.parentFolder,e.parentFolder.spliceChild(e,t.parentFolder.tree.indexOf(t)+1))}},NodeType=(e=>(e[e.Variable=1]="Variable",e[e.Macro=4]="Macro",e[e.CalculationLayer=5]="CalculationLayer",e.SymbolBody="SymbolBody",e.OperationBody="OperationBody",e.Bookmark="Bookmark",e[e.Sheet=11]="Sheet",e[e.LogicalBasic=12]="LogicalBasic",e[e.LogicalSlider=14]="LogicalSlider",e[e.LogicalBool=16]="LogicalBool",e))(NodeType||{});function getCatchValue(e,t,r,i){let s=0;try{s=e.getValue(t,r,i)}catch(l){console.log(l),s=0}return s}var getGlobalThis=()=>typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:{},VariableValue=class{constructor(e,t,r=null,i=null){n(this,"name");n(this,"id");n(this,"TID");n(this,"value",0);n(this,"selectedOutputInfo",0);n(this,"type");n(this,"operator",null);n(this,"isAI",!1);n(this,"macros","");n(this,"sheetData",null);n(this,"snNo",1);n(this,"isLogicalOpen",!1);n(this,"isDragging",!1);n(this,"logicalNumberList",[]);n(this,"formulaTextValue");n(this,"currentStep",0);n(this,"minValue",1);n(this,"maxValue",100);n(this,"step",10);n(this,"parent",null);n(this,"childCell");n(this,"childArray",[]);n(this,"childBodyArray",[]);n(this,"logicalChildArray",[]);n(this,"tree",[]);n(this,"cacheValue",null);n(this,"view",null);n(this,"body",null);n(this,"tag",null);n(this,"enemyBody",null);n(this,"enemyFlag",!1);n(this,"isWeight",!0);n(this,"statistics",0);n(this,"absoluteAddress",null);n(this,"site",null);n(this,"source",null);n(this,"captureCrit",!0);n(this,"upDateValue",1);n(this,"demoteValue",0);n(this,"funcType",0);n(this,"historyTarget",null);n(this,"isSystemShow",!1);n(this,"constructorName","VariableValue");this.name=e,this.value=t,this.type=r,this.id=++EventManager.IDINDEX,this.operator=i}setMacros(e){this.macros=e,this.getValue()}setGlobalValue(e){this.source!=null&&this.source.setValue(e)}setValue(e){this.type!==11&&(this.value=e,this.upDataChild(),this.type===1&&fx.code===!1&&this.updateVariableDisplay(e))}updateVariableDisplay(e){var i,s;const t=(i=fx.getDataById)==null?void 0:i.call(fx,this.id),r=(s=fx.getTreeDataById)==null?void 0:s.call(fx,this.id);if(t&&r){const l=getGlobalThis();if(l.window&&!l.window.updatingSheeData){const o=`componentDatas.nodeList.props.tree.props.dataSource.${r.dataPath}.showName`;l.window.set_data(l.window.store,o,`${this.name}=${e}`)}}}addNumberList(){this.logicalNumberList.push({value:""})}changeNumberListItem(e,t){this.logicalNumberList[e].value=t}getIsFunction(){return this.type===4}getRessSring(e){const t=[];return fx.getStepData(e,t),t.join("")}setEnemyBody(e){this.enemyBody=e}setSheetData(e){this.sheetData=new fx.SheetData(e),this.getValue(),this.upDataChild()}getValue(e,t,r){if(this.type!==1&&this.enemyFlag&&fx.enemyBody!=null)return this.value=getCatchValue(fx.enemyBody.getPropertyObject(this.source.absoluteAddress)),this.returnFunc(this.value);switch(this.type){case 4:return this.getMacroValue();case 11:return this.getSheetValue(e,t,r);case NodeType.LogicalNumberList:return this.getLogicalNumberListValue();case 14:return this.getLogicalSliderValue();case NodeType.LogicalList:case 12:return this.getLogicalValue();case 5:return this.getCalculationLayerValue();default:return this.getDefaultValue()}}getMacroValue(){try{if(this.historyTarget=globalThis.target,globalThis.target=this,this.macros==="")return this.value=0,this.returnFunc(this.value);if(fx.code)this.value=new Function(`return ${fx["f_"+this.TID].fun.replace(/[\r\n\s]/g,"")}`)();else try{this.value=eval(this.macros)}catch(e){this.value=0}return globalThis.target=this.historyTarget,isNaN(this.value)||(this.value=fx.double(this.value,4)),this.returnFunc(this.value)}catch(e){return this.value=0,this.value}}getSheetValue(e,t,r){var i,s,l;return this.value=((s=(i=this.source)==null?void 0:i.sheetData)==null?void 0:s.getValue(e,t,r))||((l=this.sheetData)==null?void 0:l.getValue(e,t,r))||0,this.returnFunc(this.value)}getLogicalNumberListValue(){const e=this.getNumberListValue();if(typeof e=="string"&&e.startsWith("[")){const t=JSON.parse(e),r=Math.floor(Math.random()*(t[1]-t[0]+1))+t[0];this.value=r}else this.value=Number(e);return this.returnFunc(this.value)}getNumberListValue(){return typeof this.snNo=="number"&&this.logicalNumberList.length&&this.snNo<=this.logicalNumberList.length&&this.logicalNumberList[this.snNo-1].value||0}getLogicalSliderValue(){const e=this.currentStep*this.step;return this.value=Math.max(this.minValue,Math.min(e,this.maxValue)),this.returnFunc(this.value)}getLogicalValue(){const e=this.logicalChildArray[this.snNo-1];return this.value=e?e.getValue():0,this.returnFunc(this.value)}getCalculationLayerValue(){var r;const e=(r=this.source)==null?void 0:r.body,t=this.body;return e?this.value=getCatchValue(e):t&&(this.value=getCatchValue(t)),isNaN(this.value)||(this.value=Number(fx.double(this.value,4))),this.returnFunc(this.value)}getDefaultValue(){return this.value||(this.value=0),isNaN(this.value)||(this.value=Number(this.value)),this.returnFunc(this.value)}returnFunc(e){return this.funcType===0?e:this.funcType>=1&&this.funcType<=23?this.handleFunction(e):this.funcType>=24&&this.funcType<=35?this.commonFormulaFunction():this.funcType>=36&&this.funcType<=43?this.triangleFunction(e):this.funcType>=44&&this.funcType<=51?this.logicFunction():this.funcType>=4&&this.funcType<=14||this.funcType>=52&&this.funcType<=55?this.commonFunction(e):this.funcType>=56&&this.funcType<=60?this.algorithmFunction():this.funcType>=61&&this.funcType<=68?this.gameFormulaFunction():e}handleFunction(e){const t=r=>getCatchValue(this.tree[r]);switch(this.funcType){case 1:return 1-e;case 2:return 1/e;case 3:return-e;case 15:return e*2;case 16:return e/2;case 17:return e*100;case 18:return e/100;case 19:return e*e;case 20:return this.tree.length<2?0:t(0)/t(1);case 21:return this.tree.length<2?0:t(0)/(t(0)+t(1));case 22:return this.tree.length<2?0:t(0)/(t(1)-t(0));case 23:return this.weightedRandom();case 10:return this.tree.length<2?0:Math.random()*(t(1)-t(0))+t(0);default:return e}}commonFormulaFunction(){const e=t=>getCatchValue(this.tree[t]);switch(this.funcType){case 24:return this.tree.length<2?0:e(0)-e(1);case 25:return this.tree.length<2?0:e(0)*e(0)/(e(0)+e(1));case 26:return this.tree.length<2?0:(e(0)-e(1))*(e(0)/e(1));case 27:return this.tree.length<2?0:e(0)*e(0)/e(1);case 28:return this.tree.length<2?0:e(0)/e(1);case 29:return this.tree.length<2?0:e(0)*(1-e(1));case 30:return this.tree.length<2?0:e(0)*e(1)/(1+e(0)*e(1));case 31:return this.tree.length<2?0:e(0)*e(1);case 32:return this.tree.length<3?0:e(0)/(1+e(1)*e(2));case 33:return this.tree.length<3?0:e(0)/e(1)*e(2);case 34:return this.tree.length<3?0:e(0)*e(2)/e(1);case 35:return this.tree.length<3?0:e(0)*(e(2)/e(1));default:return 0}}triangleFunction(e){const t=r=>getCatchValue(this.tree[r]);switch(this.funcType){case 36:return e*Math.PI;case 37:return Math.cos(e);case 38:return Math.sin(e);case 39:return Math.tan(e);case 40:return Math.acos(e);case 41:return Math.asin(e);case 42:return Math.atan(e);case 43:return this.tree.length<2?0:Math.atan2(t(0),t(1));default:return e}}logicFunction(){const e=t=>getCatchValue(this.tree[t]);if(this.tree.length<4&&this.funcType!==51&&this.funcType!==50)return 0;switch(this.funcType){case 44:return e(0)>e(1)?e(2):e(3);case 45:return e(0)>=e(1)?e(2):e(3);case 46:return e(0)<e(1)?e(2):e(3);case 47:return e(0)<=e(1)?e(2):e(3);case 48:return e(0)==e(1)?e(2):e(3);case 49:return e(0)!=e(1)?e(2):e(3);case 50:return this.complexForLoop();case 51:return this.tree.length>0?e(e(0)):0;default:return 0}}commonFunction(e){const t=r=>getCatchValue(this.tree[r]);switch(this.funcType){case 4:return Math.abs(e);case 5:return Math.random()*e;case 6:return Math.floor(e);case 7:return Math.sqrt(e);case 8:return Math.max(...this.tree.map((r,i)=>Number(t(i))));case 9:return Math.min(...this.tree.map((r,i)=>Number(t(i))));case 11:return this.tree.length<2?0:Math.pow(t(0),t(1));case 12:return Math.log(e);case 13:return Math.exp(e);case 14:return Math.cbrt(e);case 52:return Math.sign(e);case 53:return Math.imul(e,1);case 54:return Math.ceil(e);case 55:return Math.round(e);default:return e}}algorithmFunction(){const e=t=>getCatchValue(this.tree[t]);switch(this.funcType){case 56:return this.tree.length<2?0:fx.length(e(0),e(1));case 57:return this.tree.length<4?0:fx.distance(e(0),e(1),e(2),e(3));case 58:return this.tree.length<4?0:fx.dot(e(0),e(1),e(2),e(3));case 59:return this.tree.length<4?0:fx.cross(e(0),e(1),e(2),e(3));case 60:return this.tree.length<3?0:fx.mix(e(0),e(1),e(2));default:return 0}}gameFormulaFunction(){const e=t=>getCatchValue(this.tree[t]);switch(this.funcType){case 61:return this.tree.length<3?0:e(0)*e(2)*(1-1/(1+e(0)*e(2)/(5*e(1))));case 62:return this.tree.length<4?0:e(0)+e(2)*e(1)+e(3)*(1+e(1))*e(1)/2;case 63:case 64:return this.tree.length<5?0:e(0)*2+Math.pow(e(0)/10,2)+e(1)/5+e(2)/5+e(4)*e(3);case 65:return this.tree.length<1?0:e(0)*2+Math.pow(e(0)/10,2);case 66:case 67:return this.value;case 70:return this.tree.length<2?0:e(0)+e(1);default:return this.value}}weightedRandom(){if(this.tree.length%2!==0)return 0;let e=0;for(let r=1;r<this.tree.length;r+=2)this.tree[r].indexex=getCatchValue(this.tree[r])+e,e+=getCatchValue(this.tree[r]);const t=Math.random()*e;for(let r=1;r<this.tree.length;r+=2){const i=r===1?0:this.tree[r-2].indexex;if(t>=i&&t<this.tree[r].indexex)return getCatchValue(this.tree[r-1])}return 0}complexForLoop(){if(this.tree.length<3)return 0;let e=0,t=0;const r=getCatchValue(this.tree[0]),i=getCatchValue(this.tree[1]),s=getCatchValue(this.tree[2]);for(let l=r;l<=i;l++)l%s===1&&e++,t+=e+2;return t}getFormulaTextValueBody(){return{1:`1-(${this.value})`,2:`1/(${this.value})`,3:`-(${this.value})`,4:`abs(${this.value})`,5:`random()*${this.value}`,6:`floor(${this.value})`,7:`sqrt(${this.value})`,12:`log(${this.value})`,13:`exp(${this.value})`,14:`cbrt(${this.value})`,15:`(${this.value})*2`,16:`(${this.value})/2`,17:`(${this.value})*100`,18:`(${this.value})/100`,19:`${this.value}*${this.value}`,36:`${this.value}*PI`,37:`cos(${this.value})`,38:`sin(${this.value})`,39:`tan(${this.value})`,40:`acos(${this.value})`,41:`asin(${this.value})`,42:`atan(${this.value})`,52:`sign(${this.value})`,53:`imul(${this.value})`,54:`ceil(${this.value})`,55:`round(${this.value})`}[this.funcType]||this.formulaTextValue||String(this.value)}getFormulaTextValue(){return this.getFormulaTextValueBody()}getFormulaTextCharacterBody(){if(this.type===5)return this.body?this.body.getFormulaTextCharacter():"";if(this.type===4)return this.getValue();let e=this.name;return this.type===4&&(e=`${this.name}_${this.TID}`),{1:`1-(${this.name})`,2:`1/(${this.name})`,3:`-${this.name}`,4:`abs(${this.name})`,5:`random()*(${this.name})`,6:`floor(${this.name})`,7:`sqrt(${this.name})`,12:`log(${this.name})`,13:`exp(${this.name})`,14:`cbrt(${this.name})`,15:`${this.name}*2`,16:`${this.name}/2`,17:`${this.name}*100`,18:`${this.name}/100`,19:`${this.name}*${this.name}`,36:`${this.name}*PI`,37:`cos(${this.name})`,38:`sin(${this.name})`,39:`tan(${this.name})`,40:`acos(${this.name})`,41:`asin(${this.name})`,42:`atan(${this.name})`,52:`sign(${this.name})`,53:`imul(${this.name})`,54:`ceil(${this.name})`,55:`round(${this.name})`}[this.funcType]||e}getFormulaTextCharacter(){return this.getFormulaTextCharacterBody()}removeChild(e){const t=this.childArray.indexOf(e);t>-1&&this.childArray.splice(t,1)}dispose(){this.source!=null&&this.source.removeChild(this),this.macros="",this.childArray=[]}setParameter(e,t){this.name=e,this.value=t}upDataChild(){for(const e of this.childArray)e.name=this.name,e.value=this.value,e.body=this.body,e.TID=this.TID}setDataChild(e,t){this.name=e,this.value=t;for(const r of this.childArray)r.setDataChild(e,t)}syncBody(){for(const e of this.childArray)e.body=this.body}copy(){const e=new fx.VariableValue(this.name,this.value,this.type,this.operator);return e.source=this,e.body=this.body,e.TID=this.TID,this.childArray.push(e),e}},BasicBody=class{constructor(){n(this,"tree",[]);n(this,"parent",null);n(this,"type","BasicBody");n(this,"isWeight",!1);n(this,"value",null);n(this,"isAdvance",!1);n(this,"isBindingOperation",!1);n(this,"isBindingFormula",!1);n(this,"formulaTextValue","");n(this,"formulaTextCharacter","");n(this,"operationalLogicText","");n(this,"cacheElementValue",null);n(this,"funcType",0);n(this,"constructorName","BasicBody");n(this,"id");n(this,"typetype",null);n(this,"operator",null);n(this,"indexex",0);n(this,"isFunction",!1);n(this,"x",0);n(this,"y",0);this.id=++EventManager.IDINDEX}addTest(e){return this.tree.includes(e)?!0:this.tree.some(t=>t instanceof fx.BasicBody&&t.addTest(e))}replace(e,t){this.tree[t]=e,e.parent=this}deletebody(e){const t=this.tree.indexOf(e);t!==-1&&(this.tree.splice(t,1),e.parent=null)}addBody(e){this.tree.includes(e)||(e.parent=this,this.tree.push(e))}getDeleteBodyTree(e){const t=this.tree.indexOf(e);if(t===-1)return[];const r=this.tree.slice(t);return this.tree.splice(t),r}dispose(){this.tree.forEach(e=>{e&&typeof e.dispose=="function"&&e.dispose()}),this.tree=[],this.value=null,this.parent=null,this.typetype=null,this.cacheElementValue=null,this.formulaTextValue="",this.formulaTextCharacter="",this.operationalLogicText="",this.isWeight=!1,this.isAdvance=!1,this.isBindingOperation=!1,this.isBindingFormula=!1,this.isFunction=!1}getMaxHeight(){return this.tree.filter(t=>t instanceof fx.BasicBody).reduce((t,r)=>t+r.getMaxHeight(),0)||1}getValue(e,t,r){if(this.resetValues(),!!this.tree)return this.processTreeValues(),this.calculateFinalValue(),this.value=this.applyFunction(this.value),this.value}resetValues(){this.value=null,this.formulaTextValue="",this.formulaTextCharacter="",this.operationalLogicText="",this.cacheElementValue=null}processTreeValues(){for(const e of this.tree){const t=this.getNodeValue(e);this.updateOperationalLogic(e,t),this.updateFormulaTexts(e,t)}}getNodeValue(e){if(e.type===11){const{name:t,row:r,col:i}=(e==null?void 0:e.selectedOutputInfo)||{};return getCatchValue(e,t,r,i)}return e.type===5,getCatchValue(e)}updateOperationalLogic(e,t){var r;(r=this.cacheElementValue)!=null&&r.operator&&(this.operationalLogicText+=`(${t})`),this.cacheElementValue||(this.cacheElementValue=e,this.operationalLogicText+=`(${t})`),e.operator&&(this.operationalLogicText+=e.operator)}updateFormulaTexts(e,t){[0,1,2,3,4,5,11].includes(e.type)&&(this.formulaTextCharacter+=e.getFormulaTextCharacter(),this.formulaTextValue+=t,e.operator&&(this.formulaTextValue+=e.operator,this.formulaTextCharacter+=e.operator))}calculateFinalValue(){const e=this.formulaTextValue.slice(-1);["+","-","*","/","%",">",">=","<","<=","!="].includes(e)||(this.value=fx.eval(this.operationalLogicText)),isNaN(this.value)?this.value=this.operationalLogicText:this.value=Number(this.value)}applyFunction(e){return this.returnFunc(e)}returnFunc(e){const r=this.getFunctionHandlers()[this.funcType];return r?r(e,this.tree):e}getFunctionHandlers(){return{0:e=>e,1:e=>1-e,2:e=>1/e,3:e=>-e,15:e=>e*2,16:e=>e/2,17:e=>e*100,18:e=>e/100,19:e=>e*e,4:e=>Math.abs(e),5:e=>Math.random()*e,6:e=>Math.floor(e),7:e=>Math.sqrt(e),8:(e,t)=>this.calculateMax(t),9:(e,t)=>this.calculateMin(t),11:(e,t)=>this.calculatePower(t),12:e=>Math.log(e),13:e=>Math.exp(e),14:e=>Math.cbrt(e),52:e=>Math.sign(e),53:e=>Math.imul(e,1),54:e=>Math.ceil(e),55:e=>Math.round(e),10:(e,t)=>this.calculateRandom(t),20:(e,t)=>this.divideValues(t),21:(e,t)=>this.divideBySum(t),22:(e,t)=>this.divideByDifference(t),23:(e,t)=>this.weightedRandom(t),24:(e,t)=>this.attackMinusDefense(t),25:(e,t)=>this.attackSquaredOverDiff(t),26:(e,t)=>this.diffTimesRatio(t),27:(e,t)=>this.attackSquaredOverDefense(t),28:(e,t)=>this.attackOverDefense(t),29:(e,t)=>this.attackWithCoefficient(t),30:(e,t)=>this.armorFormula(t),31:(e,t)=>this.attackWithDamageRate(t),32:(e,t)=>this.attackOverDefenseFormula(t),33:(e,t)=>this.attackRatioWithCoef(t),34:(e,t)=>this.attackCoefOverDefense(t),35:(e,t)=>this.attackTimesCoefRatio(t),36:e=>e*Math.PI,37:e=>Math.cos(e),38:e=>Math.sin(e),39:e=>Math.tan(e),40:e=>Math.acos(e),41:e=>Math.asin(e),42:e=>Math.atan(e),43:(e,t)=>this.calculateAtan2(t),44:(e,t)=>this.ifGreater(t),45:(e,t)=>this.ifGreaterEqual(t),46:(e,t)=>this.ifLess(t),47:(e,t)=>this.ifLessEqual(t),48:(e,t)=>this.ifEqual(t),49:(e,t)=>this.ifNotEqual(t),50:(e,t)=>this.forLoop(t),51:(e,t)=>this.arrayAccess(t),56:(e,t)=>this.calculateLength(t),57:(e,t)=>this.calculateDistance(t),58:(e,t)=>this.calculateDot(t),59:(e,t)=>this.calculateCross(t),60:(e,t)=>this.calculateMix(t),61:(e,t)=>this.battleFormula(t),62:(e,t)=>this.characterHealth(t),63:(e,t)=>this.meleeAttack(t),64:(e,t)=>this.rangedAttack(t),65:(e,t)=>this.mageAttack(t),66:(e,t)=>this.physicalDefense(t),67:(e,t)=>this.magicDefense(t),68:(e,t)=>this.hitRate(t),69:(e,t)=>this.dodgeRate(t),70:e=>1+e/3,71:e=>1+e/5,72:(e,t)=>this.jobPointGrowth(t),73:(e,t)=>this.finalMeleeAttack(t),74:(e,t)=>this.finalRangedAttack(t),75:(e,t)=>this.finalMagicAttack(t),76:(e,t)=>this.physicalDamage(t),77:(e,t)=>this.magicDamage(t),78:(e,t)=>this.hitChance(t),79:(e,t)=>this.critChance(t),80:(e,t)=>this.growthFormula(t)}}getTreeValue(e,t){return e.length>t?Number(getCatchValue(e[t])):0}calculateMax(e){const t=e.map(r=>Number(getCatchValue(r)));return Math.max(...t)}calculateMin(e){const t=e.map(r=>Number(getCatchValue(r)));return Math.min(...t)}calculatePower(e){return e.length<2?0:Math.pow(this.getTreeValue(e,0),this.getTreeValue(e,1))}calculateRandom(e){if(e.length<2)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1);return Math.random()*(r-t)+t}divideValues(e){return e.length<2?0:this.getTreeValue(e,0)/this.getTreeValue(e,1)}divideBySum(e){if(e.length<2)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1);return t/(t+r)}divideByDifference(e){if(e.length<2)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1);return t/(r-t)}weightedRandom(e){if(e.length%2!==0)return 0;let t=0;for(let i=1;i<e.length;i+=2){const s=this.getTreeValue(e,i);e[i].indexex=s+t,t+=s}const r=Math.random()*t;for(let i=1;i<e.length;i+=2){const s=i>1&&e[i-2].indexex||0,l=e[i].indexex||0;if(r>=s&&r<l)return this.getTreeValue(e,i-1)}return 0}attackMinusDefense(e){return e.length<2?0:this.getTreeValue(e,0)-this.getTreeValue(e,1)}attackSquaredOverDiff(e){if(e.length<2)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1);return t*t/(t+r)}diffTimesRatio(e){if(e.length<2)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1);return(t-r)*(t/r)}attackSquaredOverDefense(e){if(e.length<2)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1);return t*t/r}attackOverDefense(e){return e.length<2?0:this.getTreeValue(e,0)/this.getTreeValue(e,1)}attackWithCoefficient(e){return e.length<2?0:this.getTreeValue(e,0)*(1-this.getTreeValue(e,1))}armorFormula(e){if(e.length<2)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1);return t*r/(1+t*r)}attackWithDamageRate(e){return e.length<2?0:this.getTreeValue(e,0)*this.getTreeValue(e,1)}attackOverDefenseFormula(e){if(e.length<3)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1),i=this.getTreeValue(e,2);return t/(1+r*i)}attackRatioWithCoef(e){return e.length<3?0:this.getTreeValue(e,0)/this.getTreeValue(e,1)*this.getTreeValue(e,2)}attackCoefOverDefense(e){return e.length<3?0:this.getTreeValue(e,0)*this.getTreeValue(e,2)/this.getTreeValue(e,1)}attackTimesCoefRatio(e){return e.length<3?0:this.getTreeValue(e,0)*(this.getTreeValue(e,2)/this.getTreeValue(e,1))}calculateAtan2(e){return e.length<2?0:Math.atan2(this.getTreeValue(e,0),this.getTreeValue(e,1))}ifGreater(e){return e.length<4?0:this.getTreeValue(e,0)>this.getTreeValue(e,1)?this.getTreeValue(e,2):this.getTreeValue(e,3)}ifGreaterEqual(e){return e.length<4?0:this.getTreeValue(e,0)>=this.getTreeValue(e,1)?this.getTreeValue(e,2):this.getTreeValue(e,3)}ifLess(e){return e.length<4?0:this.getTreeValue(e,0)<this.getTreeValue(e,1)?this.getTreeValue(e,2):this.getTreeValue(e,3)}ifLessEqual(e){return e.length<4?0:this.getTreeValue(e,0)<=this.getTreeValue(e,1)?this.getTreeValue(e,2):this.getTreeValue(e,3)}ifEqual(e){return e.length<4?0:this.getTreeValue(e,0)===this.getTreeValue(e,1)?this.getTreeValue(e,2):this.getTreeValue(e,3)}ifNotEqual(e){return e.length<4?0:this.getTreeValue(e,0)!==this.getTreeValue(e,1)?this.getTreeValue(e,2):this.getTreeValue(e,3)}forLoop(e){if(e.length<4)return 0;let t=0,r=0;const i=this.getTreeValue(e,0),s=this.getTreeValue(e,1),l=this.getTreeValue(e,2),o=this.getTreeValue(e,3);for(let u=i;u<=s;u++)u%l===1&&t++,r+=t+o;return r}arrayAccess(e){if(e.length<2)return 0;const t=this.getTreeValue(e,0);return this.getTreeValue(e,t)}calculateLength(e){return e.length<2?0:fx.length(this.getTreeValue(e,0),this.getTreeValue(e,1))}calculateDistance(e){return e.length<4?0:fx.distance(this.getTreeValue(e,0),this.getTreeValue(e,1),this.getTreeValue(e,2),this.getTreeValue(e,3))}calculateDot(e){return e.length<4?0:fx.dot(this.getTreeValue(e,0),this.getTreeValue(e,1),this.getTreeValue(e,2),this.getTreeValue(e,3))}calculateCross(e){return e.length<4?0:fx.cross(this.getTreeValue(e,0),this.getTreeValue(e,1),this.getTreeValue(e,2),this.getTreeValue(e,3))}calculateMix(e){return e.length<3?0:fx.mix(this.getTreeValue(e,0),this.getTreeValue(e,1),this.getTreeValue(e,2))}battleFormula(e){if(e.length<3)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1),i=this.getTreeValue(e,2);return t*i*(1-1/(1+t*i/(5*r)))}characterHealth(e){if(e.length<4)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1),i=this.getTreeValue(e,2),s=this.getTreeValue(e,3);return t+i*r+s*(1+r)*r/2}meleeAttack(e){if(e.length<5)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1),i=this.getTreeValue(e,2),s=this.getTreeValue(e,3),l=this.getTreeValue(e,4);return t*2+Math.pow(t/10,2)+r/5+i/5+l*s}rangedAttack(e){if(e.length<5)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1),i=this.getTreeValue(e,2),s=this.getTreeValue(e,3),l=this.getTreeValue(e,4);return t*2+Math.pow(t/10,2)+r/5+i/5+l*s}mageAttack(e){if(e.length<1)return 0;const t=this.getTreeValue(e,0);return t*2+Math.pow(t/10,2)}physicalDefense(e){return this.value}magicDefense(e){return this.value}hitRate(e){return e.length<2?0:this.getTreeValue(e,0)+this.getTreeValue(e,1)}dodgeRate(e){return e.length<2?0:this.getTreeValue(e,0)+this.getTreeValue(e,1)}jobPointGrowth(e){return e.length<2?0:1+this.getTreeValue(e,0)/this.getTreeValue(e,1)}finalMeleeAttack(e){if(e.length<8)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1),i=this.getTreeValue(e,2),s=this.getTreeValue(e,3),l=this.getTreeValue(e,4),o=this.getTreeValue(e,5),u=this.getTreeValue(e,6),h=this.getTreeValue(e,7);return(t*7+t/5+r/5+i/5+s+(s+l)*o)*u*h}finalRangedAttack(e){if(e.length<8)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1),i=this.getTreeValue(e,2),s=this.getTreeValue(e,3),l=this.getTreeValue(e,4),o=this.getTreeValue(e,5),u=this.getTreeValue(e,6),h=this.getTreeValue(e,7);return(t*5+t/5+r/5+i/5+s+(s+l)*o)*u*h}finalMagicAttack(e){if(e.length<6)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1),i=this.getTreeValue(e,2),s=this.getTreeValue(e,3),l=this.getTreeValue(e,4),o=this.getTreeValue(e,5);return(t*7+t/5+r+(r+i)*s)*l*o}physicalDamage(e){if(e.length<2)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1);return t*(4e3+r)/(4e3+r*10)}magicDamage(e){if(e.length<2)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1);return t*(1e3+r)/(1e3+r*10)}hitChance(e){if(e.length<2)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1);return(t-r+80)/100}critChance(e){if(e.length<2)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1);return(t-r)/100}growthFormula(e){if(e.length<2)return 0;const t=this.getTreeValue(e,0),r=this.getTreeValue(e,1);return(t-1)*r}getFormulaTextValueBody(){const t=this.getFormulaTextBuilders()[this.funcType];return t?t(this.formulaTextValue,this.tree):this.formulaTextValue}getFormulaTextBuilders(){return{0:e=>e,1:e=>`(1-(${e}))`,2:e=>`1/(${e})`,3:e=>`-(${e})`,15:e=>`(${e})*2`,16:e=>`(${e})/2`,17:e=>`(${e})*100`,18:e=>`(${e})/100`,19:e=>`(${e})*(${e})`,4:e=>`abs(${e})`,5:e=>`random()*(${e})`,6:e=>`floor(${e})`,7:e=>`sqrt(${e})`,8:(e,t)=>this.buildMaxText(t),9:(e,t)=>this.buildMinText(t),11:(e,t)=>this.buildPowerText(t),12:e=>`log(${e})`,13:e=>`exp(${e})`,14:e=>`cbrt(${e})`,52:e=>`sign(${e})`,53:e=>`imul(${e})`,54:e=>`ceil(${e})`,55:e=>`round(${e})`,10:(e,t)=>this.buildRandomRangeText(t),20:(e,t)=>this.buildDivisionText(t),21:(e,t)=>this.buildDivisionSumText(t),22:(e,t)=>this.buildDivisionDiffText(t),23:(e,t)=>this.buildWeightedText(t),24:(e,t)=>this.buildAttackDefenseText(t,"-"),25:(e,t)=>this.buildComplexAttackText(t,1),26:(e,t)=>this.buildComplexAttackText(t,2),27:(e,t)=>this.buildComplexAttackText(t,3),28:(e,t)=>this.buildAttackDefenseText(t,"/"),36:e=>`(${e})*PI`,37:e=>`cos(${e})`,38:e=>`sin(${e})`,39:e=>`tan(${e})`,40:e=>`acos(${e})`,41:e=>`asin(${e})`,42:e=>`atan(${e})`,43:(e,t)=>this.buildAtan2Text(t),44:(e,t)=>this.buildIfText(t,">"),45:(e,t)=>this.buildIfText(t,">="),46:(e,t)=>this.buildIfText(t,"<"),47:(e,t)=>this.buildIfText(t,"<="),48:(e,t)=>this.buildIfText(t,"=="),49:(e,t)=>this.buildIfText(t,"!="),50:(e,t)=>this.buildForLoopText(t),51:(e,t)=>this.buildArrayAccessText(t),56:(e,t)=>this.buildAlgorithmText(t,"length"),57:(e,t)=>this.buildAlgorithmText(t,"distance"),58:(e,t)=>this.buildAlgorithmText(t,"dot"),59:(e,t)=>this.buildAlgorithmText(t,"cross"),60:(e,t)=>this.buildMixText(t),61:(e,t)=>this.buildBattleFormulaText(t),62:(e,t)=>this.buildCharacterHealthText(t),63:(e,t)=>this.buildMeleeAttackText(t),64:(e,t)=>this.buildRangedAttackText(t),65:(e,t)=>this.buildMageAttackText(t),76:(e,t)=>this.buildPhysicalDamageText(t),77:(e,t)=>this.buildMagicDamageText(t),78:(e,t)=>this.buildHitChanceText(t),79:(e,t)=>this.buildCritChanceText(t),80:(e,t)=>this.buildGrowthText(t)}}buildMaxText(e){return`max(${e.map(r=>r.getFormulaTextValue()).join(",")})`}buildMinText(e){return`min(${e.map(r=>r.getFormulaTextValue()).join(",")})`}buildPowerText(e){return e.length<2?"参数不匹配,请输入[值,值]":`pow(${e[0].getFormulaTextValue()},${e[1].getFormulaTextValue()})`}buildRandomRangeText(e){if(e.length<2)return"参数不匹配,请输入[最小值,最大值]";const t=e[0].getFormulaTextValue();return`random()*(${e[1].getFormulaTextValue()}-${t})+${t}`}buildDivisionText(e){return e.length<2?"参数不匹配,请输入[值,值]":`(${e[0].getFormulaTextValue()})/(${e[1].getFormulaTextValue()})`}buildDivisionSumText(e){if(e.length<2)return"参数不匹配,请输入[值,值]";const t=e[0].getFormulaTextValue(),r=e[1].getFormulaTextValue();return`${t}/(${t}+${r})`}buildDivisionDiffText(e){if(e.length<2)return"参数不匹配,请输入[值,值]";const t=e[0].getFormulaTextValue(),r=e[1].getFormulaTextValue();return`${t}/(${r}-${t})`}buildWeightedText(e){if(e.length%2!==0)return"参数不匹配,请输入[值,权重]";const t=[];for(let r=0;r<e.length;r+=2)t.push(`[值:${e[r].getFormulaTextValue()},权重:${e[r+1].getFormulaTextValue()}]`);return t.join(",")}buildAttackDefenseText(e,t){return e.length<2?"参数不匹配,请输入[攻击,防御]":`${e[0].getFormulaTextValue()}${t}${e[1].getFormulaTextValue()}`}buildComplexAttackText(e,t){if(e.length<2)return"参数不匹配,请输入[攻击,防御]";const r=e[0].getFormulaTextValue(),i=e[1].getFormulaTextValue();switch(t){case 1:return`${r}*${r}/(${r}+${i})`;case 2:return`(${r}-${i})*(${r}/${i})`;case 3:return`${r}*${r}/${i}`;default:return""}}buildAtan2Text(e){return e.length<2?"参数不匹配,请输入[值,值]":`atan2(${e[0].getFormulaTextValue()},${e[1].getFormulaTextValue()})`}buildIfText(e,t){if(e.length<4)return"参数不匹配,请输入[值,值,值,值]";const[r,i,s,l]=e.map(o=>o.getFormulaTextValue());return`if(${r}${t}${i}){return ${s}}else{return ${l}}`}buildForLoopText(e){if(e.length<4)return"参数不匹配,请输入[初始等级,当前等级,间隔值,初始值]";const[t,r,i,s]=e.map(l=>l.getFormulaTextValue());return`for(var i=${t};i<=${r};i++){if(i%${i}==1){a++}c+=a+${s}}`}buildArrayAccessText(e){return e.length<2?"参数不匹配,请输入下标和数组":`[${e[0].getFormulaTextValue()}]`}buildAlgorithmText(e,t){const r=t==="mix"?3:4,i=t==="mix"?"[值1,值2,混合比例]":"[x1,y1,x2,y2]";if(e.length<r)return`参数不匹配,请输入${i}`;const s=e.slice(0,r).map(l=>l.getFormulaTextValue()).join(",");return`${t}(${s})`}buildMixText(e){return e.length<3?"参数不匹配,请输入[值1,值2,混合比例]":`mix(${e.slice(0,3).map(r=>r.getFormulaTextValue()).join(",")})`}buildBattleFormulaText(e){if(e.length<3)return"参数不匹配,请输入[攻击,防御,技能系数]";const[t,r,i]=e.map(s=>s.getFormulaTextValue());return`${t}*${i}*(1-(1/(1+((${t}*${i})/(5*${r})))))`}buildCharacterHealthText(e){if(e.length<4)return"参数不匹配,请输入[基础生命,等级,职业系数A,职业系数B]";const[t,r,i,s]=e.map(l=>l.getFormulaTextValue());return`${t}+${i}*${r}+${s}*(1+${r})*${r}/2`}buildMeleeAttackText(e){if(e.length<5)return"参数不匹配,请输入[力量,灵巧,幸运,等级,职业攻击系数]";const[t,r,i,s,l]=e.map(o=>o.getFormulaTextValue());return`${t}*2+pow((${t}/10),2)+${r}/5+${i}/5+${l}*${s}`}buildRangedAttackText(e){if(e.length<5)return"参数不匹配,请输入[灵巧,力量,幸运,等级,职业攻击系数]";const[t,r,i,s,l]=e.map(o=>o.getFormulaTextValue());return`${t}*2+pow((${t}/10),2)+${r}/5+${i}/5+${l}*${s}`}buildMageAttackText(e){if(e.length<1)return"参数不匹配,请输入[力量]";const t=e[0].getFormulaTextValue();return`${t}*2+pow(${t}/10,2)`}buildPhysicalDamageText(e){if(e.length<2)return"参数不匹配,请输入[物攻,物防]";const[t,r]=e.map(i=>i.getFormulaTextValue());return`${t}*(4000+${r})/(4000+(${r}*10))`}buildMagicDamageText(e){if(e.length<2)return"参数不匹配,请输入[魔攻,魔防]";const[t,r]=e.map(i=>i.getFormulaTextValue());return`${t}*(1000+${r})/(1000+(${r}*10))`}buildHitChanceText(e){if(e.length<2)return"参数不匹配,请输入[命中,闪避]";const[t,r]=e.map(i=>i.getFormulaTextValue());return`(${t}-${r}+80)/100`}buildCritChanceText(e){if(e.length<2)return"参数不匹配,请输入[暴击,抗暴]";const[t,r]=e.map(i=>i.getFormulaTextValue());return`(${t}-${r})/100`}buildGrowthText(e){if(e.length<2)return"参数不匹配,请输入[等级,属性成长值]";const[t,r]=e.map(i=>i.getFormulaTextValue());return`(${t}-1)*${r}`}getFormulaTextValue(){return this.getFormulaTextValueBody()}getFormulaTextCharacterBody(){return this.formulaTextCharacter}getFormulaTextCharacter(){return this.getFormulaTextCharacterBody()}},SymbolBody=class extends BasicBody{constructor(){super();n(this,"operator",null);n(this,"type","SymbolBody");n(this,"isFunctionId",1);n(this,"funcType",0);n(this,"constructorName","SymbolBody")}copy(){var t=new fx.SymbolBody;return t.operator=this.operator,t.isFunctionId=this.isFunctionId,t.tree=this.tree,t.parent=this.parent,t.value=this.value,t.isWeight=this.isWeight,t.isBindingOperation=this.isBindingOperation,t.isBindingFormula=this.isBindingFormula,t.formulaTextValue=this.formulaTextValue,t.formulaTextCharacter=this.formulaTextCharacter,t.operationalLogicText=this.operationalLogicText,t.cacheElementValue=this.cacheElementValue,t}setFunctionId(t){this.isFunctionId=t}getRunFunctionId(){var t=this.getFunctionLength();return this.isFunctionId++,this.isFunctionId>t&&(this.isFunctionId=1),this.isFunctionId}getFunctionLength(){for(var t=0,r=0;r<this.tree.length;r++)this.tree[r].isFunction&&t++;return t}getFunction(t){for(var r=0,i=0;i<this.tree.length;i++)if(this.tree[i].isFunction&&(r++,r==t))return this.tree[i];return null}getValue(){if((this.operator=="fx"||this.operator=="=")&&this.getFunctionLength()>0){const r=this.getFunction(this.isFunctionId);return r?this.value=this.returnFunc(getCatchValue(r)):this.value=null,this.value}else{this.value=null,this.operationalLogicText="";for(var t=0;t<this.tree.length;t++)t<this.tree.length-1?this.operationalLogicText+=Number(getCatchValue(this.tree[t]))+(this.operator||""):this.operationalLogicText+="("+Number(getCatchValue(this.tree[t]))+")";this.value=fx.eval(this.operationalLogicText)}return isNaN(this.value)?(this.value=this.returnFunc(this.value),this.value):(this.value=this.returnFunc(Number(this.value)),this.value)}getFormulaTextCharacter(){if(this.operator=="="&&this.getFunctionLength()>0){const s=this.getFunction(this.isFunctionId);s?this.formulaTextCharacter="("+s.getFormulaTextCharacter()+")":this.formulaTextCharacter=""}else{this.formulaTextCharacter="";for(var t=0;t<this.tree.length;t++)if(t<this.tree.length-1)this.formulaTextCharacter+="("+this.tree[t].getFormulaTextCharacter()+")"+(this.operator||"");else{var r=this.tree[t].getFormulaTextCharacter();r.indexOf("+")==-1&&r.indexOf("-")==-1&&r.indexOf("*")==-1&&r.indexOf("/")==-1&&r.indexOf("%")==-1&&r.indexOf(">")==-1&&r.indexOf(">=")==-1&&r.indexOf("<")==-1&&r.indexOf("<=")==-1&&r.indexOf("==")==-1?this.formulaTextCharacter+=r:this.formulaTextCharacter+="("+r+")"}}var i=this.formulaTextCharacter;return this.funcType!=0&&(i=this.getFormulaTextCharacterBody()),i}getFormulaTextValue(){if(this.funcType==0){if(this.operator=="="&&this.getFunctionLength()>0){const i=this.getFunction(this.isFunctionId);i?this.formulaTextValue="("+i.getFormulaTextValue()+")":this.formulaTextValue=""}else{this.formulaTextValue="";for(var t=0;t<this.tree.length;t++){var r=this.tree[t].getFormulaTextValue();t<this.tree.length-1?this.formulaTextValue+="("+r+")"+(this.operator||""):r.indexOf("+")==-1&&r.indexOf("-")==-1&&r.indexOf("*")==-1&&r.indexOf("/")==-1&&r.indexOf("%")==-1&&r.indexOf(">")==-1&&r.indexOf(">=")==-1&&r.indexOf("<")==-1&&r.indexOf("<=")==-1&&r.indexOf("==")==-1?this.formulaTextValue+=r:this.formulaTextValue+="("+r+")"}}return this.formulaTextValue}else return this.getFormulaTextValueBody()}dispose(){for(var t=0;t<this.tree.length;t++)this.tree[t].dispose()}},OperationBody=class extends BasicBody{constructor(){super();n(this,"type","OperationBody");n(this,"constructorName","OperationBody");n(this,"isFunction",!1)}},FormulaData=class{constructor(e,t,r){n(this,"name");n(this,"x");n(this,"y");n(this,"body",null);n(this,"type","Formula");n(this,"cacheTargetStoragePool",null);n(this,"cacheTargetFolder",null);n(this,"constructorName","FormulaData");n(this,"id",0);this.name=e,this.x=t,this.y=r,this.cacheTargetStoragePool=fx.targetStoragePool,this.cacheTargetFolder=fx.targetFolder.formulaTree,this.cacheTargetStoragePool.push(this),this.cacheTargetFolder.push(this),this.id=++EventManager.IDINDEX}getValue(){return this.body!=null?getCatchValue(this.body):0}dispose(){let e=this.cacheTargetStoragePool.indexOf(this);e>=0&&this.cacheTargetStoragePool.splice(e,1),e=this.cacheTargetFolder.indexOf(this),this.cacheTargetFolder.splice(e,1)}},Player=class{constructor(){n(this,"name","");n(this,"hp",0);n(this,"maxHp",0);n(this,"maxShield",0);n(this,"shield",0);n(this,"enemyBody",null);n(this,"battlePool",[]);n(this,"valist",[]);n(this,"lflist",[]);n(this,"brlist",[]);n(this,"instantiation",null);n(this,"playerData",null);n(this,"folder",null);n(this,"comboxMaxHp","未设置血量公式");n(this,"combBoxAttack","未设置攻击公式");n(this,"underAttackName","");n(this,"shieldRuptureName","");n(this,"isShieldDetection",!1);n(this,"dieName","");n(this,"isDie",!1);n(this,"delayCustomList",[]);n(this,"callCenter",null);n(this,"tagArray",[]);n(this,"id",0);n(this,"constructorName","Player");n(this,"attackNum",0);n(this,"level",1);n(this,"levelVar","");n(this,"maxLEvel",100);n(this,"exp",0);n(this,"expName","");n(this,"levelUpConfig",{});n(this,"parameterInfoArray",[]);this.name="",this.hp=0,this.maxHp=0,this.maxShield=0,this.shield=0,this.enemyBody=null,this.level=1,this.levelVar="",this.battlePool=[],this.valist=[],this.lflist=[],this.brlist=[],this.instantiation=null,this.playerData=null,this.updatePlayerData(),this.comboxMaxHp="未设置血量公式",this.combBoxAttack="未设置攻击公式",this.underAttackName="",this.shieldRuptureName="",this.isShieldDetection=!1,this.dieName="",this.isDie=!1,this.delayCustomList=[],this.callCenter=new CallCenter,this.callCenter.addEventListener(EventManager.UP_DATA_PLAYER,this.upDataPlayerFunction,null,this),this.tagArray=[],this.id=++EventManager.IDINDEX,this.constructorName="Player",this.attackNum=0}resetTag(){this.tagArray=[]}gesetTagPopulation(e){let t=0;for(let r=0;r<this.tagArray.length;r++)this.tagArray[r].name==e&&t++;return t}gesetTagAll(){return this.tagArray}addTag(e){this.tagArray.push({name:e})}upDataPlayerFunction(e){this.updatePlayerData()}updatePlayerData(){fx.player=this,this.attackNum=0,this.playerData=this.createPlayer()}recursionSet(e,t){fx.player=this;for(let r=0;r<e.length;r++)e[r]instanceof VariableValue?e[r].enemyFlag&&(t==null?e[r].setEnemyBody(null):e[r].setEnemyBody(t.getPropertyObject(e[r].source.absoluteAddress))):this.recursionSet(e[r].tree,t)}getFormula(e){fx.player=this,fx.clearCacheRecursion(this.folder);let t=0;for(let r=0;r<this.playerData.formulaTree.length;r++)if(this.playerData.formulaTree[r].name==e){t=this.playerData.formulaTree[r].body.getValue();break}for(let r=0;r<fx.stageStoragePool.length;r++)fx.stageStoragePool[r]instanceof FormulaData&&fx.stageStoragePool[r].name==e&&(t=fx.stageStoragePool[r].body.getValue());return t}delay(e,t,r,i){const s=e+"次数";this[""+e]==null&&(this[""+e]=0,this.delayCustomList.push(""+e)),this[""+s]==null&&(this[""+s]=0,this.delayCustomList.push(""+s)),this[""+e]++,this[""+e]>=t&&Number(this[""+s])<=Number(r)+1&&(this[""+e]=0,this[""+s]++,i())}hit(e,t,r){this.instantiation!=null}attack(e,t){this.attackNum++,fx.player=this,fx.clearCacheRecursion(this.folder),fx.isCrit=!1;let r=0,i=0;for(let s=0;s<this.playerData.formulaTree.length;s++)if(this.playerData.formulaTree[s].name==e){fx.enemyBody=t,this.enemyBody=t,r=this.playerData.formulaTree[s].body.getValue();let l=t.isDie;t.getShield()!=0?t.minusShield(r):t.minusHp(r),!l&&t.isDie&&i++,fx.enemyBody=null;break}for(let s=0;s<fx.stageStoragePool.length;s++)if(fx.stageStoragePool[s]instanceof FormulaData&&fx.stageStoragePool[s].name==e){fx.enemyBody=t,this.enemyBody=t,r=fx.stageStoragePool[s].body.getValue();let l=t.isDie;t.getShield()!=0?t.minusShield(r):t.minusHp(r),!l&&t.isDie&&i++,fx.enemyBody=null}return i>0&&this.onEnmeyKilled(i),[r,fx.isCrit]}getNeedExp(){return 1}onEnmeyKilled(e){this.exp+=e,this.checkUpdateLevel()}checkUpdateLevel(){let e=this.getNeedExp();this.exp>=e&&this.level<this.maxLEvel&&(this.level++,this.exp=0,fx.Call.send(EventManager.PLAYER_INSTANCE_LEVEL_UP,[this.id,this.level,this.exp]))}setMaxShield(e){fx.player=this,fx.clearCacheRecursion(this.folder),this.maxShield=0,this.shield=0;for(let t=0;t<this.playerData.formulaTree.length;t++)if(this.playerData.formulaTree[t].name==e){this.maxShield=this.playerData.formulaTree[t].body.getValue(),this.shield=this.maxShield;break}for(let t=0;t<fx.stageStoragePool.length;t++)fx.stageStoragePool[t]instanceof FormulaData&&fx.stageStoragePool[t].name==e&&(this.maxShield=fx.stageStoragePool[t].body.getValue(),this.shield=this.maxShield);return e=="无"&&(this.maxShield=this.shield=0),this.isShieldDetection=!1,this.maxShield}setMaxHp(e){fx.player=this,fx.clearCacheRecursion(this.folder),this.maxHp=0,this.hp=0;for(let t=0;t<this.playerData.formulaTree.length;t++)if(this.playerData.formulaTree[t].name==e){this.maxHp=this.playerData.formulaTree[t].body.getValue(),this.hp=this.maxHp;break}for(let t=0;t<fx.stageStoragePool.length;t++)fx.stageStoragePool[t]instanceof FormulaData&&fx.stageStoragePool[t].name==e&&(this.maxHp=fx.stageStoragePool[t].body.getValue(),this.hp=this.maxHp);e=="无"&&(this.maxHp=this.hp=0),this.isDie=!1;for(let t=0;t<this.delayCustomList.length;t++)this[this.delayCustomList[t]]=null;return this.maxHp}getMaxHp(){return this.maxHp}getMaxShield(){return this.maxShield}getShield(){return this.shield}getHp(){return this.hp}setHp(e){this.hp=e}setShield(e){this.shield=e}underAttack(){this.getFormula(this.underAttackName)}setshieldRupture(e){this.shieldRuptureName=e}setUnderAttack(e){this.underAttackName=e}shieldRupture(){this.getFormula(this.shieldRuptureName),this.isShieldDetection=!0}minusShield(e){return this.shield-=e,this.shield<=0&&this.isShieldDetection==!1&&(this.shield=0,this.shieldRupture()),this.underAttack(),this.shield}setDie(e){this.dieName=e}die(){this.getFormula(this.dieName),this.isDie=!0}minusHp(e){return this.hp-=e,this.hp<=0&&this.isDie==!1&&(this.hp=0,this.die()),this.underAttack(),this.hp}getBillboard(){fx.player=this;const e=[];return fx.recursionGetBillboard(e,this.playerData),e.length==0?fx.billBoardList:e}getPropertyObject(e,t){return fx.player=this,fx.getBody(this.playerData,fx.parseAbsoluteAddress(e),t)}setProperty(e,t){fx.player=this;const r=this.getPropertyObject(e);return r!=null?r.setValue(t):console.log("没有找到属性"),t}getProperty(e,t){return fx.player=this,fx.clearCache(),this.getPropertyObject(e)!=null?fx.getBody(this.playerData,fx.parseAbsoluteAddress(e),t).getValue():(console.log("没有找到属性"),0)}dispose(){this.callCenter.dispose(),this.playerData.dispose(),this.name=null,this.hp=null,this.maxHp=null,this.playerData=null,this.callCenter=null,this.tagArray=null,this.id=null,this.constructorName=null,this.attackNum=null}clearCache(){fx.player=this,fx.clearCacheRecursion(this.folder)}createPlayer(){this.attackNum=0,fx.editBody=null,fx.selectBody=null,fx.isBodyView=!1,this.folder=new fx.Folder;const e=[];fx.addLibraryBody(e,fx.targetFolder.tree);const t=e;return fx.targetFolder=this.folder,fx.createLibraryBody(t,!0),fx.parseLibraryBody(t,!0),fx.recursionSyncBody(fx.targetFolder.tree),fx.editBody=null,fx.selectBody=null,fx.targetStoragePool=fx.stageStoragePool,fx.targetFolder=fx.sceneFolder,fx.isBodyView=!0,this.valist=[],this.lflist=[],this.brlist=[],fx.recursiveDataReading(this.folder,this.valist,this.lflist,this.brlist),this.folder}recoveryAttribute(){for(let e=0;e<this.valist.length;e++)this.setProperty(this.valist[e].absoluteAddress,Number(this.valist[e].value))}setParameterInfoArray(e){this.parameterInfoArray=e}getParameterInfoArray(){return this.parameterInfoArray}findParameterInfoByName(e){return this.parameterInfoArray.find(t=>t.parameterInfoname===e)||null}updateParameterValue(e,t,r){const i=this.findParameterInfoByName(e);if(!i)return!1;for(const s of i.parameterInfoArray)for(const l of s.parameter)if(l.path===t)return l.value=r,!0;return!1}getParameterValue(e,t){const r=this.findParameterInfoByName(e);if(!r)return null;for(const i of r.parameterInfoArray)for(const s of i.parameter)if(s.path===t)return s.value;return null}changeLevelAndOccupation(e,t,r={levelPath:"等级",occupationPath:"职业"}){const i=this.findParameterInfoByName(this.name);if(!i){console.warn(`未找到玩家 "${this.name}" 的参数信息`);return}for(const s of i.parameterInfoArray)for(const l of s.parameter)l.path===r.levelPath?l.value=e:l.path===r.occupationPath&&(l.value=t);this.level=e,this.gameManualOverrideParameter(i)}gameManualOverrideParameter(e){const t=this.getBillboard();e.parameterInfoArray.forEach(r=>{r&&t.forEach(i=>{r.name===i.name&&r.parameter.forEach(s=>{const l=s.path;i.metadataArray.forEach(o=>{const u=[];if(fx.getStepData(o.body.source,u),u.toString()===l){const d=o.body.getValue(),c=Number(s.value);d!==c&&o.body.setGlobalValue(c)}})})})})}},BillboardLayer=class{constructor(e){n(this,"name","");n(this,"operationArray",[]);n(this,"metadataArray",[]);n(this,"id",0);n(this,"monitored",!0);n(this,"constructorName","BillboardLayer");this.name=e,this.id=++EventManager.IDINDEX}dispose(){this.name=null,this.operationArray=null,this.metadataArray=null,this.monitored=null}pushOperationLayer(){if(fx.clickBody!=null&&fx.clickBody.type==5){const e=new fx.OperationLayerData(fx.clickBody);this.operationArray.push(e)}fx.clickBody=null}pushMetadata(e,t,r,i,s){if(fx.clickBody!=null&&fx.clickBody instanceof fx.VariableValue&&fx.clickBody.type!=5){const l=new fx.MetadataData(fx.clickBody);l.type=e,l.presentValue=getCatchValue(l.body),l.minValue=t,l.maxValue=r,l.intervalValue=i,l.list=s&&s.length?s.map(o=>({value:Number(o.value),name:o.name})):[],this.metadataArray.push(l)}fx.clickBody=null}},ChartsLayer=class{constructor(e){n(this,"name");n(this,"operationArray",[]);n(this,"metadata",null);n(this,"metadataArray",[]);n(this,"minValue",1);n(this,"maxValue",1);n(this,"intervalValue",1);n(this,"constructorName","ChartsLayer");n(this,"id");this.name=e,this.id=++EventManager.IDINDEX}addMetadataData(){fx.clickBody!=null&&(this.metadata=fx.clickBody.copy(),this.metadataArray[0]=this.metadata)}dispose(){}},Bookmark=class{constructor(){n(this,"id",0);n(this,"x",0);n(this,"y",0);n(this,"width",512);n(this,"height",512);n(this,"text","标签");n(this,"view",null);n(this,"type","Bookmark");n(this,"bookmarkView",null)}},MetadataData=class{constructor(e){n(this,"body");n(this,"view",null);n(this,"type",0);n(this,"presentValue",0);n(this,"minValue",0);n(this,"maxValue",0);n(this,"intervalValue",0);n(this,"list");this.body=e.copy()}},SheetData=class{constructor(e){n(this,"originData");this.originData=e}setData(e){this.originData=e}getValue(e,t,r){var d,c,f;if(!(this!=null&&this.originData)||typeof e>"u"||typeof t>"u"||typeof r>"u")return;const s=this.originData.sheets,l=s.find(g=>g.name===e),o=(d=l==null?void 0:l.data)==null?void 0:d.get(`${t},${r}`),u=o==null?void 0:o.cellData;let h=u==null?void 0:u.v;return u!=null&&u.type&&(h=(c=o==null?void 0:o.source)!=null&&c.getValue?(f=o.source)==null?void 0:f.getValue():0),u!=null&&u.f&&(h=u!=null&&u.getValue?u.getValue(s):u.v),h||0}},OperationLayerData=class{constructor(e){n(this,"body");n(this,"view",null);this.body=e.copy()}},Message=class{constructor(){n(this,"userData",null);n(this,"type",null)}},globalThis_=function(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{}}();globalThis_.target=null;var A=class{test(){try{console.log("console A")}catch(e){console.error("Error in class A test:",e)}}},B=class extends A{constructor(){super()}test(){try{console.log("console B")}catch(e){console.error("Error in class B test:",e)}}},fx=(a=class{static recursiveDataReading(t,r,i,s){try{if(!t||!t.tree||!Array.isArray(t.tree))throw new Error("Invalid object structure for recursive reading");for(let l=0;l<t.tree.length;l++){const o=t.tree[l];o!=null&&(o.isFolder?this.recursiveDataReading(o,r,i,s):o.type==1?r.push(o):o.type==5?i.push(o):o instanceof a.BillboardLayer&&s.push(o))}}catch(l){console.error("Error in recursive data reading:",l)}}},n(a,"b",new B),n(a,"code",!1),n(a,"isNumber",function(t){try{return!isNaN(Number(t))&&isFinite(Number(t))}catch(r){return console.error("Error checking if value is number:",r),!1}}),n(a,"mix",function(t,r,i){try{if(!a.isNumber(t)||!a.isNumber(r)||!a.isNumber(i))throw new Error("Invalid parameters for mix function");return t*(1-i)+r*i}catch(s){return console.error("Error in mix function:",s),0}}),n(a,"cross",function(t,r,i,s){try{if(!a.isNumber(t)||!a.isNumber(r)||!a.isNumber(i)||!a.isNumber(s))throw new Error("Invalid parameters for cross function");return t*i-r*s}catch(l){return console.error("Error in cross function:",l),0}}),n(a,"dot",function(t,r,i,s){try{if(!a.isNumber(t)||!a.isNumber(r)||!a.isNumber(i)||!a.isNumber(s))throw new Error("Invalid parameters for dot function");return t*i+r*s}catch(l){return console.error("Error in dot function:",l),0}}),n(a,"distance",function(t,r,i,s){try{if(!a.isNumber(t)||!a.isNumber(r)||!a.isNumber(i)||!a.isNumber(s))throw new Error("Invalid parameters for distance function");const l=Math.abs(t-i),o=Math.abs(r-s);return a.length(l,o)}catch(l){return console.error("Error in distance function:",l),0}}),n(a,"length",function(t,r){try{if(!a.isNumber(t)||!a.isNumber(r))throw new Error("Invalid parameters for length function");return Math.sqrt(t*t+r*r)}catch(i){return console.error("Error in length function:",i),0}}),n(a,"billBoardList",[]),n(a,"functionAddIndex",0),n(a,"visualVersionCompatibility",!1),n(a,"singletonInstance",null),n(a,"isStart",!1),n(a,"FXCentre",FXCentre),n(a,"NodeType",NodeType),n(a,"Folder",Folder),n(a,"Eve",EventManager),n(a,"CallCenter",CallCenter),n(a,"MessageList",MessageList),n(a,"VariableValue",VariableValue),n(a,"Call",Call),n(a,"SymbolBody",SymbolBody),n(a,"BasicBody",BasicBody),n(a,"OperationBody",OperationBody),n(a,"Player",Player),n(a,"BillboardLayer",BillboardLayer),n(a,"ChartsLayer",ChartsLayer),n(a,"Bookmark",Bookmark),n(a,"FormulaData",FormulaData),n(a,"MetadataData",MetadataData),n(a,"SheetData",SheetData),n(a,"OperationLayerData",OperationLayerData),n(a,"Message",Message),n(a,"noCache",!1),n(a,"enemyBody",null),n(a,"sceneFolder",null),n(a,"targetFolder",null),n(a,"isFolderDuplicationOfName",!1),n(a,"isBillboardLayerView",!0),n(a,"isBodyView",!0),n(a,"isGlobalOperations",!1),n(a,"isDragBody",!1),n(a,"stageMaskValue",{}),n(a,"stageGroup",null),n(a,"clickBody",null),n(a,"selectCellBody",null),n(a,"editBody",null),n(a,"selectBody",null),n(a,"stageStoragePool",[]),n(a,"targetStoragePool",a.stageStoragePool),n(a,"player",null),n(a,"isCrit",!1),n(a,"distribute",function(t,r){const i=r.reduce((s,l)=>s+l,0);return r.map(s=>t*s/i)}),n(a,"partitionCurve",function(t,r,i,s,l,o){var u=[],h=[],d=l,c=o;d==null&&(d=.382),c==null&&(c=.618);for(var f=0,g=1;g<=r;g++){var p=Math.pow(r,i),v=Math.pow(g,i),D=v/p,y=g*(1e4*d)/r+D*(1e4*c);u.push(y),f+=y}for(var m=0;m<u.length;m++)if(s==null)h.push(u[m]/f*t);else switch(s){case 0:h.push(u[m]/f*t);break;case 1:h.push(Math.floor(u[m]/f*t));break;case 2:h.push(Math.floor(u[m]/f*t));break}return h}),n(a,"eval",function(t){return a.evaluateExpression(t)}),n(a,"recursionLibraryBody",function(t,r,i){if(r.tree==null)return null;for(var s=0;s<r.tree.length;s++){if(r.tree[s].absoluteAddress==i){t.push(r.tree[s]);return}a.recursionLibraryBody(t,r.tree[s],i)}return null}),n(a,"double",function(t,r){switch(r){case 0:return Math.round(t*1)/1;case 1:return Math.round(t*10)/10;case 2:return Math.round(t*100)/100;case 3:return Math.round(t*1e3)/1e3;case 4:return Math.round(t*1e4)/1e4;case 5:return Math.round(t*1e5)/1e5;case 6:return Math.round(t*1e6)/1e6;case 7:return Math.round(t*1e7)/1e7}return 0}),n(a,"getLibraryBody",function(t,r,i){for(var s=0;s<r.length;s++){if(r[s].absoluteAddress==null&&(r[s].absoluteAddress=a.getAbsoluteAddress(r[s])),r[s].absoluteAddress==i){t.push(r[s]);return}r[s].isFolder&&a.getLibraryBody(t,r[s].tree,i)}}),n(a,"mapToJSON",function(t){return t?JSON.stringify([...t].reduce((r,[i,s])=>{const l={...s},o=l.source;if(o){const u=a.createVarData(o.TID,o.name,o.value,o.type,o.macros,o.operator,o.enemyFlag,o.source,o.tag,o.statistics,o.upDateValue,o.demoteValue,o.funcType,o.isLogicalOpen,o.isDragging,o.currentStep,o.snNo,o.minValue,o.maxValue,o.step,o.logicalChildArray,o.selectedOutputInfo);l.source=u}return r[i]=l,r},{})):"{}"}),n(a,"addLibraryBody",function(t,r){var h;for(var i=0;i<r.length;i++){let d=r[i],c=(h=d.sheetData)==null?void 0:h.originData;if(c&&(c={...c},c.sheets=[...c.sheets.map(f=>({...f,data:a.mapToJSON(f.data)}))]),d instanceof a.VariableValue){var s=a.createOperationLayerData(d.name,d.type,d.value,d,d.tag,d.isSystemShow,d.sheetData?JSON.stringify(c):null,d.childCell);s.id=d.id,t.push(s),a.saveBody(s.operationArray,a.seekSource(d.childBodyArray))}if(d instanceof a.Folder){var s=a.createFolderData(d.name,d.isFolder,d);s.id=d.id,t.push(s),a.addLibraryBody(s.operationArray,d.tree)}if(a.isBillboardLayerView){if(d instanceof a.BillboardLayer){var s=a.createBillboarData(d.name,d,d.monitored);s.id=d.id,t.push(s);for(var l=0;l<d.operationArray.length;l++){let g=d.operationArray[l];var o=a.createOperationLayerData(g.body.name,g.body.type,g.body.value,g.body.source,g.body.tag,g.body.isSystemShow,null,null);o.id=g.body.id,s.operationArray.push(o)}for(var l=0;l<d.metadataArray.length;l++){const p=d.metadataArray[l];var u=a.createBillboarMetadataData(p.body.name,p.body.type,p.body.value,p.body.source,p);u.id=p.body.id,s.metadataArray.push(u)}}if(d instanceof a.ChartsLayer){var s=a.createChartData(d);s.id=d.id,t.push(s)}}}}),n(a,"parseLibraryBody",function(t,r){for(var i=0;i<t.length;i++){const u=t[i];if(u.type==5){var s=[];a.getLibraryBody(s,a.targetFolder.tree,u.site),a.editBody=s[0],a.selectBody=a.editBody,a.targetStoragePool=a.editBody.childBodyArray,a.editBody.isSystemShow=u.isSystemShow,a.parseStageBody(u.operationArray)}else if(u.type==0||u.type==1||u.type==2||u.type==3){var s=[];a.getLibraryBody(s,a.targetFolder.tree,u.site),a.editBody=s[0],a.selectBody=a.editBody,a.targetStoragePool=a.stageStoragePool,a.parseStageBody(u.operationArray)}else if(u.isFile==!0){var s=[];a.getLibraryBody(s,a.targetFolder.tree,u.site),a.editBody=s[0];for(var l=s[0],o=0;o<u.operationArray.length;o++){const d=u.operationArray[o];if(d.type==5){var s=[];a.getLibraryBody(s,a.targetFolder.tree,d.site),a.editBody=s[0],a.selectBody=s[0],a.targetStoragePool=s[0].childBodyArray,a.parseStageBody(d.operationArray),a.editBody=l,a.editBody.isSystemShow=d.isSystemShow}else d.isBoard==!0?(a.selectBody=a.editBody,d.index=o,a.Call.send(a.Eve.SHIFT_ADD_BOARD,d,null)):d.isXlsx==!0&&(a.selectBody=a.editBody,d.index=o,a.Call.send(a.Eve.SHIFT_ADD_CHARTS,d,null));if(d.isFile==!0){var s=[];a.getLibraryBody(s,a.targetFolder.tree,d.site),a.editBody=s[0],a.parseLibraryBody(d.operationArray,!1)}}a.editBody=null}else u.isBoard==!0?(a.selectBody=a.editBody,a.billBoardList.push(u),a.Call.send(a.Eve.SHIFT_ADD_BOARD,u,null)):u.isXlsx==!0&&(a.selectBody=a.editBody,a.Call.send(a.Eve.SHIFT_ADD_CHARTS,u,null));r&&(a.selectBody=null)}}),n(a,"createLibraryBody",function(t,r,i,s){for(var l=0;l<t.length;l++){const c=t[l];if(c.isFile==!0){var o=new a.Folder(c.name);a.Call.send(a.Eve.CREATE_FILE_DATA,o,null),s!=null?(a.Call.send(a.Eve.ADD_DATABASE_DATA,[o,s],null),a.Call.send(a.Eve.SHIFT_REFRESH_LIBRARY_COORDINATES,[o,s],null)):(a.Call.send(a.Eve.ADD_DATABASE_DATA,[o,a.selectBody],null),a.Call.send(a.Eve.SHIFT_REFRESH_LIBRARY_COORDINATES,[o,a.selectBody],null)),a.selectBody=o,a.selectBody.absoluteAddress=c.site;for(var u=0;u<c.operationArray.length;u++){const f=c.operationArray[u];if(f.type==5)a.editBody=new a.VariableValue(f.name,null,5),a.editBody.tag=f.name.tag,a.Call.send(a.Eve.CREATE_OPERATION_DATA,a.editBody,null),a.Call.send(a.Eve.ADD_DATABASE_DATA,[a.editBody,a.selectBody],null),a.Call.send(a.Eve.SHIFT_REFRESH_LIBRARY_COORDINATES,[a.editBody,a.selectBody],null),a.editBody.absoluteAddress=f.site,a.targetStoragePool=a.editBody.childBodyArray;else if(f.type==0||f.type==1||f.type==2||f.type==3){var h=f.name+"="+f.value,d=new a.VariableValue(h.split("=")[0],h.split("=")[1],1);f.type==1&&(d.isAI=i||!1),a.editBody=d,a.editBody.tag=f.tag,a.Call.send(a.Eve.CREATE_METADATE_DATA,d,null),a.Call.send(a.Eve.ADD_DATABASE_DATA,[a.editBody,a.selectBody],null),a.Call.send(a.Eve.SHIFT_REFRESH_LIBRARY_COORDINATES,[a.editBody,a.selectBody],null),a.editBody.absoluteAddress=f.site,a.targetStoragePool=a.editBody.childBodyArray}else if(f.type==11){var h=f.name,d=new a.VariableValue(h.split("=")[0],void 0,f.type);d.selectedOutputInfo=f!=null&&f.selectedOutputInfo?JSON.parse(f==null?void 0:f.selectedOutputInfo):null;const v=typeof f.sheetData=="string"?JSON.parse(f.sheetData):f.sheetData;v!=null&&v.sheets&&(v.sheets=v.sheets.map(D=>{const y=JSON.parse(D.data);return Object.values(y).forEach(m=>{if(m!=null&&m.source){const b=m.source;var T=[];a.getLibraryBody(T,a.targetFolder.tree,a.getAbsoluteAddress(b));var E=T[0];m.source=E.copy()}}),{...D,data:new Map(Object.entries(y))}})),d.setSheetData(v),d.childCell=f.childCell,a.editBody=d,a.editBody.tag=f.tag,a.Call.send(a.Eve.ADD_DATABASE_DATA,[a.editBody,a.selectBody],null),a.Call.send(a.Eve.SHIFT_REFRESH_LIBRARY_COORDINATES,[a.editBody,a.selectBody],null),a.editBody.absoluteAddress=f.site,a.targetStoragePool=a.editBody.childBodyArray}if(f.isFile==!0){var o=new a.Folder(f.name);a.Call.send(a.Eve.CREATE_FILE_DATA,o,null),a.Call.send(a.Eve.ADD_DATABASE_DATA,[o,a.selectBody],null),a.Call.send(a.Eve.SHIFT_REFRESH_LIBRARY_COORDINATES,[o,a.selectBody],null),a.selectBody=o,a.selectBody.absoluteAddress=f.site,a.createLibraryBody(f.operationArray,!1,!1,o),a.selectBody=o.parentFolder}}a.selectBody=o.parentFolder}if(c.type==5)a.editBody=new a.VariableValue(c.name,null,5),a.editBody.tag=c.tag,a.editBody.isSystemShow=c.isSystemShow,a.Call.send(a.Eve.CREATE_OPERATION_DATA,a.editBody,null),a.Call.send(a.Eve.ADD_DATABASE_DATA,[a.editBody,a.selectBody],null),a.Call.send(a.Eve.SHIFT_REFRESH_LIBRARY_COORDINATES,[a.editBody,a.selectBody],null),a.editBody.absoluteAddress=c.site,a.targetStoragePool=a.editBody.childBodyArray;else if(c.type==0||c.type==1||c.type==2||c.type==3){var h=c.name+"="+c.value,d=new a.VariableValue(h.split("=")[0],h.split("=")[1],1);c.type==1&&(d.isAI=i||!1),a.editBody=d,a.editBody.tag=c.tag,a.Call.send(a.Eve.CREATE_METADATE_DATA,d,null),a.Call.send(a.Eve.ADD_DATABASE_DATA,[a.editBody,a.selectBody],null),a.Call.send(a.Eve.SHIFT_REFRESH_LIBRARY_COORDINATES,[a.editBody,a.selectBody],null),a.editBody.absoluteAddress=c.site,a.targetStoragePool=a.editBody.childBodyArray}else if(c.type==11){var h=c.name,d=new a.VariableValue(h.split("=")[0],void 0,c.type);d.selectedOutputInfo=c!=null&&c.selectedOutputInfo?JSON.parse(c==null?void 0:c.selectedOutputInfo):null;const p=typeof c.sheetData=="string"?JSON.parse(c.sheetData):c.sheetData;p!=null&&p.sheets&&(p.sheets=p.sheets.map(v=>{const D=JSON.parse(v.data);return Object.values(D).forEach(y=>{if(y!=null&&y.source){const E=y.source;var m=[];a.getLibraryBody(m,a.targetFolder.tree,a.getAbsoluteAddress(E));var T=m[0];y.source=T.copy()}}),{...v,data:new Map(Object.entries(D))}})),d.setSheetData(p),d.childCell=c.childCell,a.editBody=d,a.editBody.tag=c.tag,a.Call.send(a.Eve.ADD_DATABASE_DATA,[a.editBody,a.selectBody],null),a.Call.send(a.Eve.SHIFT_REFRESH_LIBRARY_COORDINATES,[a.editBody,a.selectBody],null),a.editBody.absoluteAddress=c.site,a.targetStoragePool=a.editBody.childBodyArray}r&&(a.selectBody=null)}}),n(a,"getBody",function(t,r,i){var s=[];return a.recursionLibraryBody(s,t,r),i!=null&&s[0].body.setFunctionId(i),s[0]}),n(a,"evaluateExpression",function(t){var r=a.toRPN(t),i=[];for(let s of r)if(a.isNumber(s))i.push(Number(s));else{const l=i.pop(),o=i.pop();let u;if(o!==void 0&&l!==void 0)switch(s){case"+":u=o+l;break;case"-":u=o-l;break;case"*":u=o*l;break;case"/":u=o/l;break;case"%":u=o%l;break;case"^":u=Math.pow(o,l);break;case">":u=o>l;break;case"<":u=o<l;break;case">=":u=o>=l;break;case"<=":u=o<=l;break;case"==":u=o===l;break;case"!=":u=o!==l;break}i.push(u)}return i.pop()}),n(a,"toRPN",function(t){t=t+"",t=t.replace(/\s+/g,"");var r={"+":1,"-":1,"*":2,"/":2,"%":2,"^":3,">":4,"<":4,">=":4,"<=":4,"==":4,"!=":4},i=[],s=[];function l(f){i.push(f)}function o(){var f=s.pop();f&&l(f)}function u(f){return r.hasOwnProperty(f)}function h(f,g){return f==="-"&&g===0||f==="-"&&!a.isNumber(t[g-1])&&t[g-1]!==")"}for(let f=0;f<t.length;f++){var d=t[f];if(a.isNumber(d)||h(d,f)){let g=d,p=f+1;for(;p<t.length&&(a.isNumber(t[p])||t[p]===".");)g+=t[p],p++;l(g),f=p-1}else if(u(d)){for(var c=s[s.length-1];u(c)&&(r[d]<=r[c]&&d!=="^"||r[d]<r[c]&&d==="^");)o(),c=s[s.length-1];s.push(d)}else if(d==="(")s.push(d);else if(d===")"){for(var c=s[s.length-1];c!=="("&&c!==void 0;)o(),c=s[s.length-1];s.pop()}}for(;s.length>0;)o();return i}),n(a,"Rectangle",class{constructor(r,i){n(this,"width");n(this,"height");this.width=r,this.height=i}calculateArea(){return this.width*this.height}calculatePerimeter(){return 2*(this.width+this.height)}}),n(a,"recursionSyncBody",function(t){for(var r=0;r<t.length;r++)t[r].type==5&&t[r].syncBody(),t[r].isFolder&&a.recursionSyncBody(t[r].tree)}),n(a,"clearCache",function(){a.clearCacheRecursion(a.sceneFolder)}),n(a,"clearCacheRecursion",function(t){for(var r=0;r<t.tree.length;r++){const i=t.tree[r];i.type==5&&(i.cacheValue=null),i.isFolder==!0&&a.clearCacheRecursion(i)}}),n(a,"initDataBase",function(t){a.isBillboardLayerView=!1,new a.FXCentre,JSON.parse(t).stage.operationArray;var r=JSON.parse(t).library.operationArray;a.editBody=null,a.selectBody=null,a.createLibraryBody(r,!0),a.parseLibraryBody(r,!0)}),n(a,"parseAbsoluteAddress",function(t){return t.replace(/\./g,"")}),n(a,"recursionGetBillboard",function(t,r){if(r.tree==null)return null;for(var i=0;i<r.tree.length;i++)r.tree[i]instanceof a.BillboardLayer&&t.push(r.tree[i]),a.recursionGetBillboard(t,r.tree[i]);return null}),n(a,"saveBody",function(t,r){for(var i=0;i<r.length;i++){const g=r[i];if(g.type=="OperationBody"){var s=0,l=0;g.view!=null&&(s=g.view.getX(),l=g.view.getY());var o=a.createBodyData(g.type,g.isFunction,g.isBindingOperation,s,l,g.isWeight,g.isAdvance,g.funcType);g.isBindingFormula&&(o.isFormula=!0,o.formulaName=g.formulaBody.name,o.formulaX=g.formulaBody.x,o.formulaY=g.formulaBody.y),o.id=g.id,t.push(o);for(var u=0;u<g.tree.length;u++){const p=g.tree[u];let v=a.createVarData(p.TID,p.name,p.value,p.type,p.macros,p.operator,p.enemyFlag,p.source,p.tag,p.statistics,p.upDateValue,p.demoteValue,p.funcType,p.isLogicalOpen,p.isDragging,p.currentStep,p.snNo,p.minValue,p.maxValue,p.step,p.logicalChildArray,p.selectedOutputInfo);v.id=p.id,o.tree.push(v)}}else if(g.type=="SymbolBody"){var s=0,l=0;g.view!=null&&(s=g.view.getX(),l=g.view.getY());var h=a.createSymbolData(g.type,g.operator,g.isFunctionId,g.isBindingOperation,s,l,g.isWeight,g.funcType);g.isBindingFormula&&(h.isFormula=!0,h.formulaName=g.formulaBody.name,h.formulaX=g.formulaBody.x,h.formulaY=g.formulaBody.y),h.id=g.id,t.push(h);for(var u=0;u<g.tree.length;u++){const y=g.tree[u];switch(y.type){case"OperationBody":var s=0,l=0;y.view!=null&&(s=y.view.getX(),l=y.view.getY());var c=a.createBodyData(y.type,y.isFunction,y.isBindingOperation,s,l,y.isWeight,y.isAdvance,y.funcType);c.id=y.id,h.tree.push(c);for(var d=0;d<y.tree.length;d++){const E=y.tree[d];let b=a.createVarData(E.TID,E.name,E.value,E.type,E.macros,E.operator,E.enemyFlag,E.source,E.tag,E.statistics,E.upDateValue,E.demoteValue,E.funcType,E.isLogicalOpen,E.isDragging,E.currentStep,E.snNo,E.minValue,E.maxValue,E.step,E.logicalChildArray,E.selectedOutputInfo);b.id=E.id,c.tree.push(b)}break;case"SymbolBody":var s=0,l=0;y.view!=null&&(s=y.view.getX(),l=y.view.getY());var c=a.createSymbolData(y.type,y.operator,y.isFunctionId,y.isBindingOperation,s,l,y.isWeight,y.funcType);c.id=y.id,h.tree.push(c),a.recursionSeekBody(c.tree,y.tree);break}}}else if(g.type=="Bookmark"){var f=a.createBookmarkData(g);f.id=g.id,t.push(f)}}}),n(a,"coordinateDetection",function(t){return t!=null?{x:t.getX(),y:t.getY()}:{x:0,y:0}}),n(a,"recursionSeekBody",function(t,r){for(var i=0;i<r.length;i++){const u=r[i];switch(u.type){case"OperationBody":var l=a.coordinateDetection(u.view),o=a.createBodyData(u.type,u.isFunction,u.isBindingOperation,l.x,l.y,u.isWeight,u.isAdvance,u.funcType);t.push(o);for(var s=0;s<u.tree.length;s++){const h=u.tree[s];o.tree.push(a.createVarData(h.TID,h.name,h.value,h.type,h.macros,h.operator,h.enemyFlag,h.source,h.tag,h.statistics,h.upDateValue,h.demoteValue,h.funcType,h.isLogicalOpen,h.isDragging,h.currentStep,h.snNo,h.minValue,h.maxValue,h.step,h.logicalChildArray,h.selectedOutputInfo))}break;case"SymbolBody":var l=a.coordinateDetection(u.view),o=a.createSymbolData(u.type,u.operator,u.isFunctionId,u.isBindingOperation,l.x,l.y,u.isWeight,u.funcType);t.push(o),a.recursionSeekBody(o.tree,u.tree);break}}}),n(a,"getAbsoluteAddress",function(t,r){if(r){var i=[];a.getStepData(t,i,r);for(var s="",l=0;l<i.length;l++)s+=i[l];return s}if(t.site!=null&&t.site!=null)return t.site;if(t.parentFolder==null)return t.source!=null?t.source.absoluteAddress:t.name;var i=[];a.getStepData(t,i,r);for(var s="",l=0;l<i.length;l++)s+=i[l];return s}),n(a,"copyHeadFun",function(t){return t.copyHead?!0:t.parentFolder!=null&&t.parentFolder.name!=null?a.copyHeadFun(t.parentFolder):!1}),n(a,"getStepData",function(t,r,i){r.unshift(t.name),t.parentFolder!=null&&t.parentFolder.name!=null&&a.getStepData(t.parentFolder,r,i)}),n(a,"getStepDataAll",function(t,r){r.unshift(t.name),t.parentFolder.name!=null&&a.getStepDataAll(t.parentFolder,r)}),n(a,"createVarData",function(t,r,i,s,l,o,u,h,d,c,f,g,p,v,D,y,m,T,E,b,F,S){var V={};return a.code,V.TID=t,V.name=r,V.value=i,V.type=s,V.macros=l,V.operator=o,V.enemy=u,V.tag=d,V.site=a.getAbsoluteAddress(h),V.statistics=c,V.upDateValue=f,V.demoteValue=g,V.funcType=p,V.isLogicalOpen=v,V.isDragging=D,V.currentStep=y,V.snNo=m,V.minValue=T,V.maxValue=E,V.step=b,V.logicalChildArray=[],V.selectedOutputInfo=typeof S=="object"?JSON.stringify(S):"",F&&F.length&&F.forEach(C=>{const L=a.createVarData(C.TID,C.name,C.value,C.type,C.macros,C.operator,C.enemyFlag,C.source,C.tag,C.statistics,C.upDateValue,C.demoteValue,C.funcType,C.isLogicalOpen,C.isDragging,C.currentStep,C.snNo,C.minValue,C.maxValue,C.step,C.logicalChildArray);V.logicalChildArray.push(L)}),V}),n(a,"createBodyData",function(t,r,i,s,l,o,u,h){var d={};return d.tree=[],d.type=t,d.isFunction=r,d.isBoundOutput=i,d.x=s,d.y=l,d.isWeight=o,d.isAdvance=u,d.funcType=h,d}),n(a,"createSymbolData",function(t,r,i,s,l,o,u,h){var d={};return d.tree=[],d.type=t,d.operator=r,d.isFunctionId=i,d.isBoundOutput=s,d.x=l,d.y=o,d.isWeight=u,d.funcType=h,d}),n(a,"createBookmarkData",function(t){var r={};return r.x=t.x,r.y=t.y,r.width=t.width,r.height=t.height,r.text=t.text,r.type=t.type,r}),n(a,"createChartData",function(t){var r={};if(r.name=t.name,r.minValue=t.minValue,r.maxValue=t.maxValue,r.intervalValue=t.intervalValue,r.operationlayer=[],r.metadataArray=[],r.isXlsx=!0,t.operationArray!=null)for(var i=0;i<t.operationArray.length;i++)r.operationlayer.push(a.getAbsoluteAddress(t.operationArray[i].source));(t.body!=null||t.metadata!=null)&&(r.metadata=a.getAbsoluteAddress(t.metadata.source));for(var i=0,s=t.metadataArray.length;i<s;i++){var l=t.metadataArray[i],o=l.source,u={site:a.getAbsoluteAddress(o)};l.minValue!=1&&(u.minValue=l.minValue),l.intervalValue!=1&&(u.intervalValue=l.intervalValue),r.metadataArray.push(u)}return r.site=a.getAbsoluteAddress(t),r}),n(a,"seekSource",function(t){for(var r=[],i=0;i<t.length;i++){const l=t[i];if(l.parent==null){if(r.length==0)r.push(l);else for(var s=0;s<r.length;s++)if(r[s]!=l){r.push(l);break}}}return r}),n(a,"createBillboarMetadataData",function(t,r,i,s,l){var o={};return o.name=t,o.type=r,o.value=i,o.site=a.getAbsoluteAddress(s),o.componentType=l.type,o.componentValue=l.body.value,o.componentMinValue=l.minValue,o.componentMaxValue=l.maxValue,o.componentIntervalValue=l.intervalValue,o.list=l.list,o}),n(a,"createOperationLayerData",function(t,r,i,s,l,o,u,h){var d={};return d.name=t,d.type=r,d.value=i,d.site=a.getAbsoluteAddress(s),d.tag=l,d.operationArray=[],r===11&&u&&(d.sheetData=u,d.childCell=h),d.isSystemShow=o,d}),n(a,"createBillboarData",function(t,r,i){var s={};return s.name=t,s.site=a.getAbsoluteAddress(r),s.isBoard=!0,s.operationArray=[],s.metadataArray=[],s.monitored=i,s}),n(a,"createFolderData",function(t,r,i){var s={};return s.name=t,s.isFile=r,s.operationArray=[],s.site=a.getAbsoluteAddress(i),s}),n(a,"getBout",function(t){if(t.tree.length>1){if(t.tree[0].getValue()!=0&&t.tree[1].getValue()!=0&&Number(t.tree[0].getValue())>Number(t.tree[1].getValue())){for(var r=Number(t.tree[0].getValue()),i=0,s=1;s<t.tree.length;s++)i+=Number(t.treeItem.getValue());for(var l=0,o=0;r>=i;)o+=i,r-=i,l++;return[l,o/l]}return[0,0]}return[0,0]}),n(a,"copy",function(t){var r={};for(var i in t)t.hasOwnProperty(i)&&(r[i]=typeof t[i]=="object"?a.copy(t[i]):t[i]);return r}),n(a,"getIsBoundOutput",function(t,r){return r!=null?!1:t.isBoundOutput!=null?t.isBoundOutput:t.isBindingOperation}),n(a,"coordinate",function(t,r){var i=1;return a.visualVersionCompatibility&&(i=.5),t.view!=null?t.parent==null?[0,0]:[t.view.getX()*i,t.view.getY()*i]:[t.x*i,t.y*i]}),n(a,"parseStageBody",function(t,r,i,s){for(var l=null,o=0;o<t.length;o++){const y=t[o];if(i==null&&y.parent!=null)return;if(y.type=="OperationBody"||y.type=="运算体类"){var u;if(y.isFunction){u=a.createOperationBody(a.coordinate(t[o],i)[0],a.coordinate(t[o],i)[1],1,y.isWeight,y.isAdvance,y.funcType),u.isBindingOperation=a.getIsBoundOutput(t[o],i),a.operationBindBody(u),l==null&&(l=u);for(var h=0;h<y.tree.length;h++){const m=y.tree[h];if(m.type==4){var d=new a.VariableValue(m.name,null,m.type);d.TID=m.TID,d.TID==null&&(d.TID=new Date().getTime()+a.functionAddIndex,a.functionAddIndex++);var c=a.createFunctionBody(u,d);c.setMacros(a.amendMacros(m)),c.enemyFlag=m.enemy,c.funcType=m.funcType,c.funcType==null&&(c.funcType=0),c.statistics=m.statistics,c.upDateValue=m.upDateValue,c.demoteValue=m.demoteValue,a.symbolicLink(c,m.operator),a.Call.send(a.Eve.SHIFT_SHOW_VIEW,[c,m.operator,r],null)}else if([12,16,NodeType.LogicalList,NodeType.LogicalNumberList,14].includes(m.type)){var d=new a.VariableValue(m.name,m.value,m.type);d.TID=m.TID,d.TID==null&&(d.TID=new Date().getTime()+a.functionAddIndex,a.functionAddIndex++);var c=a.createFunctionBody(u,d);c.enemyFlag=m.enemy,c.funcType=m.funcType,c.funcType==null&&(c.funcType=0),m.type==11&&(c.selectedOutputInfo=m.selectedOutputInfo?JSON.parse(m.selectedOutputInfo):""),c.statistics=m.statistics,c.upDateValue=m.upDateValue,c.demoteValue=m.demoteValue,c.isLogicalOpen=m.isLogicalOpen,c.isDragging=m.isDragging,c.snNo=m.snNo,c.logicalNumberList=m.logicalNumberList,c.currentStep=m.currentStep,c.snNo=m.snNo,c.minValue=m.minValue,c.maxValue=m.maxValue,c.step=m.step,c.logicalChildArray=[],m.logicalChildArray.forEach(b=>{var F=[];a.getLibraryBody(F,a.targetFolder.tree,a.getAbsoluteAddress(b));var S=F[0],V=S.copy();V.enemyFlag=m.enemy,V.funcType=m.funcType,V.funcType==null&&(V.funcType=0),V.statistics=m.statistics,V.upDateValue=m.upDateValue,V.demoteValue=m.demoteValue,c.logicalChildArray.push(V)}),a.symbolicLink(c,m.operator),a.Call.send(a.Eve.SHIFT_SHOW_VIEW,[c,m.operator,r],null)}else{var f=[];s?a.getLibraryBody(f,a.targetFolder.tree,a.getAbsoluteAddress(m.source)):a.getLibraryBody(f,a.targetFolder.tree,a.getAbsoluteAddress(m));var g=f[0],c=a.createVariableBody(u,g);c.enemyFlag=m.enemy,c.funcType=m.funcType,c.funcType==null&&(c.funcType=0),m.type==11&&(c.selectedOutputInfo=m.selectedOutputInfo?JSON.parse(m.selectedOutputInfo):""),c.statistics=m.statistics,c.upDateValue=m.upDateValue,c.demoteValue=m.demoteValue,a.symbolicLink(c,m.operator),a.Call.send(a.Eve.SHIFT_SHOW_VIEW,[c,m.operator,r],null)}}a.Call.send(a.Eve.SHIFT_SHOW_VIEW_ON,[u,r],null)}else{u=a.createOperationBody(a.coordinate(t[o],i)[0],a.coordinate(t[o],i)[1],0,y.isWeight,y.isAdvance,y.funcType),u.isBindingOperation=a.getIsBoundOutput(t[o],i),a.operationBindBody(u),l==null&&(l=u);for(var h=0;h<y.tree.length;h++){const T=y.tree[h];if(T.type==4){var d=new a.VariableValue(T.name,null,T.type);d.TID=T.TID,d.TID==null&&(d.TID=new Date().getTime()+a.functionAddIndex,a.functionAddIndex++);var c=a.createFunctionBody(u,d);c.setMacros(a.amendMacros(T)),c.enemyFlag=T.enemy,c.funcType=T.funcType,c.funcType==null&&(c.funcType=0),c.statistics=T.statistics,c.upDateValue=T.upDateValue,c.demoteValue=T.demoteValue,a.symbolicLink(c,T.operator),a.Call.send(a.Eve.SHIFT_SHOW_VIEW,[c,T.operator,r],null)}else{var f=[];s||T.source?a.getLibraryBody(f,a.targetFolder.tree,a.getAbsoluteAddress(T.source)):a.getLibraryBody(f,a.targetFolder.tree,a.getAbsoluteAddress(T));var g=f[0],c=a.createVariableBody(u,g);c.enemyFlag=T.enemy,c.funcType=T.funcType,c.funcType==null&&(c.funcType=0),T.type==11&&(c.selectedOutputInfo=T.selectedOutputInfo?JSON.parse(T.selectedOutputInfo):""),c.statistics=T.statistics,c.upDateValue=T.upDateValue,c.demoteValue=T.demoteValue,a.symbolicLink(c,T.operator),a.Call.send(a.Eve.SHIFT_SHOW_VIEW,[c,T.operator,r],null)}}a.Call.send(a.Eve.SHIFT_SHOW_VIEW_ON,[u,r],null)}if(y.isFormula){var p=new a.FormulaData(y.formulaName,y.formulaX,y.formulaY);p.body=u,p.body.isBindingFormula=!0,u.formulaBody=p,a.Call.send(a.Eve.SHIFT_ADD_FORMULA,[p,u.view,r],null)}}else if(y.type=="SymbolBody"||y.type=="符号运算体类"){var v=a.createSymbolBody(null,null,y.operator,y.isFunctionId,y.isWeight,y.funcType);v.isBindingOperation=a.getIsBoundOutput(t[o],i),a.operationBindBody(v),l==null&&(l=v),v.view!=null&&(v.view.setX(a.coordinate(t[o],i)[0]),v.view.setY(a.coordinate(t[o],i)[1]));for(var h=0;h<y.tree.length;h++){const T=y.tree[h];if(T.type=="OperationBody"||T.type=="运算体类")if(T.isFunction){var u=a.createOperationBody(a.coordinate(T,i)[0],a.coordinate(T,i)[1],1,T.isWeight,T.isAdvance,T.funcType);u.isBindingOperation=a.getIsBoundOutput(T,i),a.operationBindBody(u),a.addBody(v,u,!1);for(var D=0;D<T.tree.length;D++){const b=T.tree[D];if(b.type==4){var d=new a.VariableValue(b.name,null,4);d.TID=b.TID,d.TID==null&&(d.TID=new Date().getTime()+a.functionAddIndex,a.functionAddIndex++);var c=a.createFunctionBody(u,d);c.macros=a.amendMacros(b),c.enemyFlag=b.enemy,c.funcType=b.funcType,c.funcType==null&&(c.funcType=0),c.statistics=b.statistics,c.upDateValue=b.upDateValue,c.demoteValue=b.demoteValue,a.symbolicLink(c,b.operator),a.Call.send(a.Eve.SHIFT_SHOW_VIEW,[c,b.operator,r],null)}else{var f=[];s?a.getLibraryBody(f,a.targetFolder.tree,a.getAbsoluteAddress(b.source)):a.getLibraryBody(f,a.targetFolder.tree,a.getAbsoluteAddress(b));var g=f[0],c=a.createVariableBody(u,g);c.enemyFlag=b.enemy,c.funcType=b.funcType,c.funcType==null&&(c.funcType=0),b.type==11&&(c.selectedOutputInfo=b.selectedOutputInfo?JSON.parse(b.selectedOutputInfo):""),c.statistics=b.statistics,c.upDateValue=b.upDateValue,c.demoteValue=b.demoteValue,a.symbolicLink(c,b.operator),a.Call.send(a.Eve.SHIFT_SHOW_VIEW,[c,b.operator,r],null)}}a.Call.send(a.Eve.SHIFT_SHOW_VIEW_ON,[u,r],null)}else{var u=a.createOperationBody(a.coordinate(T,i)[0],a.coordinate(T,i)[1],0,T.isWeight,T.isAdvance,T.funcType);if(u.isBindingOperation=a.getIsBoundOutput(T,i),a.operationBindBody(u),a.addBody(v,u,!1),T.tree==null)return null;for(var D=0;D<T.tree.length;D++){const F=T.tree[D];if(F.type==4){var d=new a.VariableValue(F.name,null,F.type);d.TID=F.TID,d.TID==null&&(d.TID=new Date().getTime()+a.functionAddIndex,a.functionAddIndex++);var c=a.createFunctionBody(u,d);c.setMacros(a.amendMacros(F)),c.enemyFlag=F.enemy,c.funcType=F.funcType,c.funcType==null&&(c.funcType=0),c.statistics=F.statistics,c.upDateValue=F.upDateValue,c.demoteValue=F.demoteValue,a.symbolicLink(c,F.operator),a.Call.send(a.Eve.SHIFT_SHOW_VIEW,[c,F.operator,r],null)}else{var f=[];s||F.source?a.getLibraryBody(f,a.targetFolder.tree,a.getAbsoluteAddress(F.source)):a.getLibraryBody(f,a.targetFolder.tree,a.getAbsoluteAddress(F));var g=f[0],c=a.createVariableBody(u,g);c.enemyFlag=F.enemy,c.funcType=F.funcType,c.funcType==null&&(c.funcType=0),F.type==11&&(c.selectedOutputInfo=F.selectedOutputInfo?JSON.parse(F.selectedOutputInfo):""),c.statistics=F.statistics,c.upDateValue=F.upDateValue,c.demoteValue=F.demoteValue,a.symbolicLink(c,F.operator),a.Call.send(a.Eve.SHIFT_SHOW_VIEW,[c,F.operator,r],null)}}a.Call.send(a.Eve.SHIFT_SHOW_VIEW_ON,[u,r],null)}else if(T.type=="SymbolBody"||T.type=="符号运算体类"){var u=a.createSymbolBody(null,null,T.operator,T.isFunctionId,T.isWeight,T.funcType);u.isBindingOperation=a.getIsBoundOutput(T,i),a.operationBindBody(u),u.view!=null&&(u.view.setX(a.coordinate(T,i)[0]),u.view.setY(a.coordinate(T,i)[1])),a.loopGenerateBody(u,T.tree,r),a.addBody(v,u,!1),a.Call.send(a.Eve.SHIFT_SHOW_VIEW_ON,[u,r],null)}}if(a.Call.send(a.Eve.SHIFT_SHOW_VIEW_ON,[v,r],null),y.isFormula){var p=new a.FormulaData(y.formulaName,y.formulaX,y.formulaY);p.body=v,p.body.isBindingFormula=!0,v.formulaBody=p,a.Call.send(a.Eve.SHIFT_ADD_FORMULA,[p,v.view,r],null)}}else if(y.type=="Bookmark"){var u=a.createBookmark(y.x,y.y,y.width,y.height,y.text);a.Call.send(a.Eve.SHIFT_SHOW_VIEW_ON,[u,r],null)}}return l}),n(a,"amendMacros",function(t){return t.macros==null?t.macro:t.macros}),n(a,"fixedDecimal",function(t,r){switch(r){case 0:return Math.round(t);case 1:return Math.round(t*10)/10;case 2:return Math.round(t*100)/100;case 3:return Math.round(t*1e3)/1e3;case 4:return Math.round(t*1e4)/1e4}return 0}),n(a,"currencyConversion",function(t){var r=t%100,i=parseInt(String(t/100%100)),s=0;return t<1e5?s=parseInt(String(t/100/100%100)):s=parseInt(String(t/100/100)),[s,i,r]}),n(a,"replaceVariableBody",function(t,r,i){var s=r.copy();return t.replace(s,i),a.Call.send(a.Eve.SHIFT_ADD_VARIABLEBODY,[t,s],(function(l){}).bind(this)),s}),n(a,"createVariableBody",function(t,r){var i=r.copy();return t.addBody(i),a.Call.send(a.Eve.SHIFT_ADD_VARIABLEBODY,[t,i],(function(s){}).bind(this)),i}),n(a,"createFunctionBody",function(t,r){var i=r.copy();return t.addBody(i),a.Call.send(a.Eve.SHIFT_ADD_FUNCTION,[t,i],(function(s){}).bind(this)),i}),n(a,"replaceFunctionBody",function(t,r,i){var s=r.copy();return t.replace(s,i),a.Call.send(a.Eve.SHIFT_ADD_FUNCTION,[t,s],(function(l){}).bind(this)),s}),n(a,"createOperationBody",function(t,r,i,s,l,o){var u=new a.OperationBody;u.isFunction=!!i,a.targetStoragePool.push(u),u.isWeight=s,u.isAdvance=l,u.funcType=o,(u.funcType==null||u.funcType==null)&&(u.funcType=0),u.x=t,u.y=r;var h=null;return a.Call.send(a.Eve.SHIFT_ADD_OPERATIONBODY,[t,r,i,u],(function(d){h=d,s&&h&&h.openWeight(),l&&h&&h.openAdvance()}).bind(this)),u}),n(a,"createBookmark",function(t,r,i,s,l){var o=new a.Bookmark;return o.x=t,o.y=r,o.width=i,o.id=++EventManager.IDINDEX,o.width==null&&(o.width=256),o.height=s,o.height==null&&(o.height=256),o.text=l,a.targetStoragePool.push(o),a.Call.send(a.Eve.SHIFT_ADD_BOOKMARK,[o],(function(u){}).bind(this)),o}),n(a,"createSymbolBody",function(t,r,i,s,l,o){var u=new a.SymbolBody;return u.isWeight=l,u.isFunctionId=s,u.funcType=o,(u.funcType==null||u.funcType==null)&&(u.funcType=0),u.operator=i,u.isFunctionId==null&&(u.isFunctionId=1),t!=null&&u.addBody(t),r!=null&&u.addBody(r),a.targetStoragePool.push(u),a.Call.send(a.Eve.SHIFT_ADD_SYMBOLBODY,[t,r,i,s,u],null),u}),n(a,"operationBindBody",function(t){t.isBindingOperation&&a.editBody!=null&&(a.editBody.body=t)}),n(a,"addBody",function(t,r,i){a.Call.send(a.Eve.ADD_OPERAND_DATA,[t,r,i],null)}),n(a,"symbolicLink",function(t,r){r!=null&&(r=="删除符号"||r=="删除运算体"||r=="导出公式"||r=="敌方标记"||(t.operator=r))}),n(a,"loopGenerateBody",function(t,r,i){for(var s=0;s<r.length;s++){const g=r[s];switch(g.type){case"OperationBody":if(g.isFunction){var l=a.createOperationBody(a.coordinate(r[s])[0],a.coordinate(r[s])[1],1,g.isWeight,g.isAdvance,g.funcType);l.isBindingOperation=a.getIsBoundOutput(r[s]),a.operationBindBody(l),a.addBody(t,l,!1);for(var o=0;o<g.tree.length;o++){const p=g.tree[o];if(p.type==4){var u=new a.VariableValue(p.name,null,p.type);u.TID=p.TID,u.TID==null&&(u.TID=new Date().getTime()+a.functionAddIndex,a.functionAddIndex++);var h=a.createFunctionBody(l,u);h.macros=a.amendMacros(p),h.enemyFlag=p.enemy,h.funcType=p.funcType,h.funcType==null&&(h.funcType=0),h.statistics=p.statistics,h.upDateValue=p.upDateValue,h.demoteValue=p.demoteValue,a.symbolicLink(h,p.operator),a.clickBody=h,a.Call.send(a.Eve.SHIFT_SHOW_VIEW,[h,p.operator,i],null)}else{var d=[];a.getLibraryBody(d,a.targetFolder.tree,a.getAbsoluteAddress(p));var c=d[0],h=a.createVariableBody(l,c);h.enemyFlag=p.enemy,h.funcType=p.funcType,h.funcType==null&&(h.funcType=0),p.type==11&&(h.selectedOutputInfo=p.selectedOutputInfo?JSON.parse(p.selectedOutputInfo):""),h.statistics=p.statistics,h.upDateValue=p.upDateValue,h.demoteValue=p.demoteValue,a.symbolicLink(h,p.operator),a.Call.send(a.Eve.SHIFT_SHOW_VIEW,[h,p.operator,i],null)}}a.Call.send(a.Eve.SHIFT_SHOW_VIEW_ON,[l,i],null)}else{var l=a.createOperationBody(a.coordinate(r[s])[0],a.coordinate(r[s])[1],0,g.isWeight,g.isAdvance,g.funcType);l.isBindingOperation=a.getIsBoundOutput(r[s]),a.operationBindBody(l),a.addBody(t,l,!1);for(var o=0;o<g.tree.length;o++){const D=g.tree[o];if(D.type==4){var u=new a.VariableValue(D.name,null,D.type);u.TID=D.TID,u.TID==null&&(u.TID=new Date().getTime()+a.functionAddIndex,a.functionAddIndex++);var h=a.createFunctionBody(l,u);h.setMacros(a.amendMacros(D)),h.enemyFlag=D.enemy,h.funcType=D.funcType,h.funcType==null&&(h.funcType=0),h.statistics=D.statistics,h.upDateValue=D.upDateValue,h.demoteValue=D.demoteValue,a.symbolicLink(h,D.operator),a.Call.send(a.Eve.SHIFT_SHOW_VIEW,[h,D.operator,i],null)}else{var d=[];a.getLibraryBody(d,a.targetFolder.tree,a.getAbsoluteAddress(D));var c=d[0],h=a.createVariableBody(l,c);h.enemyFlag=D.enemy,h.funcType=D.funcType,h.funcType==null&&(h.funcType=0),D.type==11&&(h.selectedOutputInfo=D.selectedOutputInfo?JSON.parse(D.selectedOutputInfo):""),h.statistics=D.statistics,h.upDateValue=D.upDateValue,h.demoteValue=D.demoteValue,a.symbolicLink(h,D.operator),a.Call.send(a.Eve.SHIFT_SHOW_VIEW,[h,D.operator,i],null)}}a.Call.send(a.Eve.SHIFT_SHOW_VIEW_ON,[l,i],null)}break;case"SymbolBody":var f=a.createSymbolBody(null,null,g.operator,g.isFunctionId,g.isWeight,g.funcType);f.isBindingOperation=a.getIsBoundOutput(r[s]),a.operationBindBody(f),f.view!=null&&(f.view.setX(a.coordinate(r[s])[0]),f.view.setY(a.coordinate(r[s])[1])),a.loopGenerateBody(f,g.tree,i),a.addBody(t,f,!1),a.Call.send(a.Eve.SHIFT_SHOW_VIEW_ON,[f,i],null);break}}}),n(a,"saveFXTree",function(t,r){if(t!=null)for(var i=0;i<t.length;i++){const l=t[i];if(l.type==4){var s={TID:l.TID,name:l.name,code:l.macros};r.push(s)}else a.saveFXTree(l.tree,r)}}),n(a,"recursiveStorage",function(t,r){if(t.operationArray!=null)for(var i=0;i<t.operationArray.length;i++){const o=t.operationArray[i];if(o.tree!=null)for(var s=0;s<o.tree.length;s++){const u=o.tree[s];if(u.type==4){var l={TID:u.TID,name:u.name,code:u.macros};r.push(l)}else a.saveFXTree(u.tree,r)}o.operationArray!=null&&a.recursiveStorage(o,r)}}),n(a,"init",function(){try{a.isStart===!1&&(a.isStart=!0,a.code=!0,new a.FXCentre)}catch(t){console.error("Error initializing FX system:",t),a.isStart=!1,a.code=!1}}),a),globalThis_2=function(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{}}();globalThis_2.fx=fx,globalThis_2.seer=fx;const O=class O{constructor(){n(this,"_fxData");n(this,"_fxPlayer");n(this,"playerList",[])}static getInstance(){return this._instance||(this._instance=new O),this._instance}getPlayerInstance(){let t=this._fxData[0],r=new Player;r.name=t.name,console.log(r.name);let i=r.getBillboard();return console.log(i),r.parameterInfoArray=t.parameterInfoArray,r}getEnemyInstance(t){let r=this._fxData[t],i=new Player;return i.name=r.name,i.parameterInfoArray=r.parameterInfoArray,i}getInstanceByName(t){let r=this._fxData.find(s=>s.name===t);if(!r)return console.warn(`未找到名称为 "${t}" 的角色配置`),null;let i=new Player;return i.name=r.name,i.parameterInfoArray=r.parameterInfoArray,i}loadConfig(t){new FXCentre;var r=t,i=typeof r=="string"?JSON.parse(r):r;i.stage.operationArray;var s=i.library.operationArray;fx.createLibraryBody(s,!0),this._fxPlayer=Player,this.playerList=[];let l=new fx.CallCenter;l.addEventListener(EventManager.SHIFT_ADD_BOARD,h=>{let d=new BillboardLayer(h.name);d.monitored=h.monitored;let c=d;for(var f=0;f<h.operationArray.length;f++){var g=[];fx.getLibraryBody(g,fx.targetFolder.tree,h.operationArray[f].site),fx.clickBody=g[0],c.pushOperationLayer(),fx.clickBody=null}for(var f=0;f<h.metadataArray.length;f++){var g=[];fx.getLibraryBody(g,fx.targetFolder.tree,h.metadataArray[f].site),fx.clickBody=g[0];let D=h.metadataArray[f];c.pushMetadata(D.componentType,D.componentMinValue,D.componentMaxValue,D.componentIntervalValue),fx.clickBody=null}fx.Call.send(fx.Eve.ADD_DATABASE_DATA,[c,fx.selectBody,h.index]),fx.Call.send(fx.Eve.SHIFT_REFRESH_LIBRARY_COORDINATES,[c,fx.selectBody])}),l.addEventListener(EventManager.SHIFT_ADD_CHARTS,h=>{var d=new ChartsLayer(h.name);let c=d;for(var f=0;f<h.operationlayer.length;f++){var g=[];fx.getLibraryBody(g,fx.targetFolder.tree,h.operationlayer[f]),c.operationArray.push(g[0].copy())}var g=[];c.minValue=h.minValue,c.intervalValue=h.intervalValue,c.maxValue=h.maxValue,h.metadataArray||(h.metadataArray=[]),h.metadata&&(h.metadataArray=[{site:h.metadata,intervalValue:c.intervalValue,minValue:c.minValue}],h.metadata=null);for(var f=0;f<h.metadataArray.length;f++){var g=[],p=h.metadataArray[f];fx.getLibraryBody(g,fx.targetFolder.tree,p.site);var v=g[0].copy();v.intervalValue=p.intervalValue||1,v.minValue=p.minValue||1,c.metadataArray.push(v),c.metadata=v}Call.send(fx.Eve.ADD_DATABASE_DATA,[c,fx.selectBody,h.index]),fx.Call.send(fx.Eve.SHIFT_REFRESH_LIBRARY_COORDINATES,[c,fx.selectBody]),fx.clickBody=null}),fx.parseLibraryBody(s,!0),fx.recursionSyncBody(fx.targetFolder.tree);let o=i.entity.operationArray;this._fxData=o;let u=this.createPlayersFromEntityArray(o);console.log("-------------------"),u.forEach(h=>{let d=h.getFormula("攻击"),c=h.getFormula("生命"),f=h.getFormula("防御");console.log("name",h.name),console.log("attack",d),console.log("hp",c),console.log("defense",f)}),this.playerList=u}getDataByOccuAndLevel(t,r){this._fxPlayer.changePlayerLevelAndOccupation(r,t);let i=this._fxPlayer.getFormula("攻击1"),s=this._fxPlayer.getFormula("生命"),l=this._fxPlayer.getFormula("防御");return{attack:i,hp:s,defense:l}}getInstanceDataByNameAndOccuAndLevel(t,r,i){let s=this.playerList.find(h=>h.name===t);if(!s)throw new Error(`未找到名称为 "${t}" 的玩家`);s.changeLevelAndOccupation(i,r);let l=s.getFormula("攻击"),o=s.getFormula("生命"),u=s.getFormula("防御");return{attack:l,hp:o,defense:u}}createPlayersFromEntityArray(t){let r=[];for(var i=0;i<t.length;i++){let s=t[i],l=this.getInstanceByName(s.name);l?r.push(l):console.warn(`创建玩家实例失败: ${s.name}`)}return r}getSheetDataByPath(t){var l;let r=t.split("."),i=fx.targetFolder,s;for(let o=0;o<r.length;o++){let u;if(i.isFolder){if(u=i.tree.find(h=>h.name==r[o]),!u)throw new Error("getSheetDataByPath - 路径未找到: "+r[o])}else s=i;i=u,o==r.length-1&&(s=i)}return(l=s==null?void 0:s.sheetData)==null?void 0:l.originData}};n(O,"_instance");let FxUtil=O;window.FxUtil=FxUtil;class BattleLogger{constructor(){n(this,"logs",[]);n(this,"battleData",[])}addLog(t){const i=`[${new Date().toLocaleTimeString("zh-CN")}] ${t}`;this.logs.push(i),console.log(i)}addRoundData(t,r){this.battleData.push({round:t,timestamp:new Date().toISOString(),...r})}getLogs(){return[...this.logs]}getBattleData(){return[...this.battleData]}clear(){this.logs=[],this.battleData=[]}generateReport(){let t=`
========== 战斗报告 ==========
`;return t+=this.logs.join(`
`),t+=`

========== 战斗数据统计 ==========
`,t+=JSON.stringify(this.battleData,null,2),t+=`
================================
`,t}}class BattleEntity{constructor(t,r,i,s,l=1,o=1){n(this,"name");n(this,"maxHp");n(this,"currentHp");n(this,"attack");n(this,"defense");n(this,"level");n(this,"occupation");this.name=t,this.maxHp=r,this.currentHp=r,this.attack=i,this.defense=s,this.level=l,this.occupation=o}isAlive(){return this.currentHp>0}takeDamage(t){const r=Math.max(1,t-this.defense);return this.currentHp=Math.max(0,this.currentHp-r),r}getStatus(){return`${this.name} [Lv.${this.level}] HP: ${this.currentHp}/${this.maxHp} | 攻击: ${this.attack} | 防御: ${this.defense}`}getHpPercentage(){return this.currentHp/this.maxHp*100}}class BattleSimulator{constructor(t,r,i){n(this,"logger");n(this,"hero");n(this,"enemy");n(this,"round",0);n(this,"maxRounds",100);this.hero=t,this.enemy=r,this.logger=i}calculateDamage(t,r){let i=t.attack-r.defense;const s=.8+Math.random()*.4;return i=Math.floor(i*s),Math.max(1,i)}executeAttack(t,r){const i=this.calculateDamage(t,r),s=r.takeDamage(i);return this.logger.addLog(`  ${t.name} 攻击 ${r.name}，造成 ${s} 点伤害！（${r.name} 剩余血量: ${r.currentHp}/${r.maxHp}）`),s}battleRound(){this.round++,this.logger.addLog(`
----- 第 ${this.round} 回合 -----`),this.logger.addLog(`${this.hero.getStatus()}`),this.logger.addLog(`${this.enemy.getStatus()}`);const t={heroHp:this.hero.currentHp,heroHpPercent:this.hero.getHpPercentage(),enemyHp:this.enemy.currentHp,enemyHpPercent:this.enemy.getHpPercentage()},r=this.executeAttack(this.hero,this.enemy),i=()=>{t.enemyHp=this.enemy.currentHp,t.enemyHpPercent=this.enemy.getHpPercentage(),t.heroHp=this.hero.currentHp,t.heroHpPercent=this.hero.getHpPercentage()};if(!this.enemy.isAlive())return i(),this.logger.addLog(`
🎉 ${this.enemy.name} 被击败了！`),this.logger.addRoundData(this.round,{...t,heroDamageDealt:r,enemyDamageDealt:0,winner:this.hero.name,battleEnd:!0}),!0;const s=this.executeAttack(this.enemy,this.hero);return this.hero.isAlive()?(i(),this.logger.addRoundData(this.round,{...t,heroDamageDealt:r,enemyDamageDealt:s,battleEnd:!1}),!1):(this.logger.addLog(`
💀 ${this.hero.name} 被击败了！`),i(),this.logger.addRoundData(this.round,{...t,heroDamageDealt:r,enemyDamageDealt:s,winner:this.enemy.name,battleEnd:!0}),!0)}startBattle(){for(this.logger.addLog(`
========================================`),this.logger.addLog("⚔️  战斗开始！"),this.logger.addLog("========================================"),this.logger.addLog(`${this.hero.getStatus()}`),this.logger.addLog("VS"),this.logger.addLog(`${this.enemy.getStatus()}`),this.logger.addLog(`========================================
`);this.round<this.maxRounds&&!this.battleRound(););this.round>=this.maxRounds&&this.logger.addLog(`
⏱️  战斗超时，平局！`);const t=this.hero.isAlive()?this.hero.name:this.enemy.isAlive()?this.enemy.name:"平局";return this.logger.addLog(`
========================================`),this.logger.addLog("📊 战斗结束统计"),this.logger.addLog("========================================"),this.logger.addLog(`胜利者: ${t}`),this.logger.addLog(`总回合数: ${this.round}`),this.logger.addLog(`${this.hero.name} 最终状态: ${this.hero.getStatus()}`),this.logger.addLog(`${this.enemy.name} 最终状态: ${this.enemy.getStatus()}`),this.logger.addLog(`========================================
`),{winner:t,rounds:this.round,battleData:this.logger.getBattleData()}}}let fxInit=!1;async function init(){if(fxInit)return;const e=FxUtil.getInstance(),r=await(await fetch("./assets/fx.json")).json();e.loadConfig(r),fxInit=!0}async function exampleMultipleBattles(){console.log(`

========================================`),console.log("示例2: 多场战斗对比测试"),console.log(`========================================
`),await init();const e=FxUtil.getInstance(),t=[],r=[{heroLevel:5,enemyLevel:5,name:"势均力敌"},{heroLevel:10,enemyLevel:5,name:"主角优势"},{heroLevel:5,enemyLevel:10,name:"敌人优势"},{heroLevel:15,enemyLevel:15,name:"高等级对决"},{heroLevel:1,enemyLevel:1,name:"新手对决"}];for(const i of r){console.log(`
🏆 战斗场景: ${i.name}`),console.log(`主角等级: ${i.heroLevel} | 敌人等级: ${i.enemyLevel}`);const s=new BattleLogger,l=e.getInstanceDataByNameAndOccuAndLevel("主角1",1,i.heroLevel),o=new BattleEntity("勇者",l.hp,l.attack,l.defense,i.heroLevel,1),u=e.getInstanceDataByNameAndOccuAndLevel("怪物1",2,i.enemyLevel),h=new BattleEntity("巨龙",u.hp,u.attack,u.defense,i.enemyLevel,1),c=new BattleSimulator(o,h,s).startBattle();console.log(`[调试] ${i.name} 战斗结束`),console.log("[调试] result.battleData 存在?",!!c.battleData),console.log("[调试] result.battleData 长度:",c.battleData?c.battleData.length:"undefined"),console.log("[调试] result.battleData 内容:",c.battleData),t.push({场景:i.name,主角等级:i.heroLevel,敌人等级:i.enemyLevel,胜利者:c.winner,回合数:c.rounds,主角最终HP:o.currentHp,敌人最终HP:h.currentHp,battleData:c.battleData,heroName:"勇者",enemyName:"巨龙"})}return console.log(`

📊 多场战斗统计结果:`),console.table(t),console.log("[调试] 返回results前的最终检查:"),t.forEach((i,s)=>{console.log(`  结果 ${s}: 场景="${i.场景}", battleData长度=${i.battleData?i.battleData.length:"undefined"}`)}),t}async function generatePVEData(e,t=50){var s;const r=[];await init();const i=FxUtil.getInstance();for(let l=1;l<=t;l++){await new Promise(o=>{requestAnimationFrame(()=>o(!0))});try{const o=new BattleLogger,u=i.getInstanceDataByNameAndOccuAndLevel("主角1",1,l),h=new BattleEntity("勇者",u.hp,u.attack,u.defense,l,1),d=i.getInstanceDataByNameAndOccuAndLevel("怪物1",1,l),c=new BattleEntity("巨龙",d.hp,d.attack,d.defense,l,1);console.log("进行战斗",l),console.log("hero",h),console.log("enemy",c);const g=new BattleSimulator(h,c,o).startBattle();let p=0,v=0;if(g.battleData&&g.battleData.length>0)for(const m of g.battleData)m.heroDamageDealt!==void 0&&(p+=m.heroDamageDealt,v++);const D=v>0?p/v:0,y={level:l,hp:h.currentHp,damage:D,rounds:g.rounds,battleData:g.battleData,heroName:"勇者",enemyName:"巨龙"};(l===1||l===10||l===50)&&console.log(`[调试] 等级${l}数据:`,{level:y.level,rounds:y.rounds,battleDataLength:(s=y.battleData)==null?void 0:s.length,battleDataExists:!!y.battleData}),r.push(y),e&&e(r,l,t),l%10===0&&console.log(`PVE数据生成进度: ${l}/${t}`)}catch(o){console.error(`等级${l}战斗模拟失败:`,o);const u={level:l,hp:100,damage:20,rounds:10,battleData:[],heroName:"勇者",enemyName:"巨龙"};r.push(u),e&&e(r,l,t)}}return console.log("PVE数据生成完成，共",r.length,"个等级"),r}async function runAllExamples(){console.log(`

`),console.log("╔════════════════════════════════════════╗"),console.log("║   Seer Engine 多场战斗对比演示程序     ║"),console.log("║   Multiple Battles Comparison Demo      ║"),console.log("╚════════════════════════════════════════╝"),console.log(`
`),await init();try{await exampleMultipleBattles(),console.log(`
✅ 多场战斗对比示例运行完成！`),console.log(`查看控制台以获取详细的战斗日志和数据分析。
`)}catch(e){console.error("❌ 运行示例时出错:",e)}}typeof window<"u"&&(window.battleDemo={runAllExamples,exampleMultipleBattles,generatePVEData},console.log("💡 使用方法:"),console.log("  - battleDemo.runAllExamples() - 运行多场战斗对比示例"),console.log("  - battleDemo.exampleMultipleBattles() - 多场对比"),console.log("  - battleDemo.generatePVEData() - 生成PVE测试数据")),exports.BattleEntity=BattleEntity,exports.BattleLogger=BattleLogger,exports.BattleSimulator=BattleSimulator,exports.exampleMultipleBattles=exampleMultipleBattles,exports.generatePVEData=generatePVEData,exports.runAllExamples=runAllExamples,Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})});
