<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SoonFx Engine - Interactive Battle Demo</title>
    <base href="./examples/">
    <script src="libs/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #1e3a8a;
            --secondary-color: #7c3aed;
            --accent-color: #06b6d4;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --dark-bg: #0f172a;
            --card-bg: #1e293b;
            --text-light: #f1f5f9;
            --text-gray: #94a3b8;
        }

        body {
            font-family: 'Inter', 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: var(--text-light);
            padding: 1rem;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1500px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.2rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            text-align: center;
        }

        .header h1 {
            color: var(--accent-color);
            font-size: 2rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .header p {
            color: var(--text-gray);
            font-size: 1rem;
        }

        /* Main Layout */
        .main-layout {
            display: grid;
            grid-template-columns: 280px 1fr 380px;
            gap: 1rem;
            align-items: start;
        }

        /* Scenario Selector */
        .scenario-panel {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            position: sticky;
            top: 1rem;
        }

        .scenario-panel h2 {
            color: var(--accent-color);
            font-size: 1.2rem;
            margin-bottom: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .scenario-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .scenario-btn {
            background: linear-gradient(135deg, rgba(30, 58, 138, 0.5), rgba(124, 58, 237, 0.5));
            color: var(--text-light);
            border: 2px solid transparent;
            padding: 0.9rem;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .scenario-btn:hover {
            border-color: var(--accent-color);
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);
        }

        .scenario-btn.active {
            background: linear-gradient(135deg, var(--accent-color), var(--secondary-color));
            border-color: var(--accent-color);
            box-shadow: 0 4px 12px rgba(6, 182, 212, 0.5);
        }

        .scenario-btn .label {
            display: block;
            font-size: 1rem;
            margin-bottom: 0.3rem;
        }

        .scenario-btn .desc {
            display: block;
            font-size: 0.85rem;
            color: var(--text-gray);
            font-weight: 400;
        }

        .scenario-btn.active .desc {
            color: rgba(255, 255, 255, 0.8);
        }

        /* Chart Area */
        .chart-area {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .chart-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .chart-card h3 {
            color: var(--accent-color);
            font-size: 1.1rem;
            margin-bottom: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .chart-wrapper {
            position: relative;
            height: 280px;
        }

        .chart-wrapper canvas {
            max-height: 100%;
        }

        .chart-placeholder {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-gray);
            font-size: 1rem;
            font-style: italic;
            background: rgba(0, 0, 0, 0.2);
            border: 2px dashed rgba(150, 150, 150, 0.3);
            border-radius: 8px;
        }

        .chart-placeholder.hidden {
            display: none;
        }

        /* Battle Details */
        .details-panel {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            position: sticky;
            top: 1rem;
            max-height: calc(100vh - 2rem);
            overflow-y: auto;
        }

        .details-panel::-webkit-scrollbar {
            width: 8px;
        }

        .details-panel::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
        }

        .details-panel::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 4px;
        }

        .details-panel h2 {
            color: var(--accent-color);
            font-size: 1.2rem;
            margin-bottom: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status {
            padding: 0.9rem;
            border-radius: 8px;
            margin-bottom: 0.9rem;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .status.loading {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning-color);
            border: 1px solid var(--warning-color);
        }

        .status.success {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success-color);
            border: 1px solid var(--success-color);
        }

        .status.error {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger-color);
            border: 1px solid var(--danger-color);
        }

        .detail-chart {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 0.9rem;
            margin-bottom: 0.9rem;
        }

        .detail-chart h4 {
            color: var(--text-light);
            font-size: 1rem;
            margin-bottom: 0.75rem;
        }

        .detail-chart-wrapper {
            height: 180px;
            position: relative;
        }

        #output {
            background: #000;
            color: #0f0;
            padding: 0.9rem;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.85rem;
            line-height: 1.5;
            max-height: 250px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        #output::-webkit-scrollbar {
            width: 8px;
        }

        #output::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.5);
        }

        #output::-webkit-scrollbar-thumb {
            background: #0f0;
            border-radius: 4px;
        }

        #output:empty::before {
            content: 'Waiting for simulation...';
            color: #888;
            font-style: italic;
        }

        .info-box {
            background: rgba(6, 182, 212, 0.1);
            border-left: 3px solid var(--accent-color);
            padding: 0.9rem;
            margin-bottom: 0.9rem;
            border-radius: 4px;
            font-size: 0.85rem;
        }

        .info-box strong {
            color: var(--accent-color);
        }

        /* Loading Animation */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--accent-color);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 1400px) {
            .main-layout {
                grid-template-columns: 260px 1fr 350px;
            }
        }

        @media (max-width: 1200px) {
            .main-layout {
                grid-template-columns: 1fr;
            }

            .scenario-panel, .details-panel {
                position: static;
            }

            .details-panel {
                max-height: none;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5rem;
            }

            .chart-wrapper {
                height: 250px;
            }

            .detail-chart-wrapper {
                height: 180px;
            }
        }

        /* Story Mode Styles */
        .story-header {
            background: linear-gradient(135deg, rgba(30, 58, 138, 0.3), rgba(124, 58, 237, 0.3));
            padding: 0.9rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 4px solid var(--accent-color);
        }

        .story-header h3 {
            color: var(--accent-color);
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .story-header p {
            color: var(--text-gray);
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>‚öîÔ∏è Interactive Battle Simulation</h1>
            <p>Real-time combat data visualization and analysis powered by SoonFx Engine</p>
        </div>

        <!-- Main Layout -->
        <div class="main-layout">
            <!-- Scenario Selector -->
            <div class="scenario-panel">
                <h2>üéÆ Battle Scenarios</h2>
                <div class="scenario-list">
                    <button class="scenario-btn active" data-scenario="pve-growth" onclick="selectScenario('pve-growth')">
                        <span class="label">üìà Level Progression (1-50)</span>
                        <span class="desc">Watch how stats scale across levels</span>
                    </button>
                    <button class="scenario-btn" data-scenario="newbie" onclick="selectScenario('newbie')">
                        <span class="label">üå± Newbie Village (Lv 1-10)</span>
                        <span class="desc">First steps in the adventure</span>
                    </button>
                    <button class="scenario-btn" data-scenario="mid-game" onclick="selectScenario('mid-game')">
                        <span class="label">‚öîÔ∏è Mid-Game Challenge (Lv 20-30)</span>
                        <span class="desc">Intermediate difficulty battles</span>
                    </button>
                </div>

                <div class="info-box" style="margin-top: 1.5rem;">
                    <strong>üí° Tip:</strong> Click on any data point in the charts to see detailed battle information for that level.
                </div>
            </div>

            <!-- Chart Area -->
            <div class="chart-area">
                <!-- Story Header -->
                <div class="story-header" id="storyHeader">
                    <h3 id="storyTitle">üìä Analyzing Level Progression</h3>
                    <p id="storyDesc">Simulating 50 battles to show how character stats evolve from novice to master...</p>
                </div>

                <!-- HP Chart -->
                <div class="chart-card">
                    <h3>‚ù§Ô∏è Health Points (HP) by Level</h3>
                    <div class="chart-wrapper">
                        <canvas id="hpChart"></canvas>
                        <div id="hpPlaceholder" class="chart-placeholder">
                            <span class="loading-spinner"></span>
                            <span style="margin-left: 0.5rem;">Running simulations...</span>
                        </div>
                    </div>
                </div>

                <!-- Damage Chart -->
                <div class="chart-card">
                    <h3>üí• Attack Damage by Level</h3>
                    <div class="chart-wrapper">
                        <canvas id="damageChart"></canvas>
                        <div id="damagePlaceholder" class="chart-placeholder">
                            <span class="loading-spinner"></span>
                            <span style="margin-left: 0.5rem;">Running simulations...</span>
                        </div>
                    </div>
                </div>

                <!-- Rounds Chart -->
                <div class="chart-card">
                    <h3>‚è±Ô∏è Battle Duration (Rounds) by Level</h3>
                    <div class="chart-wrapper">
                        <canvas id="roundsChart"></canvas>
                        <div id="roundsPlaceholder" class="chart-placeholder">
                            <span class="loading-spinner"></span>
                            <span style="margin-left: 0.5rem;">Running simulations...</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Battle Details -->
            <div class="details-panel">
                <h2>üìã Battle Details</h2>
                
                <div id="status"></div>

                <!-- Detail Charts -->
                <div id="detailChartsContainer" style="display: none;">
                    <div class="detail-chart">
                        <h4>HP Change Over Rounds</h4>
                        <div class="detail-chart-wrapper">
                            <canvas id="detailHpChart"></canvas>
                        </div>
                    </div>

                    <div class="detail-chart">
                        <h4>Damage Statistics</h4>
                        <div class="detail-chart-wrapper">
                            <canvas id="detailDamageChart"></canvas>
                        </div>
                    </div>
                </div>

                <div id="output"></div>
            </div>
        </div>
    </div>

    <script type="module">
        // Wait for Chart.js to load
        await new Promise((resolve) => {
            if (typeof Chart !== 'undefined') {
                resolve();
            } else {
                window.addEventListener('load', resolve);
            }
        });

        // Global state
        window.Chart = Chart;
        window.chartInstances = {};
        window.currentScenario = 'pve-growth';
        window.pveBattleData = null;
        window.currentLevel = null;

        // Story content for each scenario
        const storyContent = {
            'pve-growth': {
                title: 'üìä Level Progression Analysis',
                desc: 'Simulating 50 battles to show how character stats evolve from novice to master...'
            },
            'newbie': {
                title: 'üå± The First Adventure',
                desc: 'A young hero takes their first steps, facing level 1-10 slimes in the Newbie Village...'
            },
            'mid-game': {
                title: '‚öîÔ∏è Rising Challenge',
                desc: 'The hero has grown stronger (Lv 20-30) and now faces tougher enemies in the Dark Forest...'
            }
        };

        // Update story header
        function updateStoryHeader(scenario) {
            const content = storyContent[scenario];
            document.getElementById('storyTitle').textContent = content.title;
            document.getElementById('storyDesc').textContent = content.desc;
        }

        // Scenario selection
        window.selectScenario = async function(scenario) {
            // Update active button
            document.querySelectorAll('.scenario-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.scenario === scenario) {
                    btn.classList.add('active');
                }
            });

            window.currentScenario = scenario;
            updateStoryHeader(scenario);

            // Clear previous data
            window.clearOutput();
            window.clearCharts();

            // Show placeholders
            document.getElementById('hpPlaceholder').classList.remove('hidden');
            document.getElementById('damagePlaceholder').classList.remove('hidden');
            document.getElementById('roundsPlaceholder').classList.remove('hidden');

            // Run simulation based on scenario
            await runScenario(scenario);
        };

        // Run scenario
        async function runScenario(scenario) {
            window.setStatus('loading', `üîÑ Running ${scenario} simulation...`);

            try {
                switch (scenario) {
                    case 'pve-growth':
                        await showPVEGrowthCurve(50);
                        break;
                    case 'newbie':
                        await showPVEGrowthCurve(10, 1);
                        break;
                    case 'mid-game':
                        await showPVEGrowthCurve(11, 20);
                        break;
                }

                window.setStatus('success', '‚úÖ Simulation complete! Click on any chart point to see detailed battle data.');
            } catch (error) {
                console.error('Simulation error:', error);
                window.setStatus('error', '‚ùå Simulation failed: ' + error.message);
            }
        }

        // Show PVE growth curve
        async function showPVEGrowthCurve(maxLevel, startLevel = 1) {
            window.currentLevel = null;
            document.getElementById('detailChartsContainer').style.display = 'none';

            const pveData = await window.generatePVEData((data, level, total) => {
                window.updateCharts(data);
                window.pveBattleData = data;
                window.setStatus('loading', `üîÑ Simulating battles... ${level}/${total} (${Math.round(level/total*100)}%)`);

                // Auto-select first level when ready
                if (level === startLevel && data.length > 0) {
                    setTimeout(() => {
                        if (data[0] && data[0].battleData) {
                            window.showBattleDetail(0);
                        }
                    }, 500);
                }
            }, maxLevel, startLevel);

            window.pveBattleData = pveData;
            console.log(`Growth curve generated with ${pveData.length} data points`);
        }

        // Generate PVE data
        window.generatePVEData = async function(onProgress, maxLevel = 50, startLevel = 1) {
            if (typeof window.battleDemo === 'undefined') {
                throw new Error('Battle demo module not loaded');
            }

            return await window.battleDemo.generatePVEDataRange(onProgress, maxLevel, startLevel);
        };

        // Update all charts
        window.updateCharts = function(data) {
            if (!data || data.length === 0) return;

            const levels = data.map(d => `Lv ${d.level}`);
            const hpValues = data.map(d => d.hp);
            const damageValues = data.map(d => d.damage);
            const roundsValues = data.map(d => d.rounds);

            const currentLevelIndex = window.currentLevel !== null ? 
                data.findIndex(d => d.level === window.currentLevel) : -1;

            // Update or create HP chart
            if (window.chartInstances.hpChart) {
                updateChartData(window.chartInstances.hpChart, levels, hpValues, currentLevelIndex, 'rgb(75, 192, 192)');
            } else {
                window.chartInstances.hpChart = createLineChart('hpChart', levels, hpValues, 'Health Points', 'rgb(75, 192, 192)', currentLevelIndex);
                document.getElementById('hpPlaceholder').classList.add('hidden');
            }

            // Update or create Damage chart
            if (window.chartInstances.damageChart) {
                updateChartData(window.chartInstances.damageChart, levels, damageValues, currentLevelIndex, 'rgb(255, 99, 132)');
            } else {
                window.chartInstances.damageChart = createLineChart('damageChart', levels, damageValues, 'Attack Damage', 'rgb(255, 99, 132)', currentLevelIndex);
                document.getElementById('damagePlaceholder').classList.add('hidden');
            }

            // Update or create Rounds chart
            if (window.chartInstances.roundsChart) {
                updateChartData(window.chartInstances.roundsChart, levels, roundsValues, currentLevelIndex, 'rgb(153, 102, 255)');
            } else {
                window.chartInstances.roundsChart = createLineChart('roundsChart', levels, roundsValues, 'Battle Duration', 'rgb(153, 102, 255)', currentLevelIndex);
                document.getElementById('roundsPlaceholder').classList.add('hidden');
            }
        };

        // Create line chart
        function createLineChart(canvasId, labels, data, label, color, highlightIndex = -1) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return null;

            const pointRadii = labels.map((_, idx) => idx === highlightIndex ? 8 : 3);
            const pointColors = labels.map((_, idx) => idx === highlightIndex ? 'rgb(255, 200, 0)' : color);

            return new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: label,
                        data: data,
                        borderColor: color,
                        backgroundColor: color.replace('rgb', 'rgba').replace(')', ', 0.1)'),
                        borderWidth: 2,
                        pointRadius: pointRadii,
                        pointBackgroundColor: pointColors,
                        pointBorderColor: pointColors,
                        pointBorderWidth: 2,
                        pointHoverRadius: 6,
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            borderColor: color,
                            borderWidth: 1,
                            callbacks: {
                                afterLabel: () => 'Click to view battle details'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: '#94a3b8' }
                        },
                        x: {
                            grid: { color: 'rgba(255, 255, 255, 0.05)' },
                            ticks: { color: '#94a3b8' }
                        }
                    },
                    onClick: (event, activeElements) => {
                        if (activeElements.length > 0 && window.pveBattleData) {
                            const index = activeElements[0].index;
                            window.showBattleDetail(index);
                        }
                    }
                }
            });
        }

        // Update chart data
        function updateChartData(chart, labels, data, highlightIndex, color) {
            chart.data.labels = labels;
            chart.data.datasets[0].data = data;
            chart.data.datasets[0].pointRadius = labels.map((_, idx) => idx === highlightIndex ? 8 : 3);
            chart.data.datasets[0].pointBackgroundColor = labels.map((_, idx) => 
                idx === highlightIndex ? 'rgb(255, 200, 0)' : color
            );
            chart.update('none');
        }

        // Show battle detail
        window.showBattleDetail = function(index) {
            if (!window.pveBattleData || !window.pveBattleData[index]) {
                console.error('Battle data not found for index:', index);
                return;
            }

            const battle = window.pveBattleData[index];
            
            if (!battle.battleData || battle.battleData.length === 0) {
                console.error('No detailed battle data available');
                return;
            }

            window.currentLevel = battle.level;
            window.updateCharts(window.pveBattleData);

            document.getElementById('detailChartsContainer').style.display = 'block';

            // Create detail charts
            createDetailHpChart(battle.battleData, battle.heroName || 'Hero', battle.enemyName || 'Enemy');
            createDetailDamageChart(battle.battleData, battle.heroName || 'Hero', battle.enemyName || 'Enemy');

            // Update output
            window.clearOutputOnly();
            console.log(`\n========== Level ${battle.level} Battle Details ==========`);
            console.log(`Battle Duration: ${battle.rounds} rounds`);
            console.log(`Hero Final HP: ${Math.round(battle.hp)}`);
            console.log(`Average Damage: ${Math.round(battle.damage)}`);
            console.log(`========================================\n`);
        };

        // Create detail HP chart
        function createDetailHpChart(battleData, heroName, enemyName) {
            const ctx = document.getElementById('detailHpChart');
            if (!ctx) return;

            if (window.chartInstances.detailHpChart) {
                window.chartInstances.detailHpChart.destroy();
            }

            const rounds = battleData.map(d => `R${d.round}`);
            const heroHp = battleData.map(d => d.heroHp);
            const enemyHp = battleData.map(d => d.enemyHp);

            window.chartInstances.detailHpChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: rounds,
                    datasets: [{
                        label: `${heroName} HP`,
                        data: heroHp,
                        borderColor: 'rgb(75, 192, 192)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        tension: 0.3,
                        fill: true
                    }, {
                        label: `${enemyName} HP`,
                        data: enemyHp,
                        borderColor: 'rgb(255, 99, 132)',
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            display: true,
                            labels: { color: '#f1f5f9' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: '#94a3b8' }
                        },
                        x: {
                            grid: { color: 'rgba(255, 255, 255, 0.05)' },
                            ticks: { color: '#94a3b8' }
                        }
                    }
                }
            });
        }

        // Create detail damage chart
        function createDetailDamageChart(battleData, heroName, enemyName) {
            const ctx = document.getElementById('detailDamageChart');
            if (!ctx) return;

            if (window.chartInstances.detailDamageChart) {
                window.chartInstances.detailDamageChart.destroy();
            }

            const totalHeroDamage = battleData.reduce((sum, d) => sum + (d.heroDamageDealt || 0), 0);
            const totalEnemyDamage = battleData.reduce((sum, d) => sum + (d.enemyDamageDealt || 0), 0);
            const avgHeroDamage = (totalHeroDamage / battleData.length).toFixed(1);
            const avgEnemyDamage = (totalEnemyDamage / battleData.length).toFixed(1);

            window.chartInstances.detailDamageChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Total Damage', 'Avg Damage/Round'],
                    datasets: [{
                        label: heroName,
                        data: [totalHeroDamage, avgHeroDamage],
                        backgroundColor: 'rgba(75, 192, 192, 0.8)',
                        borderColor: 'rgb(75, 192, 192)',
                        borderWidth: 2
                    }, {
                        label: enemyName,
                        data: [totalEnemyDamage, avgEnemyDamage],
                        backgroundColor: 'rgba(255, 99, 132, 0.8)',
                        borderColor: 'rgb(255, 99, 132)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            display: true,
                            labels: { color: '#f1f5f9' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: '#94a3b8' }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: '#94a3b8' }
                        }
                    }
                }
            });
        }

        // Set status
        window.setStatus = function(type, message) {
            const statusEl = document.getElementById('status');
            statusEl.className = `status ${type}`;
            statusEl.textContent = message;
        };

        // Clear output
        window.clearOutput = function() {
            const outputEl = document.getElementById('output');
            if (outputEl) outputEl.textContent = '';
            window.setStatus('', '');
            window.clearCharts();
        };

        window.clearOutputOnly = function() {
            const outputEl = document.getElementById('output');
            if (outputEl) outputEl.textContent = '';
        };

        // Clear charts
        window.clearCharts = function() {
            Object.values(window.chartInstances).forEach(chart => {
                if (chart) chart.destroy();
            });
            window.chartInstances = {};
        };

        // Redirect console.log to output
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            
            const outputEl = document.getElementById('output');
            if (outputEl) {
                //outputEl.textContent += message + '\n';
              //  outputEl.scrollTop = outputEl.scrollHeight;
            }
        };

        // Initialize - auto-run on page load
        window.addEventListener('DOMContentLoaded', async () => {
            console.log('Battle simulation system initialized');
            
            if (typeof window.battleDemo === 'undefined') {
                window.setStatus('error', '‚ö†Ô∏è Battle module not loaded. Please ensure the project is built correctly.');
                return;
            }

            // Auto-run default scenario
            await selectScenario('pve-growth');
        });
    </script>

    <!-- Load battle demo module -->
    <script type="module" src="./dist/test.js"></script>
</body>
</html>
